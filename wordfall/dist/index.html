<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Wordfall</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      font-family: 'Outfit', sans-serif;
      background: #0a0a1a;
    }

    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* Hidden input for typing */
    #typingInput {
      position: absolute;
      left: -9999px;
      top: 0;
      opacity: 0;
      width: 1px;
      height: 1px;
    }

    /* Overlay container */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      pointer-events: none;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .overlay.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .overlay-content {
      pointer-events: auto;
      text-align: center;
      padding: 2rem;
    }

    /* Start Screen */
    #startScreen {
      background: linear-gradient(180deg, rgba(10, 10, 26, 0.95) 0%, rgba(20, 15, 40, 0.98) 100%);
    }

    .game-title {
      font-family: 'Outfit', sans-serif;
      font-size: clamp(3rem, 12vw, 6rem);
      font-weight: 800;
      background: linear-gradient(135deg, #00d4ff 0%, #a855f7 50%, #ff6b9d 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 60px rgba(0, 212, 255, 0.5);
      margin-bottom: 1rem;
      letter-spacing: -0.02em;
    }

    .game-subtitle {
      font-size: clamp(1rem, 3vw, 1.4rem);
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 2.5rem;
      max-width: 400px;
      line-height: 1.5;
    }

    .btn {
      font-family: 'Outfit', sans-serif;
      font-size: clamp(1.1rem, 3vw, 1.3rem);
      font-weight: 700;
      padding: 1rem 3rem;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .btn-primary {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: #000;
      box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(0, 212, 255, 0.6);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 2px solid rgba(255, 255, 255, 0.3);
      margin-top: 1rem;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* HUD */
    #hud {
      position: fixed;
      top: 10px; /* Safe area handled by padding below */
      left: 0;
      right: 0;
      display: none;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0 10px;
      z-index: 50;
      pointer-events: none;
    }

    .hud-badge {
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 0.4rem 0.8rem;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 70px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .hud-label {
      font-size: 0.6rem;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.1rem;
    }

    .hud-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.2rem;
      font-weight: 700;
      color: #fff;
    }

    /* Typing Buffer Display */
    #bufferDisplay {
      position: fixed;
      bottom: 50%; /* Default, will be overridden by JS on mobile */
      left: 50%;
      transform: translate(-50%, 0);
      z-index: 50;
      display: none;
    }

    .buffer-container {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(0, 212, 255, 0.5);
      border-radius: 12px;
      padding: 0.4rem 1rem;
      min-width: 220px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    }

    .buffer-label {
      font-size: 0.6rem;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: 0.1rem;
    }

    .buffer-text {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.4rem;
      font-weight: 700;
      color: #00d4ff;
      min-height: 1.8rem;
      letter-spacing: 0.05em;
    }

    .buffer-cursor {
      display: inline-block;
      width: 2px;
      height: 1.5rem;
      background: #00d4ff;
      margin-left: 2px;
      animation: blink 0.8s infinite;
      vertical-align: middle;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Freeze Overlay */
    #freezeOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, rgba(0, 150, 255, 0.15) 0%, rgba(0, 100, 200, 0.3) 100%);
      pointer-events: none;
      z-index: 40;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    #freezeOverlay.active {
      opacity: 1;
    }

    #freezeTimer {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'JetBrains Mono', monospace;
      font-size: 4rem;
      font-weight: 700;
      color: #00bfff;
      text-shadow: 0 0 30px rgba(0, 191, 255, 0.8);
      z-index: 41;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    #freezeTimer.active {
      opacity: 1;
    }

    /* Game Over Screen */
    #gameOverScreen {
      background: linear-gradient(180deg, rgba(10, 10, 26, 0.98) 0%, rgba(30, 10, 20, 0.98) 100%);
    }

    .game-over-title {
      font-size: clamp(2.5rem, 10vw, 4rem);
      font-weight: 800;
      color: #ff4757;
      margin-bottom: 2rem;
      text-shadow: 0 0 40px rgba(255, 71, 87, 0.5);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
      max-width: 350px;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: #fff;
    }

    .stat-value.highlight {
      color: #ffd700;
    }

    .buttons-row {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    /* Combo Display */
    #comboDisplay {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Outfit', sans-serif;
      font-size: 3rem;
      font-weight: 800;
      color: #ffd700;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
      z-index: 45;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease;
    }

    #comboDisplay.active {
      opacity: 1;
      animation: comboPop 0.4s ease-out;
    }

    @keyframes comboPop {
      0% { transform: translate(-50%, -50%) scale(0.5); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    /* Mobile adjustments */
    @media (pointer: coarse) {
      #bufferDisplay {
        bottom: 1rem;
      }
      
      .buffer-container {
        min-width: 280px;
        padding: 1rem 1.5rem;
      }
      
      .buffer-text {
        font-size: 1.8rem;
      }

      #hud {
        padding: 0.75rem 1rem;
        padding-top: max(0.75rem, env(safe-area-inset-top));
      }

      .hud-value {
        font-size: 1.4rem;
      }

      .game-subtitle {
        padding: 0 1rem;
      }
    }
  </style>
  <script type="module" crossorigin>(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))T(h);new MutationObserver(h=>{for(const e of h)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&T(o)}).observe(document,{childList:!0,subtree:!0});function w(h){const e={};return h.integrity&&(e.integrity=h.integrity),h.referrerPolicy&&(e.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?e.credentials="include":h.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function T(h){if(h.ep)return;h.ep=!0;const e=w(h);fetch(h.href,e)}})();var ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function we(z){return z&&z.__esModule&&Object.prototype.hasOwnProperty.call(z,"default")?z.default:z}var te={exports:{}};var Se=te.exports,de;function ke(){return de||(de=1,(function(z,v){(function(T,h){z.exports=h()})(Se,function(){return(function(w){var T={};function h(e){if(T[e])return T[e].exports;var o=T[e]={i:e,l:!1,exports:{}};return w[e].call(o.exports,o,o.exports,h),o.l=!0,o.exports}return h.m=w,h.c=T,h.d=function(e,o,r){h.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:r})},h.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},h.t=function(e,o){if(o&1&&(e=h(e)),o&8||o&4&&typeof e=="object"&&e&&e.__esModule)return e;var r=Object.create(null);if(h.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),o&2&&typeof e!="string")for(var s in e)h.d(r,s,function(u){return e[u]}.bind(null,s));return r},h.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return h.d(o,"a",o),o},h.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},h.p="",h(h.s=20)})([(function(w,T){var h={};w.exports=h,(function(){h._baseDelta=1e3/60,h._nextId=0,h._seed=0,h._nowStartTime=+new Date,h._warnedOnce={},h._decomp=null,h.extend=function(o,r){var s,u;typeof r=="boolean"?(s=2,u=r):(s=1,u=!0);for(var i=s;i<arguments.length;i++){var f=arguments[i];if(f)for(var l in f)u&&f[l]&&f[l].constructor===Object&&(!o[l]||o[l].constructor===Object)?(o[l]=o[l]||{},h.extend(o[l],u,f[l])):o[l]=f[l]}return o},h.clone=function(o,r){return h.extend({},r,o)},h.keys=function(o){if(Object.keys)return Object.keys(o);var r=[];for(var s in o)r.push(s);return r},h.values=function(o){var r=[];if(Object.keys){for(var s=Object.keys(o),u=0;u<s.length;u++)r.push(o[s[u]]);return r}for(var i in o)r.push(o[i]);return r},h.get=function(o,r,s,u){r=r.split(".").slice(s,u);for(var i=0;i<r.length;i+=1)o=o[r[i]];return o},h.set=function(o,r,s,u,i){var f=r.split(".").slice(u,i);return h.get(o,r,0,-1)[f[f.length-1]]=s,s},h.shuffle=function(o){for(var r=o.length-1;r>0;r--){var s=Math.floor(h.random()*(r+1)),u=o[r];o[r]=o[s],o[s]=u}return o},h.choose=function(o){return o[Math.floor(h.random()*o.length)]},h.isElement=function(o){return typeof HTMLElement<"u"?o instanceof HTMLElement:!!(o&&o.nodeType&&o.nodeName)},h.isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"},h.isFunction=function(o){return typeof o=="function"},h.isPlainObject=function(o){return typeof o=="object"&&o.constructor===Object},h.isString=function(o){return toString.call(o)==="[object String]"},h.clamp=function(o,r,s){return o<r?r:o>s?s:o},h.sign=function(o){return o<0?-1:1},h.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-h._nowStartTime},h.random=function(o,r){return o=typeof o<"u"?o:0,r=typeof r<"u"?r:1,o+e()*(r-o)};var e=function(){return h._seed=(h._seed*9301+49297)%233280,h._seed/233280};h.colorToNumber=function(o){return o=o.replace("#",""),o.length==3&&(o=o.charAt(0)+o.charAt(0)+o.charAt(1)+o.charAt(1)+o.charAt(2)+o.charAt(2)),parseInt(o,16)},h.logLevel=1,h.log=function(){console&&h.logLevel>0&&h.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.info=function(){console&&h.logLevel>0&&h.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.warn=function(){console&&h.logLevel>0&&h.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.warnOnce=function(){var o=Array.prototype.slice.call(arguments).join(" ");h._warnedOnce[o]||(h.warn(o),h._warnedOnce[o]=!0)},h.deprecated=function(o,r,s){o[r]=h.chain(function(){h.warnOnce("ðŸ”… deprecated ðŸ”…",s)},o[r])},h.nextId=function(){return h._nextId++},h.indexOf=function(o,r){if(o.indexOf)return o.indexOf(r);for(var s=0;s<o.length;s++)if(o[s]===r)return s;return-1},h.map=function(o,r){if(o.map)return o.map(r);for(var s=[],u=0;u<o.length;u+=1)s.push(r(o[u]));return s},h.topologicalSort=function(o){var r=[],s=[],u=[];for(var i in o)!s[i]&&!u[i]&&h._topologicalSort(i,s,u,o,r);return r},h._topologicalSort=function(o,r,s,u,i){var f=u[o]||[];s[o]=!0;for(var l=0;l<f.length;l+=1){var t=f[l];s[t]||r[t]||h._topologicalSort(t,r,s,u,i)}s[o]=!1,r[o]=!0,i.push(o)},h.chain=function(){for(var o=[],r=0;r<arguments.length;r+=1){var s=arguments[r];s._chained?o.push.apply(o,s._chained):o.push(s)}var u=function(){for(var i,f=new Array(arguments.length),l=0,t=arguments.length;l<t;l++)f[l]=arguments[l];for(l=0;l<o.length;l+=1){var a=o[l].apply(i,f);typeof a<"u"&&(i=a)}return i};return u._chained=o,u},h.chainPathBefore=function(o,r,s){return h.set(o,r,h.chain(s,h.get(o,r)))},h.chainPathAfter=function(o,r,s){return h.set(o,r,h.chain(h.get(o,r),s))},h.setDecomp=function(o){h._decomp=o},h.getDecomp=function(){var o=h._decomp;try{!o&&typeof window<"u"&&(o=window.decomp),!o&&typeof ue<"u"&&(o=ue.decomp)}catch{o=null}return o}})()}),(function(w,T){var h={};w.exports=h,(function(){h.create=function(e){var o={min:{x:0,y:0},max:{x:0,y:0}};return e&&h.update(o,e),o},h.update=function(e,o,r){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var s=0;s<o.length;s++){var u=o[s];u.x>e.max.x&&(e.max.x=u.x),u.x<e.min.x&&(e.min.x=u.x),u.y>e.max.y&&(e.max.y=u.y),u.y<e.min.y&&(e.min.y=u.y)}r&&(r.x>0?e.max.x+=r.x:e.min.x+=r.x,r.y>0?e.max.y+=r.y:e.min.y+=r.y)},h.contains=function(e,o){return o.x>=e.min.x&&o.x<=e.max.x&&o.y>=e.min.y&&o.y<=e.max.y},h.overlaps=function(e,o){return e.min.x<=o.max.x&&e.max.x>=o.min.x&&e.max.y>=o.min.y&&e.min.y<=o.max.y},h.translate=function(e,o){e.min.x+=o.x,e.max.x+=o.x,e.min.y+=o.y,e.max.y+=o.y},h.shift=function(e,o){var r=e.max.x-e.min.x,s=e.max.y-e.min.y;e.min.x=o.x,e.max.x=o.x+r,e.min.y=o.y,e.max.y=o.y+s}})()}),(function(w,T){var h={};w.exports=h,(function(){h.create=function(e,o){return{x:e||0,y:o||0}},h.clone=function(e){return{x:e.x,y:e.y}},h.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},h.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},h.rotate=function(e,o,r){var s=Math.cos(o),u=Math.sin(o);r||(r={});var i=e.x*s-e.y*u;return r.y=e.x*u+e.y*s,r.x=i,r},h.rotateAbout=function(e,o,r,s){var u=Math.cos(o),i=Math.sin(o);s||(s={});var f=r.x+((e.x-r.x)*u-(e.y-r.y)*i);return s.y=r.y+((e.x-r.x)*i+(e.y-r.y)*u),s.x=f,s},h.normalise=function(e){var o=h.magnitude(e);return o===0?{x:0,y:0}:{x:e.x/o,y:e.y/o}},h.dot=function(e,o){return e.x*o.x+e.y*o.y},h.cross=function(e,o){return e.x*o.y-e.y*o.x},h.cross3=function(e,o,r){return(o.x-e.x)*(r.y-e.y)-(o.y-e.y)*(r.x-e.x)},h.add=function(e,o,r){return r||(r={}),r.x=e.x+o.x,r.y=e.y+o.y,r},h.sub=function(e,o,r){return r||(r={}),r.x=e.x-o.x,r.y=e.y-o.y,r},h.mult=function(e,o){return{x:e.x*o,y:e.y*o}},h.div=function(e,o){return{x:e.x/o,y:e.y/o}},h.perp=function(e,o){return o=o===!0?-1:1,{x:o*-e.y,y:o*e.x}},h.neg=function(e){return{x:-e.x,y:-e.y}},h.angle=function(e,o){return Math.atan2(o.y-e.y,o.x-e.x)},h._temp=[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()]})()}),(function(w,T,h){var e={};w.exports=e;var o=h(2),r=h(0);(function(){e.create=function(s,u){for(var i=[],f=0;f<s.length;f++){var l=s[f],t={x:l.x,y:l.y,index:f,body:u,isInternal:!1};i.push(t)}return i},e.fromPath=function(s,u){var i=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,f=[];return s.replace(i,function(l,t,a){f.push({x:parseFloat(t),y:parseFloat(a)})}),e.create(f,u)},e.centre=function(s){for(var u=e.area(s,!0),i={x:0,y:0},f,l,t,a=0;a<s.length;a++)t=(a+1)%s.length,f=o.cross(s[a],s[t]),l=o.mult(o.add(s[a],s[t]),f),i=o.add(i,l);return o.div(i,6*u)},e.mean=function(s){for(var u={x:0,y:0},i=0;i<s.length;i++)u.x+=s[i].x,u.y+=s[i].y;return o.div(u,s.length)},e.area=function(s,u){for(var i=0,f=s.length-1,l=0;l<s.length;l++)i+=(s[f].x-s[l].x)*(s[f].y+s[l].y),f=l;return u?i/2:Math.abs(i)/2},e.inertia=function(s,u){for(var i=0,f=0,l=s,t,a,n=0;n<l.length;n++)a=(n+1)%l.length,t=Math.abs(o.cross(l[a],l[n])),i+=t*(o.dot(l[a],l[a])+o.dot(l[a],l[n])+o.dot(l[n],l[n])),f+=t;return u/6*(i/f)},e.translate=function(s,u,i){i=typeof i<"u"?i:1;var f=s.length,l=u.x*i,t=u.y*i,a;for(a=0;a<f;a++)s[a].x+=l,s[a].y+=t;return s},e.rotate=function(s,u,i){if(u!==0){var f=Math.cos(u),l=Math.sin(u),t=i.x,a=i.y,n=s.length,c,g,S,b;for(b=0;b<n;b++)c=s[b],g=c.x-t,S=c.y-a,c.x=t+(g*f-S*l),c.y=a+(g*l+S*f);return s}},e.contains=function(s,u){for(var i=u.x,f=u.y,l=s.length,t=s[l-1],a,n=0;n<l;n++){if(a=s[n],(i-t.x)*(a.y-t.y)+(f-t.y)*(t.x-a.x)>0)return!1;t=a}return!0},e.scale=function(s,u,i,f){if(u===1&&i===1)return s;f=f||e.centre(s);for(var l,t,a=0;a<s.length;a++)l=s[a],t=o.sub(l,f),s[a].x=f.x+t.x*u,s[a].y=f.y+t.y*i;return s},e.chamfer=function(s,u,i,f,l){typeof u=="number"?u=[u]:u=u||[8],i=typeof i<"u"?i:-1,f=f||2,l=l||14;for(var t=[],a=0;a<s.length;a++){var n=s[a-1>=0?a-1:s.length-1],c=s[a],g=s[(a+1)%s.length],S=u[a<u.length?a:u.length-1];if(S===0){t.push(c);continue}var b=o.normalise({x:c.y-n.y,y:n.x-c.x}),B=o.normalise({x:g.y-c.y,y:c.x-g.x}),d=Math.sqrt(2*Math.pow(S,2)),m=o.mult(r.clone(b),S),y=o.normalise(o.mult(o.add(b,B),.5)),p=o.sub(c,o.mult(y,d)),k=i;i===-1&&(k=Math.pow(S,.32)*1.75),k=r.clamp(k,f,l),k%2===1&&(k+=1);for(var x=Math.acos(o.dot(b,B)),C=x/k,M=0;M<k;M++)t.push(o.add(o.rotate(m,C*M),p))}return t},e.clockwiseSort=function(s){var u=e.mean(s);return s.sort(function(i,f){return o.angle(u,i)-o.angle(u,f)}),s},e.isConvex=function(s){var u=0,i=s.length,f,l,t,a;if(i<3)return null;for(f=0;f<i;f++)if(l=(f+1)%i,t=(f+2)%i,a=(s[l].x-s[f].x)*(s[t].y-s[l].y),a-=(s[l].y-s[f].y)*(s[t].x-s[l].x),a<0?u|=1:a>0&&(u|=2),u===3)return!1;return u!==0?!0:null},e.hull=function(s){var u=[],i=[],f,l;for(s=s.slice(0),s.sort(function(t,a){var n=t.x-a.x;return n!==0?n:t.y-a.y}),l=0;l<s.length;l+=1){for(f=s[l];i.length>=2&&o.cross3(i[i.length-2],i[i.length-1],f)<=0;)i.pop();i.push(f)}for(l=s.length-1;l>=0;l-=1){for(f=s[l];u.length>=2&&o.cross3(u[u.length-2],u[u.length-1],f)<=0;)u.pop();u.push(f)}return u.pop(),i.pop(),u.concat(i)}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(3),r=h(2),s=h(7),u=h(0),i=h(1),f=h(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var a={id:u.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:o.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},n=u.extend(a,t);return l(n,t),n},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var l=function(t,a){a=a||{},e.set(t,{bounds:t.bounds||i.create(t.vertices),positionPrev:t.positionPrev||r.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),o.rotate(t.vertices,t.angle,t.position),f.rotate(t.axes,t.angle),i.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:a.axes||t.axes,area:a.area||t.area,mass:a.mass||t.mass,inertia:a.inertia||t.inertia});var n=t.isStatic?"#14151f":u.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),c=t.isStatic?"#555":"#ccc",g=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||n,t.render.strokeStyle=t.render.strokeStyle||c,t.render.lineWidth=t.render.lineWidth||g,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,a,n){var c;typeof a=="string"&&(c=a,a={},a[c]=n);for(c in a)if(Object.prototype.hasOwnProperty.call(a,c))switch(n=a[c],c){case"isStatic":e.setStatic(t,n);break;case"isSleeping":s.set(t,n);break;case"mass":e.setMass(t,n);break;case"density":e.setDensity(t,n);break;case"inertia":e.setInertia(t,n);break;case"vertices":e.setVertices(t,n);break;case"position":e.setPosition(t,n);break;case"angle":e.setAngle(t,n);break;case"velocity":e.setVelocity(t,n);break;case"angularVelocity":e.setAngularVelocity(t,n);break;case"speed":e.setSpeed(t,n);break;case"angularSpeed":e.setAngularSpeed(t,n);break;case"parts":e.setParts(t,n);break;case"centre":e.setCentre(t,n);break;default:t[c]=n}},e.setStatic=function(t,a){for(var n=0;n<t.parts.length;n++){var c=t.parts[n];a?(c.isStatic||(c._original={restitution:c.restitution,friction:c.friction,mass:c.mass,inertia:c.inertia,density:c.density,inverseMass:c.inverseMass,inverseInertia:c.inverseInertia}),c.restitution=0,c.friction=1,c.mass=c.inertia=c.density=1/0,c.inverseMass=c.inverseInertia=0,c.positionPrev.x=c.position.x,c.positionPrev.y=c.position.y,c.anglePrev=c.angle,c.angularVelocity=0,c.speed=0,c.angularSpeed=0,c.motion=0):c._original&&(c.restitution=c._original.restitution,c.friction=c._original.friction,c.mass=c._original.mass,c.inertia=c._original.inertia,c.density=c._original.density,c.inverseMass=c._original.inverseMass,c.inverseInertia=c._original.inverseInertia,c._original=null),c.isStatic=a}},e.setMass=function(t,a){var n=t.inertia/(t.mass/6);t.inertia=n*(a/6),t.inverseInertia=1/t.inertia,t.mass=a,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,a){e.setMass(t,a*t.area),t.density=a},e.setInertia=function(t,a){t.inertia=a,t.inverseInertia=1/t.inertia},e.setVertices=function(t,a){a[0].body===t?t.vertices=a:t.vertices=o.create(a,t),t.axes=f.fromVertices(t.vertices),t.area=o.area(t.vertices),e.setMass(t,t.density*t.area);var n=o.centre(t.vertices);o.translate(t.vertices,n,-1),e.setInertia(t,e._inertiaScale*o.inertia(t.vertices,t.mass)),o.translate(t.vertices,t.position),i.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,a,n){var c;for(a=a.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,c=0;c<a.length;c++){var g=a[c];g!==t&&(g.parent=t,t.parts.push(g))}if(t.parts.length!==1){if(n=typeof n<"u"?n:!0,n){var S=[];for(c=0;c<a.length;c++)S=S.concat(a[c].vertices);o.clockwiseSort(S);var b=o.hull(S),B=o.centre(b);e.setVertices(t,b),o.translate(t.vertices,B)}var d=e._totalProperties(t);t.area=d.area,t.parent=t,t.position.x=d.centre.x,t.position.y=d.centre.y,t.positionPrev.x=d.centre.x,t.positionPrev.y=d.centre.y,e.setMass(t,d.mass),e.setInertia(t,d.inertia),e.setPosition(t,d.centre)}},e.setCentre=function(t,a,n){n?(t.positionPrev.x+=a.x,t.positionPrev.y+=a.y,t.position.x+=a.x,t.position.y+=a.y):(t.positionPrev.x=a.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=a.y-(t.position.y-t.positionPrev.y),t.position.x=a.x,t.position.y=a.y)},e.setPosition=function(t,a,n){var c=r.sub(a,t.position);n?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=c.x,t.velocity.y=c.y,t.speed=r.magnitude(c)):(t.positionPrev.x+=c.x,t.positionPrev.y+=c.y);for(var g=0;g<t.parts.length;g++){var S=t.parts[g];S.position.x+=c.x,S.position.y+=c.y,o.translate(S.vertices,c),i.update(S.bounds,S.vertices,t.velocity)}},e.setAngle=function(t,a,n){var c=a-t.angle;n?(t.anglePrev=t.angle,t.angularVelocity=c,t.angularSpeed=Math.abs(c)):t.anglePrev+=c;for(var g=0;g<t.parts.length;g++){var S=t.parts[g];S.angle+=c,o.rotate(S.vertices,c,t.position),f.rotate(S.axes,c),i.update(S.bounds,S.vertices,t.velocity),g>0&&r.rotateAbout(S.position,c,t.position,S.position)}},e.setVelocity=function(t,a){var n=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-a.x*n,t.positionPrev.y=t.position.y-a.y*n,t.velocity.x=(t.position.x-t.positionPrev.x)/n,t.velocity.y=(t.position.y-t.positionPrev.y)/n,t.speed=r.magnitude(t.velocity)},e.getVelocity=function(t){var a=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*a,y:(t.position.y-t.positionPrev.y)*a}},e.getSpeed=function(t){return r.magnitude(e.getVelocity(t))},e.setSpeed=function(t,a){e.setVelocity(t,r.mult(r.normalise(e.getVelocity(t)),a))},e.setAngularVelocity=function(t,a){var n=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-a*n,t.angularVelocity=(t.angle-t.anglePrev)/n,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,a){e.setAngularVelocity(t,u.sign(e.getAngularVelocity(t))*a)},e.translate=function(t,a,n){e.setPosition(t,r.add(t.position,a),n)},e.rotate=function(t,a,n,c){if(!n)e.setAngle(t,t.angle+a,c);else{var g=Math.cos(a),S=Math.sin(a),b=t.position.x-n.x,B=t.position.y-n.y;e.setPosition(t,{x:n.x+(b*g-B*S),y:n.y+(b*S+B*g)},c),e.setAngle(t,t.angle+a,c)}},e.scale=function(t,a,n,c){var g=0,S=0;c=c||t.position;for(var b=0;b<t.parts.length;b++){var B=t.parts[b];o.scale(B.vertices,a,n,c),B.axes=f.fromVertices(B.vertices),B.area=o.area(B.vertices),e.setMass(B,t.density*B.area),o.translate(B.vertices,{x:-B.position.x,y:-B.position.y}),e.setInertia(B,e._inertiaScale*o.inertia(B.vertices,B.mass)),o.translate(B.vertices,{x:B.position.x,y:B.position.y}),b>0&&(g+=B.area,S+=B.inertia),B.position.x=c.x+(B.position.x-c.x)*a,B.position.y=c.y+(B.position.y-c.y)*n,i.update(B.bounds,B.vertices,t.velocity)}t.parts.length>1&&(t.area=g,t.isStatic||(e.setMass(t,t.density*g),e.setInertia(t,S))),t.circleRadius&&(a===n?t.circleRadius*=a:t.circleRadius=null)},e.update=function(t,a){a=(typeof a<"u"?a:1e3/60)*t.timeScale;var n=a*a,c=e._timeCorrection?a/(t.deltaTime||a):1,g=1-t.frictionAir*(a/u._baseDelta),S=(t.position.x-t.positionPrev.x)*c,b=(t.position.y-t.positionPrev.y)*c;t.velocity.x=S*g+t.force.x/t.mass*n,t.velocity.y=b*g+t.force.y/t.mass*n,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=a,t.angularVelocity=(t.angle-t.anglePrev)*g*c+t.torque/t.inertia*n,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var B=0;B<t.parts.length;B++){var d=t.parts[B];o.translate(d.vertices,t.velocity),B>0&&(d.position.x+=t.velocity.x,d.position.y+=t.velocity.y),t.angularVelocity!==0&&(o.rotate(d.vertices,t.angularVelocity,t.position),f.rotate(d.axes,t.angularVelocity),B>0&&r.rotateAbout(d.position,t.angularVelocity,t.position,d.position)),i.update(d.bounds,d.vertices,t.velocity)}},e.updateVelocities=function(t){var a=e._baseDelta/t.deltaTime,n=t.velocity;n.x=(t.position.x-t.positionPrev.x)*a,n.y=(t.position.y-t.positionPrev.y)*a,t.speed=Math.sqrt(n.x*n.x+n.y*n.y),t.angularVelocity=(t.angle-t.anglePrev)*a,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,a,n){var c={x:a.x-t.position.x,y:a.y-t.position.y};t.force.x+=n.x,t.force.y+=n.y,t.torque+=c.x*n.y-c.y*n.x},e._totalProperties=function(t){for(var a={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=t.parts.length===1?0:1;n<t.parts.length;n++){var c=t.parts[n],g=c.mass!==1/0?c.mass:1;a.mass+=g,a.area+=c.area,a.inertia+=c.inertia,a.centre=r.add(a.centre,r.mult(c.position,g))}return a.centre=r.div(a.centre,a.mass),a}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(0);(function(){e.on=function(r,s,u){for(var i=s.split(" "),f,l=0;l<i.length;l++)f=i[l],r.events=r.events||{},r.events[f]=r.events[f]||[],r.events[f].push(u);return u},e.off=function(r,s,u){if(!s){r.events={};return}typeof s=="function"&&(u=s,s=o.keys(r.events).join(" "));for(var i=s.split(" "),f=0;f<i.length;f++){var l=r.events[i[f]],t=[];if(u&&l)for(var a=0;a<l.length;a++)l[a]!==u&&t.push(l[a]);r.events[i[f]]=t}},e.trigger=function(r,s,u){var i,f,l,t,a=r.events;if(a&&o.keys(a).length>0){u||(u={}),i=s.split(" ");for(var n=0;n<i.length;n++)if(f=i[n],l=a[f],l){t=o.clone(u,!1),t.name=f,t.source=r;for(var c=0;c<l.length;c++)l[c].apply(r,[t])}}}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(5),r=h(0),s=h(1),u=h(4);(function(){e.create=function(i){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},i)},e.setModified=function(i,f,l,t){if(i.isModified=f,f&&i.cache&&(i.cache.allBodies=null,i.cache.allConstraints=null,i.cache.allComposites=null),l&&i.parent&&e.setModified(i.parent,f,l,t),t)for(var a=0;a<i.composites.length;a++){var n=i.composites[a];e.setModified(n,f,l,t)}},e.add=function(i,f){var l=[].concat(f);o.trigger(i,"beforeAdd",{object:f});for(var t=0;t<l.length;t++){var a=l[t];switch(a.type){case"body":if(a.parent!==a){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(i,a);break;case"constraint":e.addConstraint(i,a);break;case"composite":e.addComposite(i,a);break;case"mouseConstraint":e.addConstraint(i,a.constraint);break}}return o.trigger(i,"afterAdd",{object:f}),i},e.remove=function(i,f,l){var t=[].concat(f);o.trigger(i,"beforeRemove",{object:f});for(var a=0;a<t.length;a++){var n=t[a];switch(n.type){case"body":e.removeBody(i,n,l);break;case"constraint":e.removeConstraint(i,n,l);break;case"composite":e.removeComposite(i,n,l);break;case"mouseConstraint":e.removeConstraint(i,n.constraint);break}}return o.trigger(i,"afterRemove",{object:f}),i},e.addComposite=function(i,f){return i.composites.push(f),f.parent=i,e.setModified(i,!0,!0,!1),i},e.removeComposite=function(i,f,l){var t=r.indexOf(i.composites,f);if(t!==-1){var a=e.allBodies(f);e.removeCompositeAt(i,t);for(var n=0;n<a.length;n++)a[n].sleepCounter=0}if(l)for(var n=0;n<i.composites.length;n++)e.removeComposite(i.composites[n],f,!0);return i},e.removeCompositeAt=function(i,f){return i.composites.splice(f,1),e.setModified(i,!0,!0,!1),i},e.addBody=function(i,f){return i.bodies.push(f),e.setModified(i,!0,!0,!1),i},e.removeBody=function(i,f,l){var t=r.indexOf(i.bodies,f);if(t!==-1&&(e.removeBodyAt(i,t),f.sleepCounter=0),l)for(var a=0;a<i.composites.length;a++)e.removeBody(i.composites[a],f,!0);return i},e.removeBodyAt=function(i,f){return i.bodies.splice(f,1),e.setModified(i,!0,!0,!1),i},e.addConstraint=function(i,f){return i.constraints.push(f),e.setModified(i,!0,!0,!1),i},e.removeConstraint=function(i,f,l){var t=r.indexOf(i.constraints,f);if(t!==-1&&e.removeConstraintAt(i,t),l)for(var a=0;a<i.composites.length;a++)e.removeConstraint(i.composites[a],f,!0);return i},e.removeConstraintAt=function(i,f){return i.constraints.splice(f,1),e.setModified(i,!0,!0,!1),i},e.clear=function(i,f,l){if(l)for(var t=0;t<i.composites.length;t++)e.clear(i.composites[t],f,!0);return f?i.bodies=i.bodies.filter(function(a){return a.isStatic}):i.bodies.length=0,i.constraints.length=0,i.composites.length=0,e.setModified(i,!0,!0,!1),i},e.allBodies=function(i){if(i.cache&&i.cache.allBodies)return i.cache.allBodies;for(var f=[].concat(i.bodies),l=0;l<i.composites.length;l++)f=f.concat(e.allBodies(i.composites[l]));return i.cache&&(i.cache.allBodies=f),f},e.allConstraints=function(i){if(i.cache&&i.cache.allConstraints)return i.cache.allConstraints;for(var f=[].concat(i.constraints),l=0;l<i.composites.length;l++)f=f.concat(e.allConstraints(i.composites[l]));return i.cache&&(i.cache.allConstraints=f),f},e.allComposites=function(i){if(i.cache&&i.cache.allComposites)return i.cache.allComposites;for(var f=[].concat(i.composites),l=0;l<i.composites.length;l++)f=f.concat(e.allComposites(i.composites[l]));return i.cache&&(i.cache.allComposites=f),f},e.get=function(i,f,l){var t,a;switch(l){case"body":t=e.allBodies(i);break;case"constraint":t=e.allConstraints(i);break;case"composite":t=e.allComposites(i).concat(i);break}return t?(a=t.filter(function(n){return n.id.toString()===f.toString()}),a.length===0?null:a[0]):null},e.move=function(i,f,l){return e.remove(i,f),e.add(l,f),i},e.rebase=function(i){for(var f=e.allBodies(i).concat(e.allConstraints(i)).concat(e.allComposites(i)),l=0;l<f.length;l++)f[l].id=r.nextId();return i},e.translate=function(i,f,l){for(var t=l?e.allBodies(i):i.bodies,a=0;a<t.length;a++)u.translate(t[a],f);return i},e.rotate=function(i,f,l,t){for(var a=Math.cos(f),n=Math.sin(f),c=t?e.allBodies(i):i.bodies,g=0;g<c.length;g++){var S=c[g],b=S.position.x-l.x,B=S.position.y-l.y;u.setPosition(S,{x:l.x+(b*a-B*n),y:l.y+(b*n+B*a)}),u.rotate(S,f)}return i},e.scale=function(i,f,l,t,a){for(var n=a?e.allBodies(i):i.bodies,c=0;c<n.length;c++){var g=n[c],S=g.position.x-t.x,b=g.position.y-t.y;u.setPosition(g,{x:t.x+S*f,y:t.y+b*l}),u.scale(g,f,l)}return i},e.bounds=function(i){for(var f=e.allBodies(i),l=[],t=0;t<f.length;t+=1){var a=f[t];l.push(a.bounds.min,a.bounds.max)}return s.create(l)}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(4),r=h(5),s=h(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(u,i){for(var f=i/s._baseDelta,l=e._motionSleepThreshold,t=0;t<u.length;t++){var a=u[t],n=o.getSpeed(a),c=o.getAngularSpeed(a),g=n*n+c*c;if(a.force.x!==0||a.force.y!==0){e.set(a,!1);continue}var S=Math.min(a.motion,g),b=Math.max(a.motion,g);a.motion=e._minBias*S+(1-e._minBias)*b,a.sleepThreshold>0&&a.motion<l?(a.sleepCounter+=1,a.sleepCounter>=a.sleepThreshold/f&&e.set(a,!0)):a.sleepCounter>0&&(a.sleepCounter-=1)}},e.afterCollisions=function(u){for(var i=e._motionSleepThreshold,f=0;f<u.length;f++){var l=u[f];if(l.isActive){var t=l.collision,a=t.bodyA.parent,n=t.bodyB.parent;if(!(a.isSleeping&&n.isSleeping||a.isStatic||n.isStatic)&&(a.isSleeping||n.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:n,g=c===a?n:a;!c.isStatic&&g.motion>i&&e.set(c,!1)}}}},e.set=function(u,i){var f=u.isSleeping;i?(u.isSleeping=!0,u.sleepCounter=u.sleepThreshold,u.positionImpulse.x=0,u.positionImpulse.y=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.speed=0,u.angularSpeed=0,u.motion=0,f||r.trigger(u,"sleepStart")):(u.isSleeping=!1,u.sleepCounter=0,f&&r.trigger(u,"sleepEnd"))}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(3),r=h(9);(function(){var s=[],u={overlap:0,axis:null},i={overlap:0,axis:null};e.create=function(f,l){return{pair:null,collided:!1,bodyA:f,bodyB:l,parentA:f.parent,parentB:l.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},e.collides=function(f,l,t){if(e._overlapAxes(u,f.vertices,l.vertices,f.axes),u.overlap<=0||(e._overlapAxes(i,l.vertices,f.vertices,l.axes),i.overlap<=0))return null;var a=t&&t.table[r.id(f,l)],n;a?n=a.collision:(n=e.create(f,l),n.collided=!0,n.bodyA=f.id<l.id?f:l,n.bodyB=f.id<l.id?l:f,n.parentA=n.bodyA.parent,n.parentB=n.bodyB.parent),f=n.bodyA,l=n.bodyB;var c;u.overlap<i.overlap?c=u:c=i;var g=n.normal,S=n.tangent,b=n.penetration,B=n.supports,d=c.overlap,m=c.axis,y=m.x,p=m.y,k=l.position.x-f.position.x,x=l.position.y-f.position.y;y*k+p*x>=0&&(y=-y,p=-p),g.x=y,g.y=p,S.x=-p,S.y=y,b.x=y*d,b.y=p*d,n.depth=d;var C=e._findSupports(f,l,g,1),M=0;if(o.contains(f.vertices,C[0])&&(B[M++]=C[0]),o.contains(f.vertices,C[1])&&(B[M++]=C[1]),M<2){var P=e._findSupports(l,f,g,-1);o.contains(l.vertices,P[0])&&(B[M++]=P[0]),M<2&&o.contains(l.vertices,P[1])&&(B[M++]=P[1])}return M===0&&(B[M++]=C[0]),n.supportCount=M,n},e._overlapAxes=function(f,l,t,a){var n=l.length,c=t.length,g=l[0].x,S=l[0].y,b=t[0].x,B=t[0].y,d=a.length,m=Number.MAX_VALUE,y=0,p,k,x,C,M,P;for(M=0;M<d;M++){var I=a[M],E=I.x,A=I.y,R=g*E+S*A,O=b*E+B*A,F=R,W=O;for(P=1;P<n;P+=1)C=l[P].x*E+l[P].y*A,C>F?F=C:C<R&&(R=C);for(P=1;P<c;P+=1)C=t[P].x*E+t[P].y*A,C>W?W=C:C<O&&(O=C);if(k=F-O,x=W-R,p=k<x?k:x,p<m&&(m=p,y=M,p<=0))break}f.axis=a[y],f.overlap=m},e._findSupports=function(f,l,t,a){var n=l.vertices,c=n.length,g=f.position.x,S=f.position.y,b=t.x*a,B=t.y*a,d=n[0],m=d,y=b*(g-m.x)+B*(S-m.y),p,k,x;for(x=1;x<c;x+=1)m=n[x],k=b*(g-m.x)+B*(S-m.y),k<y&&(y=k,d=m);return p=n[(c+d.index-1)%c],y=b*(g-p.x)+B*(S-p.y),m=n[(d.index+1)%c],b*(g-m.x)+B*(S-m.y)<y?(s[0]=d,s[1]=m,s):(s[0]=d,s[1]=p,s)}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(16);(function(){e.create=function(r,s){var u=r.bodyA,i=r.bodyB,f={id:e.id(u,i),bodyA:u,bodyB:i,collision:r,contacts:[o.create(),o.create()],contactCount:0,separation:0,isActive:!0,isSensor:u.isSensor||i.isSensor,timeCreated:s,timeUpdated:s,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(f,r,s),f},e.update=function(r,s,u){var i=s.supports,f=s.supportCount,l=r.contacts,t=s.parentA,a=s.parentB;r.isActive=!0,r.timeUpdated=u,r.collision=s,r.separation=s.depth,r.inverseMass=t.inverseMass+a.inverseMass,r.friction=t.friction<a.friction?t.friction:a.friction,r.frictionStatic=t.frictionStatic>a.frictionStatic?t.frictionStatic:a.frictionStatic,r.restitution=t.restitution>a.restitution?t.restitution:a.restitution,r.slop=t.slop>a.slop?t.slop:a.slop,r.contactCount=f,s.pair=r;var n=i[0],c=l[0],g=i[1],S=l[1];(S.vertex===n||c.vertex===g)&&(l[1]=c,l[0]=c=S,S=l[1]),c.vertex=n,S.vertex=g},e.setActive=function(r,s,u){s?(r.isActive=!0,r.timeUpdated=u):(r.isActive=!1,r.contactCount=0)},e.id=function(r,s){return r.id<s.id?r.id.toString(36)+":"+s.id.toString(36):s.id.toString(36)+":"+r.id.toString(36)}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(3),r=h(2),s=h(7),u=h(1),i=h(11),f=h(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(l){var t=l;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var a=t.bodyA?r.add(t.bodyA.position,t.pointA):t.pointA,n=t.bodyB?r.add(t.bodyB.position,t.pointB):t.pointB,c=r.magnitude(r.sub(a,n));t.length=typeof t.length<"u"?t.length:c,t.id=t.id||f.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var g={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(g.type="pin",g.anchors=!1):t.stiffness<.9&&(g.type="spring"),t.render=f.extend(g,t.render),t},e.preSolveAll=function(l){for(var t=0;t<l.length;t+=1){var a=l[t],n=a.constraintImpulse;a.isStatic||n.x===0&&n.y===0&&n.angle===0||(a.position.x+=n.x,a.position.y+=n.y,a.angle+=n.angle)}},e.solveAll=function(l,t){for(var a=f.clamp(t/f._baseDelta,0,1),n=0;n<l.length;n+=1){var c=l[n],g=!c.bodyA||c.bodyA&&c.bodyA.isStatic,S=!c.bodyB||c.bodyB&&c.bodyB.isStatic;(g||S)&&e.solve(l[n],a)}for(n=0;n<l.length;n+=1)c=l[n],g=!c.bodyA||c.bodyA&&c.bodyA.isStatic,S=!c.bodyB||c.bodyB&&c.bodyB.isStatic,!g&&!S&&e.solve(l[n],a)},e.solve=function(l,t){var a=l.bodyA,n=l.bodyB,c=l.pointA,g=l.pointB;if(!(!a&&!n)){a&&!a.isStatic&&(r.rotate(c,a.angle-l.angleA,c),l.angleA=a.angle),n&&!n.isStatic&&(r.rotate(g,n.angle-l.angleB,g),l.angleB=n.angle);var S=c,b=g;if(a&&(S=r.add(a.position,c)),n&&(b=r.add(n.position,g)),!(!S||!b)){var B=r.sub(S,b),d=r.magnitude(B);d<e._minLength&&(d=e._minLength);var m=(d-l.length)/d,y=l.stiffness>=1||l.length===0,p=y?l.stiffness*t:l.stiffness*t*t,k=l.damping*t,x=r.mult(B,m*p),C=(a?a.inverseMass:0)+(n?n.inverseMass:0),M=(a?a.inverseInertia:0)+(n?n.inverseInertia:0),P=C+M,I,E,A,R,O;if(k>0){var F=r.create();A=r.div(B,d),O=r.sub(n&&r.sub(n.position,n.positionPrev)||F,a&&r.sub(a.position,a.positionPrev)||F),R=r.dot(A,O)}a&&!a.isStatic&&(E=a.inverseMass/C,a.constraintImpulse.x-=x.x*E,a.constraintImpulse.y-=x.y*E,a.position.x-=x.x*E,a.position.y-=x.y*E,k>0&&(a.positionPrev.x-=k*A.x*R*E,a.positionPrev.y-=k*A.y*R*E),I=r.cross(c,x)/P*e._torqueDampen*a.inverseInertia*(1-l.angularStiffness),a.constraintImpulse.angle-=I,a.angle-=I),n&&!n.isStatic&&(E=n.inverseMass/C,n.constraintImpulse.x+=x.x*E,n.constraintImpulse.y+=x.y*E,n.position.x+=x.x*E,n.position.y+=x.y*E,k>0&&(n.positionPrev.x+=k*A.x*R*E,n.positionPrev.y+=k*A.y*R*E),I=r.cross(g,x)/P*e._torqueDampen*n.inverseInertia*(1-l.angularStiffness),n.constraintImpulse.angle+=I,n.angle+=I)}}},e.postSolveAll=function(l){for(var t=0;t<l.length;t++){var a=l[t],n=a.constraintImpulse;if(!(a.isStatic||n.x===0&&n.y===0&&n.angle===0)){s.set(a,!1);for(var c=0;c<a.parts.length;c++){var g=a.parts[c];o.translate(g.vertices,n),c>0&&(g.position.x+=n.x,g.position.y+=n.y),n.angle!==0&&(o.rotate(g.vertices,n.angle,a.position),i.rotate(g.axes,n.angle),c>0&&r.rotateAbout(g.position,n.angle,a.position,g.position)),u.update(g.bounds,g.vertices,a.velocity)}n.angle*=e._warming,n.x*=e._warming,n.y*=e._warming}}},e.pointAWorld=function(l){return{x:(l.bodyA?l.bodyA.position.x:0)+(l.pointA?l.pointA.x:0),y:(l.bodyA?l.bodyA.position.y:0)+(l.pointA?l.pointA.y:0)}},e.pointBWorld=function(l){return{x:(l.bodyB?l.bodyB.position.x:0)+(l.pointB?l.pointB.x:0),y:(l.bodyB?l.bodyB.position.y:0)+(l.pointB?l.pointB.y:0)}},e.currentLength=function(l){var t=(l.bodyA?l.bodyA.position.x:0)+(l.pointA?l.pointA.x:0),a=(l.bodyA?l.bodyA.position.y:0)+(l.pointA?l.pointA.y:0),n=(l.bodyB?l.bodyB.position.x:0)+(l.pointB?l.pointB.x:0),c=(l.bodyB?l.bodyB.position.y:0)+(l.pointB?l.pointB.y:0),g=t-n,S=a-c;return Math.sqrt(g*g+S*S)}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(2),r=h(0);(function(){e.fromVertices=function(s){for(var u={},i=0;i<s.length;i++){var f=(i+1)%s.length,l=o.normalise({x:s[f].y-s[i].y,y:s[i].x-s[f].x}),t=l.y===0?1/0:l.x/l.y;t=t.toFixed(3).toString(),u[t]=l}return r.values(u)},e.rotate=function(s,u){if(u!==0)for(var i=Math.cos(u),f=Math.sin(u),l=0;l<s.length;l++){var t=s[l],a;a=t.x*i-t.y*f,t.y=t.x*f+t.y*i,t.x=a}}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(3),r=h(0),s=h(4),u=h(1),i=h(2);(function(){e.rectangle=function(f,l,t,a,n){n=n||{};var c={label:"Rectangle Body",position:{x:f,y:l},vertices:o.fromPath("L 0 0 L "+t+" 0 L "+t+" "+a+" L 0 "+a)};if(n.chamfer){var g=n.chamfer;c.vertices=o.chamfer(c.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete n.chamfer}return s.create(r.extend({},c,n))},e.trapezoid=function(f,l,t,a,n,c){c=c||{},n>=1&&r.warn("Bodies.trapezoid: slope parameter must be < 1."),n*=.5;var g=(1-n*2)*t,S=t*n,b=S+g,B=b+S,d;n<.5?d="L 0 0 L "+S+" "+-a+" L "+b+" "+-a+" L "+B+" 0":d="L 0 0 L "+b+" "+-a+" L "+B+" 0";var m={label:"Trapezoid Body",position:{x:f,y:l},vertices:o.fromPath(d)};if(c.chamfer){var y=c.chamfer;m.vertices=o.chamfer(m.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete c.chamfer}return s.create(r.extend({},m,c))},e.circle=function(f,l,t,a,n){a=a||{};var c={label:"Circle Body",circleRadius:t};n=n||25;var g=Math.ceil(Math.max(10,Math.min(n,t)));return g%2===1&&(g+=1),e.polygon(f,l,g,t,r.extend({},c,a))},e.polygon=function(f,l,t,a,n){if(n=n||{},t<3)return e.circle(f,l,a,n);for(var c=2*Math.PI/t,g="",S=c*.5,b=0;b<t;b+=1){var B=S+b*c,d=Math.cos(B)*a,m=Math.sin(B)*a;g+="L "+d.toFixed(3)+" "+m.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:f,y:l},vertices:o.fromPath(g)};if(n.chamfer){var p=n.chamfer;y.vertices=o.chamfer(y.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete n.chamfer}return s.create(r.extend({},y,n))},e.fromVertices=function(f,l,t,a,n,c,g,S){var b=r.getDecomp(),B,d,m,y,p,k,x,C,M,P,I;for(B=!!(b&&b.quickDecomp),a=a||{},m=[],n=typeof n<"u"?n:!1,c=typeof c<"u"?c:.01,g=typeof g<"u"?g:10,S=typeof S<"u"?S:.01,r.isArray(t[0])||(t=[t]),P=0;P<t.length;P+=1)if(k=t[P],y=o.isConvex(k),p=!y,p&&!B&&r.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),y||!B)y?k=o.clockwiseSort(k):k=o.hull(k),m.push({position:{x:f,y:l},vertices:k});else{var E=k.map(function(D){return[D.x,D.y]});b.makeCCW(E),c!==!1&&b.removeCollinearPoints(E,c),S!==!1&&b.removeDuplicatePoints&&b.removeDuplicatePoints(E,S);var A=b.quickDecomp(E);for(x=0;x<A.length;x++){var R=A[x],O=R.map(function(D){return{x:D[0],y:D[1]}});g>0&&o.area(O)<g||m.push({position:o.centre(O),vertices:O})}}for(x=0;x<m.length;x++)m[x]=s.create(r.extend(m[x],a));if(n){var F=5;for(x=0;x<m.length;x++){var W=m[x];for(C=x+1;C<m.length;C++){var V=m[C];if(u.overlaps(W.bounds,V.bounds)){var H=W.vertices,N=V.vertices;for(M=0;M<W.vertices.length;M++)for(I=0;I<V.vertices.length;I++){var J=i.magnitudeSquared(i.sub(H[(M+1)%H.length],N[I])),K=i.magnitudeSquared(i.sub(H[M],N[(I+1)%N.length]));J<F&&K<F&&(H[M].isInternal=!0,N[I].isInternal=!0)}}}}}return m.length>1?(d=s.create(r.extend({parts:m.slice(0)},a)),s.setPosition(d,{x:f,y:l}),d):m[0]}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(0),r=h(8);(function(){e.create=function(s){var u={bodies:[],collisions:[],pairs:null};return o.extend(u,s)},e.setBodies=function(s,u){s.bodies=u.slice(0)},e.clear=function(s){s.bodies=[],s.collisions=[]},e.collisions=function(s){var u=s.pairs,i=s.bodies,f=i.length,l=e.canCollide,t=r.collides,a=s.collisions,n=0,c,g;for(i.sort(e._compareBoundsX),c=0;c<f;c++){var S=i[c],b=S.bounds,B=S.bounds.max.x,d=S.bounds.max.y,m=S.bounds.min.y,y=S.isStatic||S.isSleeping,p=S.parts.length,k=p===1;for(g=c+1;g<f;g++){var x=i[g],C=x.bounds;if(C.min.x>B)break;if(!(d<C.min.y||m>C.max.y)&&!(y&&(x.isStatic||x.isSleeping))&&l(S.collisionFilter,x.collisionFilter)){var M=x.parts.length;if(k&&M===1){var P=t(S,x,u);P&&(a[n++]=P)}else for(var I=p>1?1:0,E=M>1?1:0,A=I;A<p;A++)for(var R=S.parts[A],b=R.bounds,O=E;O<M;O++){var F=x.parts[O],C=F.bounds;if(!(b.min.x>C.max.x||b.max.x<C.min.x||b.max.y<C.min.y||b.min.y>C.max.y)){var P=t(R,F,u);P&&(a[n++]=P)}}}}}return a.length!==n&&(a.length=n),a},e.canCollide=function(s,u){return s.group===u.group&&s.group!==0?s.group>0:(s.mask&u.category)!==0&&(u.mask&s.category)!==0},e._compareBoundsX=function(s,u){return s.bounds.min.x-u.bounds.min.x}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(0);(function(){e.create=function(r){var s={};return r||o.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=r||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(u){var i=e._getRelativeMousePosition(u,s.element,s.pixelRatio),f=u.changedTouches;f&&(s.button=0,u.preventDefault()),s.absolute.x=i.x,s.absolute.y=i.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=u},s.mousedown=function(u){var i=e._getRelativeMousePosition(u,s.element,s.pixelRatio),f=u.changedTouches;f?(s.button=0,u.preventDefault()):s.button=u.button,s.absolute.x=i.x,s.absolute.y=i.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=u},s.mouseup=function(u){var i=e._getRelativeMousePosition(u,s.element,s.pixelRatio),f=u.changedTouches;f&&u.preventDefault(),s.button=-1,s.absolute.x=i.x,s.absolute.y=i.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=u},s.mousewheel=function(u){s.wheelDelta=Math.max(-1,Math.min(1,u.wheelDelta||-u.detail)),u.preventDefault(),s.sourceEvents.mousewheel=u},e.setElement(s,s.element),s},e.setElement=function(r,s){r.element=s,s.addEventListener("mousemove",r.mousemove,{passive:!0}),s.addEventListener("mousedown",r.mousedown,{passive:!0}),s.addEventListener("mouseup",r.mouseup,{passive:!0}),s.addEventListener("wheel",r.mousewheel,{passive:!1}),s.addEventListener("touchmove",r.mousemove,{passive:!1}),s.addEventListener("touchstart",r.mousedown,{passive:!1}),s.addEventListener("touchend",r.mouseup,{passive:!1})},e.clearSourceEvents=function(r){r.sourceEvents.mousemove=null,r.sourceEvents.mousedown=null,r.sourceEvents.mouseup=null,r.sourceEvents.mousewheel=null,r.wheelDelta=0},e.setOffset=function(r,s){r.offset.x=s.x,r.offset.y=s.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},e.setScale=function(r,s){r.scale.x=s.x,r.scale.y=s.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},e._getRelativeMousePosition=function(r,s,u){var i=s.getBoundingClientRect(),f=document.documentElement||document.body.parentNode||document.body,l=window.pageXOffset!==void 0?window.pageXOffset:f.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:f.scrollTop,a=r.changedTouches,n,c;return a?(n=a[0].pageX-i.left-l,c=a[0].pageY-i.top-t):(n=r.pageX-i.left-l,c=r.pageY-i.top-t),{x:n/(s.clientWidth/(s.width||s.clientWidth)*u),y:c/(s.clientHeight/(s.height||s.clientHeight)*u)}}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(0);(function(){e._registry={},e.register=function(r){if(e.isPlugin(r)||o.warn("Plugin.register:",e.toString(r),"does not implement all required fields."),r.name in e._registry){var s=e._registry[r.name],u=e.versionParse(r.version).number,i=e.versionParse(s.version).number;u>i?(o.warn("Plugin.register:",e.toString(s),"was upgraded to",e.toString(r)),e._registry[r.name]=r):u<i?o.warn("Plugin.register:",e.toString(s),"can not be downgraded to",e.toString(r)):r!==s&&o.warn("Plugin.register:",e.toString(r),"is already registered to different plugin object")}else e._registry[r.name]=r;return r},e.resolve=function(r){return e._registry[e.dependencyParse(r).name]},e.toString=function(r){return typeof r=="string"?r:(r.name||"anonymous")+"@"+(r.version||r.range||"0.0.0")},e.isPlugin=function(r){return r&&r.name&&r.version&&r.install},e.isUsed=function(r,s){return r.used.indexOf(s)>-1},e.isFor=function(r,s){var u=r.for&&e.dependencyParse(r.for);return!r.for||s.name===u.name&&e.versionSatisfies(s.version,u.range)},e.use=function(r,s){if(r.uses=(r.uses||[]).concat(s||[]),r.uses.length===0){o.warn("Plugin.use:",e.toString(r),"does not specify any dependencies to install.");return}for(var u=e.dependencies(r),i=o.topologicalSort(u),f=[],l=0;l<i.length;l+=1)if(i[l]!==r.name){var t=e.resolve(i[l]);if(!t){f.push("âŒ "+i[l]);continue}e.isUsed(r,t.name)||(e.isFor(t,r)||(o.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(r)+"."),t._warned=!0),t.install?t.install(r):(o.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(f.push("ðŸ”¶ "+e.toString(t)),delete t._warned):f.push("âœ… "+e.toString(t)),r.used.push(t.name))}f.length>0&&o.info(f.join("  "))},e.dependencies=function(r,s){var u=e.dependencyParse(r),i=u.name;if(s=s||{},!(i in s)){r=e.resolve(r)||r,s[i]=o.map(r.uses||[],function(l){e.isPlugin(l)&&e.register(l);var t=e.dependencyParse(l),a=e.resolve(l);return a&&!e.versionSatisfies(a.version,t.range)?(o.warn("Plugin.dependencies:",e.toString(a),"does not satisfy",e.toString(t),"used by",e.toString(u)+"."),a._warned=!0,r._warned=!0):a||(o.warn("Plugin.dependencies:",e.toString(l),"used by",e.toString(u),"could not be resolved."),r._warned=!0),t.name});for(var f=0;f<s[i].length;f+=1)e.dependencies(s[i][f],s);return s}},e.dependencyParse=function(r){if(o.isString(r)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return s.test(r)||o.warn("Plugin.dependencyParse:",r,"is not a valid dependency string."),{name:r.split("@")[0],range:r.split("@")[1]||"*"}}return{name:r.name,range:r.range||r.version}},e.versionParse=function(r){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;s.test(r)||o.warn("Plugin.versionParse:",r,"is not a valid version or range.");var u=s.exec(r),i=Number(u[4]),f=Number(u[5]),l=Number(u[6]);return{isRange:!!(u[1]||u[2]),version:u[3],range:r,operator:u[1]||u[2]||"",major:i,minor:f,patch:l,parts:[i,f,l],prerelease:u[7],number:i*1e8+f*1e4+l}},e.versionSatisfies=function(r,s){s=s||"*";var u=e.versionParse(s),i=e.versionParse(r);if(u.isRange){if(u.operator==="*"||r==="*")return!0;if(u.operator===">")return i.number>u.number;if(u.operator===">=")return i.number>=u.number;if(u.operator==="~")return i.major===u.major&&i.minor===u.minor&&i.patch>=u.patch;if(u.operator==="^")return u.major>0?i.major===u.major&&i.number>=u.number:u.minor>0?i.minor===u.minor&&i.patch>=u.patch:i.patch===u.patch}return r===s||r==="*"}})()}),(function(w,T){var h={};w.exports=h,(function(){h.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(7),r=h(18),s=h(13),u=h(19),i=h(5),f=h(6),l=h(10),t=h(0),a=h(4);(function(){e._deltaMax=1e3/60,e.create=function(n){n=n||{};var c={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},g=t.extend(c,n);return g.world=n.world||f.create({label:"World"}),g.pairs=n.pairs||u.create(),g.detector=n.detector||s.create(),g.detector.pairs=g.pairs,g.grid={buckets:[]},g.world.gravity=g.gravity,g.broadphase=g.grid,g.metrics={},g},e.update=function(n,c){var g=t.now(),S=n.world,b=n.detector,B=n.pairs,d=n.timing,m=d.timestamp,y;c>e._deltaMax&&t.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",e._deltaMax.toFixed(3),"ms."),c=typeof c<"u"?c:t._baseDelta,c*=d.timeScale,d.timestamp+=c,d.lastDelta=c;var p={timestamp:d.timestamp,delta:c};i.trigger(n,"beforeUpdate",p);var k=f.allBodies(S),x=f.allConstraints(S);for(S.isModified&&(s.setBodies(b,k),f.setModified(S,!1,!1,!0)),n.enableSleeping&&o.update(k,c),e._bodiesApplyGravity(k,n.gravity),c>0&&e._bodiesUpdate(k,c),i.trigger(n,"beforeSolve",p),l.preSolveAll(k),y=0;y<n.constraintIterations;y++)l.solveAll(x,c);l.postSolveAll(k);var C=s.collisions(b);u.update(B,C,m),n.enableSleeping&&o.afterCollisions(B.list),B.collisionStart.length>0&&i.trigger(n,"collisionStart",{pairs:B.collisionStart,timestamp:d.timestamp,delta:c});var M=t.clamp(20/n.positionIterations,0,1);for(r.preSolvePosition(B.list),y=0;y<n.positionIterations;y++)r.solvePosition(B.list,c,M);for(r.postSolvePosition(k),l.preSolveAll(k),y=0;y<n.constraintIterations;y++)l.solveAll(x,c);for(l.postSolveAll(k),r.preSolveVelocity(B.list),y=0;y<n.velocityIterations;y++)r.solveVelocity(B.list,c);return e._bodiesUpdateVelocities(k),B.collisionActive.length>0&&i.trigger(n,"collisionActive",{pairs:B.collisionActive,timestamp:d.timestamp,delta:c}),B.collisionEnd.length>0&&i.trigger(n,"collisionEnd",{pairs:B.collisionEnd,timestamp:d.timestamp,delta:c}),e._bodiesClearForces(k),i.trigger(n,"afterUpdate",p),n.timing.lastElapsed=t.now()-g,n},e.merge=function(n,c){if(t.extend(n,c),c.world){n.world=c.world,e.clear(n);for(var g=f.allBodies(n.world),S=0;S<g.length;S++){var b=g[S];o.set(b,!1),b.id=t.nextId()}}},e.clear=function(n){u.clear(n.pairs),s.clear(n.detector)},e._bodiesClearForces=function(n){for(var c=n.length,g=0;g<c;g++){var S=n[g];S.force.x=0,S.force.y=0,S.torque=0}},e._bodiesApplyGravity=function(n,c){var g=typeof c.scale<"u"?c.scale:.001,S=n.length;if(!(c.x===0&&c.y===0||g===0))for(var b=0;b<S;b++){var B=n[b];B.isStatic||B.isSleeping||(B.force.y+=B.mass*c.y*g,B.force.x+=B.mass*c.x*g)}},e._bodiesUpdate=function(n,c){for(var g=n.length,S=0;S<g;S++){var b=n[S];b.isStatic||b.isSleeping||a.update(b,c)}},e._bodiesUpdateVelocities=function(n){for(var c=n.length,g=0;g<c;g++)a.updateVelocities(n[g])}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(3),r=h(0),s=h(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(u){var i,f,l,t=u.length;for(i=0;i<t;i++)f=u[i],f.isActive&&(l=f.contactCount,f.collision.parentA.totalContacts+=l,f.collision.parentB.totalContacts+=l)},e.solvePosition=function(u,i,f){var l,t,a,n,c,g,S,b,B=e._positionDampen*(f||1),d=r.clamp(i/r._baseDelta,0,1),m=u.length;for(l=0;l<m;l++)t=u[l],!(!t.isActive||t.isSensor)&&(a=t.collision,n=a.parentA,c=a.parentB,g=a.normal,t.separation=a.depth+g.x*(c.positionImpulse.x-n.positionImpulse.x)+g.y*(c.positionImpulse.y-n.positionImpulse.y));for(l=0;l<m;l++)t=u[l],!(!t.isActive||t.isSensor)&&(a=t.collision,n=a.parentA,c=a.parentB,g=a.normal,b=t.separation-t.slop*d,(n.isStatic||c.isStatic)&&(b*=2),n.isStatic||n.isSleeping||(S=B/n.totalContacts,n.positionImpulse.x+=g.x*b*S,n.positionImpulse.y+=g.y*b*S),c.isStatic||c.isSleeping||(S=B/c.totalContacts,c.positionImpulse.x-=g.x*b*S,c.positionImpulse.y-=g.y*b*S))},e.postSolvePosition=function(u){for(var i=e._positionWarming,f=u.length,l=o.translate,t=s.update,a=0;a<f;a++){var n=u[a],c=n.positionImpulse,g=c.x,S=c.y,b=n.velocity;if(n.totalContacts=0,g!==0||S!==0){for(var B=0;B<n.parts.length;B++){var d=n.parts[B];l(d.vertices,c),t(d.bounds,d.vertices,b),d.position.x+=g,d.position.y+=S}n.positionPrev.x+=g,n.positionPrev.y+=S,g*b.x+S*b.y<0?(c.x=0,c.y=0):(c.x*=i,c.y*=i)}}},e.preSolveVelocity=function(u){var i=u.length,f,l;for(f=0;f<i;f++){var t=u[f];if(!(!t.isActive||t.isSensor)){var a=t.contacts,n=t.contactCount,c=t.collision,g=c.parentA,S=c.parentB,b=c.normal,B=c.tangent;for(l=0;l<n;l++){var d=a[l],m=d.vertex,y=d.normalImpulse,p=d.tangentImpulse;if(y!==0||p!==0){var k=b.x*y+B.x*p,x=b.y*y+B.y*p;g.isStatic||g.isSleeping||(g.positionPrev.x+=k*g.inverseMass,g.positionPrev.y+=x*g.inverseMass,g.anglePrev+=g.inverseInertia*((m.x-g.position.x)*x-(m.y-g.position.y)*k)),S.isStatic||S.isSleeping||(S.positionPrev.x-=k*S.inverseMass,S.positionPrev.y-=x*S.inverseMass,S.anglePrev-=S.inverseInertia*((m.x-S.position.x)*x-(m.y-S.position.y)*k))}}}}},e.solveVelocity=function(u,i){var f=i/r._baseDelta,l=f*f,t=l*f,a=-e._restingThresh*f,n=e._restingThreshTangent,c=e._frictionNormalMultiplier*f,g=e._frictionMaxStatic,S=u.length,b,B,d,m;for(d=0;d<S;d++){var y=u[d];if(!(!y.isActive||y.isSensor)){var p=y.collision,k=p.parentA,x=p.parentB,C=p.normal.x,M=p.normal.y,P=p.tangent.x,I=p.tangent.y,E=y.inverseMass,A=y.friction*y.frictionStatic*c,R=y.contacts,O=y.contactCount,F=1/O,W=k.position.x-k.positionPrev.x,V=k.position.y-k.positionPrev.y,H=k.angle-k.anglePrev,N=x.position.x-x.positionPrev.x,J=x.position.y-x.positionPrev.y,K=x.angle-x.anglePrev;for(m=0;m<O;m++){var D=R[m],j=D.vertex,U=j.x-k.position.x,Y=j.y-k.position.y,Z=j.x-x.position.x,Q=j.y-x.position.y,$=W-Y*H,me=V+U*H,ge=N-Q*K,ve=J+Z*K,ae=$-ge,re=me-ve,ie=C*ae+M*re,X=P*ae+I*re,se=y.separation+ie,ne=Math.min(se,1);ne=se<0?0:ne;var oe=ne*A;X<-oe||X>oe?(B=X>0?X:-X,b=y.friction*(X>0?1:-1)*t,b<-B?b=-B:b>B&&(b=B)):(b=X,B=g);var le=U*M-Y*C,ce=Z*M-Q*C,fe=F/(E+k.inverseInertia*le*le+x.inverseInertia*ce*ce),q=(1+y.restitution)*ie*fe;if(b*=fe,ie<a)D.normalImpulse=0;else{var ye=D.normalImpulse;D.normalImpulse+=q,D.normalImpulse>0&&(D.normalImpulse=0),q=D.normalImpulse-ye}if(X<-n||X>n)D.tangentImpulse=0;else{var xe=D.tangentImpulse;D.tangentImpulse+=b,D.tangentImpulse<-B&&(D.tangentImpulse=-B),D.tangentImpulse>B&&(D.tangentImpulse=B),b=D.tangentImpulse-xe}var _=C*q+P*b,ee=M*q+I*b;k.isStatic||k.isSleeping||(k.positionPrev.x+=_*k.inverseMass,k.positionPrev.y+=ee*k.inverseMass,k.anglePrev+=(U*ee-Y*_)*k.inverseInertia),x.isStatic||x.isSleeping||(x.positionPrev.x-=_*x.inverseMass,x.positionPrev.y-=ee*x.inverseMass,x.anglePrev-=(Z*ee-Q*_)*x.inverseInertia)}}}}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(9),r=h(0);(function(){e.create=function(s){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},e.update=function(s,u,i){var f=o.update,l=o.create,t=o.setActive,a=s.table,n=s.list,c=n.length,g=c,S=s.collisionStart,b=s.collisionEnd,B=s.collisionActive,d=u.length,m=0,y=0,p=0,k,x,C;for(C=0;C<d;C++)k=u[C],x=k.pair,x?(x.isActive&&(B[p++]=x),f(x,k,i)):(x=l(k,i),a[x.id]=x,S[m++]=x,n[g++]=x);for(g=0,c=n.length,C=0;C<c;C++)x=n[C],x.timeUpdated>=i?n[g++]=x:(t(x,!1,i),x.collision.bodyA.sleepCounter>0&&x.collision.bodyB.sleepCounter>0?n[g++]=x:(b[y++]=x,delete a[x.id]));n.length!==g&&(n.length=g),S.length!==m&&(S.length=m),b.length!==y&&(b.length=y),B.length!==p&&(B.length=p)},e.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()}),(function(w,T,h){var e=w.exports=h(21);e.Axes=h(11),e.Bodies=h(12),e.Body=h(4),e.Bounds=h(1),e.Collision=h(8),e.Common=h(0),e.Composite=h(6),e.Composites=h(22),e.Constraint=h(10),e.Contact=h(16),e.Detector=h(13),e.Engine=h(17),e.Events=h(5),e.Grid=h(23),e.Mouse=h(14),e.MouseConstraint=h(24),e.Pair=h(9),e.Pairs=h(19),e.Plugin=h(15),e.Query=h(25),e.Render=h(26),e.Resolver=h(18),e.Runner=h(27),e.SAT=h(28),e.Sleeping=h(7),e.Svg=h(29),e.Vector=h(2),e.Vertices=h(3),e.World=h(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")}),(function(w,T,h){var e={};w.exports=e;var o=h(15),r=h(0);(function(){e.name="matter-js",e.version="0.20.0",e.uses=[],e.used=[],e.use=function(){o.use(e,Array.prototype.slice.call(arguments))},e.before=function(s,u){return s=s.replace(/^Matter./,""),r.chainPathBefore(e,s,u)},e.after=function(s,u){return s=s.replace(/^Matter./,""),r.chainPathAfter(e,s,u)}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(6),r=h(10),s=h(0),u=h(4),i=h(12),f=s.deprecated;(function(){e.stack=function(l,t,a,n,c,g,S){for(var b=o.create({label:"Stack"}),B=l,d=t,m,y=0,p=0;p<n;p++){for(var k=0,x=0;x<a;x++){var C=S(B,d,x,p,m,y);if(C){var M=C.bounds.max.y-C.bounds.min.y,P=C.bounds.max.x-C.bounds.min.x;M>k&&(k=M),u.translate(C,{x:P*.5,y:M*.5}),B=C.bounds.max.x+c,o.addBody(b,C),m=C,y+=1}else B+=c}d+=k+g,B=l}return b},e.chain=function(l,t,a,n,c,g){for(var S=l.bodies,b=1;b<S.length;b++){var B=S[b-1],d=S[b],m=B.bounds.max.y-B.bounds.min.y,y=B.bounds.max.x-B.bounds.min.x,p=d.bounds.max.y-d.bounds.min.y,k=d.bounds.max.x-d.bounds.min.x,x={bodyA:B,pointA:{x:y*t,y:m*a},bodyB:d,pointB:{x:k*n,y:p*c}},C=s.extend(x,g);o.addConstraint(l,r.create(C))}return l.label+=" Chain",l},e.mesh=function(l,t,a,n,c){var g=l.bodies,S,b,B,d,m;for(S=0;S<a;S++){for(b=1;b<t;b++)B=g[b-1+S*t],d=g[b+S*t],o.addConstraint(l,r.create(s.extend({bodyA:B,bodyB:d},c)));if(S>0)for(b=0;b<t;b++)B=g[b+(S-1)*t],d=g[b+S*t],o.addConstraint(l,r.create(s.extend({bodyA:B,bodyB:d},c))),n&&b>0&&(m=g[b-1+(S-1)*t],o.addConstraint(l,r.create(s.extend({bodyA:m,bodyB:d},c)))),n&&b<t-1&&(m=g[b+1+(S-1)*t],o.addConstraint(l,r.create(s.extend({bodyA:m,bodyB:d},c))))}return l.label+=" Mesh",l},e.pyramid=function(l,t,a,n,c,g,S){return e.stack(l,t,a,n,c,g,function(b,B,d,m,y,p){var k=Math.min(n,Math.ceil(a/2)),x=y?y.bounds.max.x-y.bounds.min.x:0;if(!(m>k)){m=k-m;var C=m,M=a-1-m;if(!(d<C||d>M)){p===1&&u.translate(y,{x:(d+(a%2===1?1:-1))*x,y:0});var P=y?d*x:0;return S(l+P+d*c,B,d,m,y,p)}}})},e.newtonsCradle=function(l,t,a,n,c){for(var g=o.create({label:"Newtons Cradle"}),S=0;S<a;S++){var b=1.9,B=i.circle(l+S*(n*b),t+c,n,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),d=r.create({pointA:{x:l+S*(n*b),y:t},bodyB:B});o.addBody(g,B),o.addConstraint(g,d)}return g},f(e,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),e.car=function(l,t,a,n,c){var g=u.nextGroup(!0),S=20,b=-a*.5+S,B=a*.5-S,d=0,m=o.create({label:"Car"}),y=i.rectangle(l,t,a,n,{collisionFilter:{group:g},chamfer:{radius:n*.5},density:2e-4}),p=i.circle(l+b,t+d,c,{collisionFilter:{group:g},friction:.8}),k=i.circle(l+B,t+d,c,{collisionFilter:{group:g},friction:.8}),x=r.create({bodyB:y,pointB:{x:b,y:d},bodyA:p,stiffness:1,length:0}),C=r.create({bodyB:y,pointB:{x:B,y:d},bodyA:k,stiffness:1,length:0});return o.addBody(m,y),o.addBody(m,p),o.addBody(m,k),o.addConstraint(m,x),o.addConstraint(m,C),m},f(e,"car","Composites.car âž¤ moved to car example"),e.softBody=function(l,t,a,n,c,g,S,b,B,d){B=s.extend({inertia:1/0},B),d=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var m=e.stack(l,t,a,n,c,g,function(y,p){return i.circle(y,p,b,B)});return e.mesh(m,a,n,S,d),m.label="Soft Body",m},f(e,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")})()}),(function(w,T,h){var e={};w.exports=e;var o=h(9),r=h(0),s=r.deprecated;(function(){e.create=function(u){var i={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return r.extend(i,u)},e.update=function(u,i,f,l){var t,a,n,c=f.world,g=u.buckets,S,b,B=!1;for(t=0;t<i.length;t++){var d=i[t];if(!(d.isSleeping&&!l)&&!(c.bounds&&(d.bounds.max.x<c.bounds.min.x||d.bounds.min.x>c.bounds.max.x||d.bounds.max.y<c.bounds.min.y||d.bounds.min.y>c.bounds.max.y))){var m=e._getRegion(u,d);if(!d.region||m.id!==d.region.id||l){(!d.region||l)&&(d.region=m);var y=e._regionUnion(m,d.region);for(a=y.startCol;a<=y.endCol;a++)for(n=y.startRow;n<=y.endRow;n++){b=e._getBucketId(a,n),S=g[b];var p=a>=m.startCol&&a<=m.endCol&&n>=m.startRow&&n<=m.endRow,k=a>=d.region.startCol&&a<=d.region.endCol&&n>=d.region.startRow&&n<=d.region.endRow;!p&&k&&k&&S&&e._bucketRemoveBody(u,S,d),(d.region===m||p&&!k||l)&&(S||(S=e._createBucket(g,b)),e._bucketAddBody(u,S,d))}d.region=m,B=!0}}}B&&(u.pairsList=e._createActivePairsList(u))},s(e,"update","Grid.update âž¤ replaced by Matter.Detector"),e.clear=function(u){u.buckets={},u.pairs={},u.pairsList=[]},s(e,"clear","Grid.clear âž¤ replaced by Matter.Detector"),e._regionUnion=function(u,i){var f=Math.min(u.startCol,i.startCol),l=Math.max(u.endCol,i.endCol),t=Math.min(u.startRow,i.startRow),a=Math.max(u.endRow,i.endRow);return e._createRegion(f,l,t,a)},e._getRegion=function(u,i){var f=i.bounds,l=Math.floor(f.min.x/u.bucketWidth),t=Math.floor(f.max.x/u.bucketWidth),a=Math.floor(f.min.y/u.bucketHeight),n=Math.floor(f.max.y/u.bucketHeight);return e._createRegion(l,t,a,n)},e._createRegion=function(u,i,f,l){return{id:u+","+i+","+f+","+l,startCol:u,endCol:i,startRow:f,endRow:l}},e._getBucketId=function(u,i){return"C"+u+"R"+i},e._createBucket=function(u,i){var f=u[i]=[];return f},e._bucketAddBody=function(u,i,f){var l=u.pairs,t=o.id,a=i.length,n;for(n=0;n<a;n++){var c=i[n];if(!(f.id===c.id||f.isStatic&&c.isStatic)){var g=t(f,c),S=l[g];S?S[2]+=1:l[g]=[f,c,1]}}i.push(f)},e._bucketRemoveBody=function(u,i,f){var l=u.pairs,t=o.id,a;i.splice(r.indexOf(i,f),1);var n=i.length;for(a=0;a<n;a++){var c=l[t(f,i[a])];c&&(c[2]-=1)}},e._createActivePairsList=function(u){var i,f=u.pairs,l=r.keys(f),t=l.length,a=[],n;for(n=0;n<t;n++)i=f[l[n]],i[2]>0?a.push(i):delete f[l[n]];return a}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(3),r=h(7),s=h(14),u=h(5),i=h(13),f=h(10),l=h(6),t=h(0),a=h(1);(function(){e.create=function(n,c){var g=(n?n.mouse:null)||(c?c.mouse:null);g||(n&&n.render&&n.render.canvas?g=s.create(n.render.canvas):c&&c.element?g=s.create(c.element):(g=s.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var S=f.create({label:"Mouse Constraint",pointA:g.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),b={type:"mouseConstraint",mouse:g,element:null,body:null,constraint:S,collisionFilter:{category:1,mask:4294967295,group:0}},B=t.extend(b,c);return u.on(n,"beforeUpdate",function(){var d=l.allBodies(n.world);e.update(B,d),e._triggerEvents(B)}),B},e.update=function(n,c){var g=n.mouse,S=n.constraint,b=n.body;if(g.button===0){if(S.bodyB)r.set(S.bodyB,!1),S.pointA=g.position;else for(var B=0;B<c.length;B++)if(b=c[B],a.contains(b.bounds,g.position)&&i.canCollide(b.collisionFilter,n.collisionFilter))for(var d=b.parts.length>1?1:0;d<b.parts.length;d++){var m=b.parts[d];if(o.contains(m.vertices,g.position)){S.pointA=g.position,S.bodyB=n.body=b,S.pointB={x:g.position.x-b.position.x,y:g.position.y-b.position.y},S.angleB=b.angle,r.set(b,!1),u.trigger(n,"startdrag",{mouse:g,body:b});break}}}else S.bodyB=n.body=null,S.pointB=null,b&&u.trigger(n,"enddrag",{mouse:g,body:b})},e._triggerEvents=function(n){var c=n.mouse,g=c.sourceEvents;g.mousemove&&u.trigger(n,"mousemove",{mouse:c}),g.mousedown&&u.trigger(n,"mousedown",{mouse:c}),g.mouseup&&u.trigger(n,"mouseup",{mouse:c}),s.clearSourceEvents(c)}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(2),r=h(8),s=h(1),u=h(12),i=h(3);(function(){e.collides=function(f,l){for(var t=[],a=l.length,n=f.bounds,c=r.collides,g=s.overlaps,S=0;S<a;S++){var b=l[S],B=b.parts.length,d=B===1?0:1;if(g(b.bounds,n))for(var m=d;m<B;m++){var y=b.parts[m];if(g(y.bounds,n)){var p=c(y,f);if(p){t.push(p);break}}}}return t},e.ray=function(f,l,t,a){a=a||1e-100;for(var n=o.angle(l,t),c=o.magnitude(o.sub(l,t)),g=(t.x+l.x)*.5,S=(t.y+l.y)*.5,b=u.rectangle(g,S,c,a,{angle:n}),B=e.collides(b,f),d=0;d<B.length;d+=1){var m=B[d];m.body=m.bodyB=m.bodyA}return B},e.region=function(f,l,t){for(var a=[],n=0;n<f.length;n++){var c=f[n],g=s.overlaps(c.bounds,l);(g&&!t||!g&&t)&&a.push(c)}return a},e.point=function(f,l){for(var t=[],a=0;a<f.length;a++){var n=f[a];if(s.contains(n.bounds,l))for(var c=n.parts.length===1?0:1;c<n.parts.length;c++){var g=n.parts[c];if(s.contains(g.bounds,l)&&i.contains(g.vertices,l)){t.push(n);break}}}return t}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(4),r=h(0),s=h(6),u=h(1),i=h(5),f=h(2),l=h(14);(function(){var t,a;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(d){window.setTimeout(function(){d(r.now())},1e3/60)},a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(d){var m={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!d.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},y=r.extend(m,d);return y.canvas&&(y.canvas.width=y.options.width||y.canvas.width,y.canvas.height=y.options.height||y.canvas.height),y.mouse=d.mouse,y.engine=d.engine,y.canvas=y.canvas||g(y.options.width,y.options.height),y.context=y.canvas.getContext("2d"),y.textures={},y.bounds=y.bounds||{min:{x:0,y:0},max:{x:y.canvas.width,y:y.canvas.height}},y.controller=e,y.options.showBroadphase=!1,y.options.pixelRatio!==1&&e.setPixelRatio(y,y.options.pixelRatio),r.isElement(y.element)&&y.element.appendChild(y.canvas),y},e.run=function(d){(function m(y){d.frameRequestId=t(m),n(d,y),e.world(d,y),d.context.setTransform(d.options.pixelRatio,0,0,d.options.pixelRatio,0,0),(d.options.showStats||d.options.showDebug)&&e.stats(d,d.context,y),(d.options.showPerformance||d.options.showDebug)&&e.performance(d,d.context,y),d.context.setTransform(1,0,0,1,0,0)})()},e.stop=function(d){a(d.frameRequestId)},e.setPixelRatio=function(d,m){var y=d.options,p=d.canvas;m==="auto"&&(m=S(p)),y.pixelRatio=m,p.setAttribute("data-pixel-ratio",m),p.width=y.width*m,p.height=y.height*m,p.style.width=y.width+"px",p.style.height=y.height+"px"},e.setSize=function(d,m,y){d.options.width=m,d.options.height=y,d.bounds.max.x=d.bounds.min.x+m,d.bounds.max.y=d.bounds.min.y+y,d.options.pixelRatio!==1?e.setPixelRatio(d,d.options.pixelRatio):(d.canvas.width=m,d.canvas.height=y)},e.lookAt=function(d,m,y,p){p=typeof p<"u"?p:!0,m=r.isArray(m)?m:[m],y=y||{x:0,y:0};for(var k={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},x=0;x<m.length;x+=1){var C=m[x],M=C.bounds?C.bounds.min:C.min||C.position||C,P=C.bounds?C.bounds.max:C.max||C.position||C;M&&P&&(M.x<k.min.x&&(k.min.x=M.x),P.x>k.max.x&&(k.max.x=P.x),M.y<k.min.y&&(k.min.y=M.y),P.y>k.max.y&&(k.max.y=P.y))}var I=k.max.x-k.min.x+2*y.x,E=k.max.y-k.min.y+2*y.y,A=d.canvas.height,R=d.canvas.width,O=R/A,F=I/E,W=1,V=1;F>O?V=F/O:W=O/F,d.options.hasBounds=!0,d.bounds.min.x=k.min.x,d.bounds.max.x=k.min.x+I*W,d.bounds.min.y=k.min.y,d.bounds.max.y=k.min.y+E*V,p&&(d.bounds.min.x+=I*.5-I*W*.5,d.bounds.max.x+=I*.5-I*W*.5,d.bounds.min.y+=E*.5-E*V*.5,d.bounds.max.y+=E*.5-E*V*.5),d.bounds.min.x-=y.x,d.bounds.max.x-=y.x,d.bounds.min.y-=y.y,d.bounds.max.y-=y.y,d.mouse&&(l.setScale(d.mouse,{x:(d.bounds.max.x-d.bounds.min.x)/d.canvas.width,y:(d.bounds.max.y-d.bounds.min.y)/d.canvas.height}),l.setOffset(d.mouse,d.bounds.min))},e.startViewTransform=function(d){var m=d.bounds.max.x-d.bounds.min.x,y=d.bounds.max.y-d.bounds.min.y,p=m/d.options.width,k=y/d.options.height;d.context.setTransform(d.options.pixelRatio/p,0,0,d.options.pixelRatio/k,0,0),d.context.translate(-d.bounds.min.x,-d.bounds.min.y)},e.endViewTransform=function(d){d.context.setTransform(d.options.pixelRatio,0,0,d.options.pixelRatio,0,0)},e.world=function(d,m){var y=r.now(),p=d.engine,k=p.world,x=d.canvas,C=d.context,M=d.options,P=d.timing,I=s.allBodies(k),E=s.allConstraints(k),A=M.wireframes?M.wireframeBackground:M.background,R=[],O=[],F,W={timestamp:p.timing.timestamp};if(i.trigger(d,"beforeRender",W),d.currentBackground!==A&&B(d,A),C.globalCompositeOperation="source-in",C.fillStyle="transparent",C.fillRect(0,0,x.width,x.height),C.globalCompositeOperation="source-over",M.hasBounds){for(F=0;F<I.length;F++){var V=I[F];u.overlaps(V.bounds,d.bounds)&&R.push(V)}for(F=0;F<E.length;F++){var H=E[F],N=H.bodyA,J=H.bodyB,K=H.pointA,D=H.pointB;N&&(K=f.add(N.position,H.pointA)),J&&(D=f.add(J.position,H.pointB)),!(!K||!D)&&(u.contains(d.bounds,K)||u.contains(d.bounds,D))&&O.push(H)}e.startViewTransform(d),d.mouse&&(l.setScale(d.mouse,{x:(d.bounds.max.x-d.bounds.min.x)/d.options.width,y:(d.bounds.max.y-d.bounds.min.y)/d.options.height}),l.setOffset(d.mouse,d.bounds.min))}else O=E,R=I,d.options.pixelRatio!==1&&d.context.setTransform(d.options.pixelRatio,0,0,d.options.pixelRatio,0,0);!M.wireframes||p.enableSleeping&&M.showSleeping?e.bodies(d,R,C):(M.showConvexHulls&&e.bodyConvexHulls(d,R,C),e.bodyWireframes(d,R,C)),M.showBounds&&e.bodyBounds(d,R,C),(M.showAxes||M.showAngleIndicator)&&e.bodyAxes(d,R,C),M.showPositions&&e.bodyPositions(d,R,C),M.showVelocity&&e.bodyVelocity(d,R,C),M.showIds&&e.bodyIds(d,R,C),M.showSeparations&&e.separations(d,p.pairs.list,C),M.showCollisions&&e.collisions(d,p.pairs.list,C),M.showVertexNumbers&&e.vertexNumbers(d,R,C),M.showMousePosition&&e.mousePosition(d,d.mouse,C),e.constraints(O,C),M.hasBounds&&e.endViewTransform(d),i.trigger(d,"afterRender",W),P.lastElapsed=r.now()-y},e.stats=function(d,m,y){for(var p=d.engine,k=p.world,x=s.allBodies(k),C=0,M=55,P=44,I=0,E=0,A=0;A<x.length;A+=1)C+=x[A].parts.length;var R={Part:C,Body:x.length,Cons:s.allConstraints(k).length,Comp:s.allComposites(k).length,Pair:p.pairs.list.length};m.fillStyle="#0e0f19",m.fillRect(I,E,M*5.5,P),m.font="12px Arial",m.textBaseline="top",m.textAlign="right";for(var O in R){var F=R[O];m.fillStyle="#aaa",m.fillText(O,I+M,E+8),m.fillStyle="#eee",m.fillText(F,I+M,E+26),I+=M}},e.performance=function(d,m){var y=d.engine,p=d.timing,k=p.deltaHistory,x=p.elapsedHistory,C=p.timestampElapsedHistory,M=p.engineDeltaHistory,P=p.engineUpdatesHistory,I=p.engineElapsedHistory,E=y.timing.lastUpdatesPerFrame,A=y.timing.lastDelta,R=c(k),O=c(x),F=c(M),W=c(P),V=c(I),H=c(C),N=H/R||0,J=Math.round(R/A),K=1e3/R||0,D=4,j=12,U=60,Y=34,Z=10,Q=69;m.fillStyle="#0e0f19",m.fillRect(0,50,j*5+U*6+22,Y),e.status(m,Z,Q,U,D,k.length,Math.round(K)+" fps",K/e._goodFps,function($){return k[$]/R-1}),e.status(m,Z+j+U,Q,U,D,M.length,A.toFixed(2)+" dt",e._goodDelta/A,function($){return M[$]/F-1}),e.status(m,Z+(j+U)*2,Q,U,D,P.length,E+" upf",Math.pow(r.clamp(W/J||1,0,1),4),function($){return P[$]/W-1}),e.status(m,Z+(j+U)*3,Q,U,D,I.length,V.toFixed(2)+" ut",1-E*V/e._goodFps,function($){return I[$]/V-1}),e.status(m,Z+(j+U)*4,Q,U,D,x.length,O.toFixed(2)+" rt",1-O/e._goodFps,function($){return x[$]/O-1}),e.status(m,Z+(j+U)*5,Q,U,D,C.length,N.toFixed(2)+" x",N*N*N,function($){return(C[$]/k[$]/N||0)-1})},e.status=function(d,m,y,p,k,x,C,M,P){d.strokeStyle="#888",d.fillStyle="#444",d.lineWidth=1,d.fillRect(m,y+7,p,1),d.beginPath(),d.moveTo(m,y+7-k*r.clamp(.4*P(0),-2,2));for(var I=0;I<p;I+=1)d.lineTo(m+I,y+7-(I<x?k*r.clamp(.4*P(I),-2,2):0));d.stroke(),d.fillStyle="hsl("+r.clamp(25+95*M,0,120)+",100%,60%)",d.fillRect(m,y-7,4,4),d.font="12px Arial",d.textBaseline="middle",d.textAlign="right",d.fillStyle="#eee",d.fillText(C,m+p,y-5)},e.constraints=function(d,m){for(var y=m,p=0;p<d.length;p++){var k=d[p];if(!(!k.render.visible||!k.pointA||!k.pointB)){var x=k.bodyA,C=k.bodyB,M,P;if(x?M=f.add(x.position,k.pointA):M=k.pointA,k.render.type==="pin")y.beginPath(),y.arc(M.x,M.y,3,0,2*Math.PI),y.closePath();else{if(C?P=f.add(C.position,k.pointB):P=k.pointB,y.beginPath(),y.moveTo(M.x,M.y),k.render.type==="spring")for(var I=f.sub(P,M),E=f.perp(f.normalise(I)),A=Math.ceil(r.clamp(k.length/5,12,20)),R,O=1;O<A;O+=1)R=O%2===0?1:-1,y.lineTo(M.x+I.x*(O/A)+E.x*R*4,M.y+I.y*(O/A)+E.y*R*4);y.lineTo(P.x,P.y)}k.render.lineWidth&&(y.lineWidth=k.render.lineWidth,y.strokeStyle=k.render.strokeStyle,y.stroke()),k.render.anchors&&(y.fillStyle=k.render.strokeStyle,y.beginPath(),y.arc(M.x,M.y,3,0,2*Math.PI),y.arc(P.x,P.y,3,0,2*Math.PI),y.closePath(),y.fill())}}},e.bodies=function(d,m,y){var p=y;d.engine;var k=d.options,x=k.showInternalEdges||!k.wireframes,C,M,P,I;for(P=0;P<m.length;P++)if(C=m[P],!!C.render.visible){for(I=C.parts.length>1?1:0;I<C.parts.length;I++)if(M=C.parts[I],!!M.render.visible){if(k.showSleeping&&C.isSleeping?p.globalAlpha=.5*M.render.opacity:M.render.opacity!==1&&(p.globalAlpha=M.render.opacity),M.render.sprite&&M.render.sprite.texture&&!k.wireframes){var E=M.render.sprite,A=b(d,E.texture);p.translate(M.position.x,M.position.y),p.rotate(M.angle),p.drawImage(A,A.width*-E.xOffset*E.xScale,A.height*-E.yOffset*E.yScale,A.width*E.xScale,A.height*E.yScale),p.rotate(-M.angle),p.translate(-M.position.x,-M.position.y)}else{if(M.circleRadius)p.beginPath(),p.arc(M.position.x,M.position.y,M.circleRadius,0,2*Math.PI);else{p.beginPath(),p.moveTo(M.vertices[0].x,M.vertices[0].y);for(var R=1;R<M.vertices.length;R++)!M.vertices[R-1].isInternal||x?p.lineTo(M.vertices[R].x,M.vertices[R].y):p.moveTo(M.vertices[R].x,M.vertices[R].y),M.vertices[R].isInternal&&!x&&p.moveTo(M.vertices[(R+1)%M.vertices.length].x,M.vertices[(R+1)%M.vertices.length].y);p.lineTo(M.vertices[0].x,M.vertices[0].y),p.closePath()}k.wireframes?(p.lineWidth=1,p.strokeStyle=d.options.wireframeStrokeStyle,p.stroke()):(p.fillStyle=M.render.fillStyle,M.render.lineWidth&&(p.lineWidth=M.render.lineWidth,p.strokeStyle=M.render.strokeStyle,p.stroke()),p.fill())}p.globalAlpha=1}}},e.bodyWireframes=function(d,m,y){var p=y,k=d.options.showInternalEdges,x,C,M,P,I;for(p.beginPath(),M=0;M<m.length;M++)if(x=m[M],!!x.render.visible)for(I=x.parts.length>1?1:0;I<x.parts.length;I++){for(C=x.parts[I],p.moveTo(C.vertices[0].x,C.vertices[0].y),P=1;P<C.vertices.length;P++)!C.vertices[P-1].isInternal||k?p.lineTo(C.vertices[P].x,C.vertices[P].y):p.moveTo(C.vertices[P].x,C.vertices[P].y),C.vertices[P].isInternal&&!k&&p.moveTo(C.vertices[(P+1)%C.vertices.length].x,C.vertices[(P+1)%C.vertices.length].y);p.lineTo(C.vertices[0].x,C.vertices[0].y)}p.lineWidth=1,p.strokeStyle=d.options.wireframeStrokeStyle,p.stroke()},e.bodyConvexHulls=function(d,m,y){var p=y,k,x,C;for(p.beginPath(),x=0;x<m.length;x++)if(k=m[x],!(!k.render.visible||k.parts.length===1)){for(p.moveTo(k.vertices[0].x,k.vertices[0].y),C=1;C<k.vertices.length;C++)p.lineTo(k.vertices[C].x,k.vertices[C].y);p.lineTo(k.vertices[0].x,k.vertices[0].y)}p.lineWidth=1,p.strokeStyle="rgba(255,255,255,0.2)",p.stroke()},e.vertexNumbers=function(d,m,y){var p=y,k,x,C;for(k=0;k<m.length;k++){var M=m[k].parts;for(C=M.length>1?1:0;C<M.length;C++){var P=M[C];for(x=0;x<P.vertices.length;x++)p.fillStyle="rgba(255,255,255,0.2)",p.fillText(k+"_"+x,P.position.x+(P.vertices[x].x-P.position.x)*.8,P.position.y+(P.vertices[x].y-P.position.y)*.8)}}},e.mousePosition=function(d,m,y){var p=y;p.fillStyle="rgba(255,255,255,0.8)",p.fillText(m.position.x+"  "+m.position.y,m.position.x+5,m.position.y-5)},e.bodyBounds=function(d,m,y){var p=y;d.engine;var k=d.options;p.beginPath();for(var x=0;x<m.length;x++){var C=m[x];if(C.render.visible)for(var M=m[x].parts,P=M.length>1?1:0;P<M.length;P++){var I=M[P];p.rect(I.bounds.min.x,I.bounds.min.y,I.bounds.max.x-I.bounds.min.x,I.bounds.max.y-I.bounds.min.y)}}k.wireframes?p.strokeStyle="rgba(255,255,255,0.08)":p.strokeStyle="rgba(0,0,0,0.1)",p.lineWidth=1,p.stroke()},e.bodyAxes=function(d,m,y){var p=y;d.engine;var k=d.options,x,C,M,P;for(p.beginPath(),C=0;C<m.length;C++){var I=m[C],E=I.parts;if(I.render.visible)if(k.showAxes)for(M=E.length>1?1:0;M<E.length;M++)for(x=E[M],P=0;P<x.axes.length;P++){var A=x.axes[P];p.moveTo(x.position.x,x.position.y),p.lineTo(x.position.x+A.x*20,x.position.y+A.y*20)}else for(M=E.length>1?1:0;M<E.length;M++)for(x=E[M],P=0;P<x.axes.length;P++)p.moveTo(x.position.x,x.position.y),p.lineTo((x.vertices[0].x+x.vertices[x.vertices.length-1].x)/2,(x.vertices[0].y+x.vertices[x.vertices.length-1].y)/2)}k.wireframes?(p.strokeStyle="indianred",p.lineWidth=1):(p.strokeStyle="rgba(255, 255, 255, 0.4)",p.globalCompositeOperation="overlay",p.lineWidth=2),p.stroke(),p.globalCompositeOperation="source-over"},e.bodyPositions=function(d,m,y){var p=y;d.engine;var k=d.options,x,C,M,P;for(p.beginPath(),M=0;M<m.length;M++)if(x=m[M],!!x.render.visible)for(P=0;P<x.parts.length;P++)C=x.parts[P],p.arc(C.position.x,C.position.y,3,0,2*Math.PI,!1),p.closePath();for(k.wireframes?p.fillStyle="indianred":p.fillStyle="rgba(0,0,0,0.5)",p.fill(),p.beginPath(),M=0;M<m.length;M++)x=m[M],x.render.visible&&(p.arc(x.positionPrev.x,x.positionPrev.y,2,0,2*Math.PI,!1),p.closePath());p.fillStyle="rgba(255,165,0,0.8)",p.fill()},e.bodyVelocity=function(d,m,y){var p=y;p.beginPath();for(var k=0;k<m.length;k++){var x=m[k];if(x.render.visible){var C=o.getVelocity(x);p.moveTo(x.position.x,x.position.y),p.lineTo(x.position.x+C.x,x.position.y+C.y)}}p.lineWidth=3,p.strokeStyle="cornflowerblue",p.stroke()},e.bodyIds=function(d,m,y){var p=y,k,x;for(k=0;k<m.length;k++)if(m[k].render.visible){var C=m[k].parts;for(x=C.length>1?1:0;x<C.length;x++){var M=C[x];p.font="12px Arial",p.fillStyle="rgba(255,255,255,0.5)",p.fillText(M.id,M.position.x+10,M.position.y-10)}}},e.collisions=function(d,m,y){var p=y,k=d.options,x,C,M,P;for(p.beginPath(),M=0;M<m.length;M++)if(x=m[M],!!x.isActive)for(C=x.collision,P=0;P<x.contactCount;P++){var I=x.contacts[P],E=I.vertex;p.rect(E.x-1.5,E.y-1.5,3.5,3.5)}for(k.wireframes?p.fillStyle="rgba(255,255,255,0.7)":p.fillStyle="orange",p.fill(),p.beginPath(),M=0;M<m.length;M++)if(x=m[M],!!x.isActive&&(C=x.collision,x.contactCount>0)){var A=x.contacts[0].vertex.x,R=x.contacts[0].vertex.y;x.contactCount===2&&(A=(x.contacts[0].vertex.x+x.contacts[1].vertex.x)/2,R=(x.contacts[0].vertex.y+x.contacts[1].vertex.y)/2),C.bodyB===C.supports[0].body||C.bodyA.isStatic===!0?p.moveTo(A-C.normal.x*8,R-C.normal.y*8):p.moveTo(A+C.normal.x*8,R+C.normal.y*8),p.lineTo(A,R)}k.wireframes?p.strokeStyle="rgba(255,165,0,0.7)":p.strokeStyle="orange",p.lineWidth=1,p.stroke()},e.separations=function(d,m,y){var p=y,k=d.options,x,C,M,P,I;for(p.beginPath(),I=0;I<m.length;I++)if(x=m[I],!!x.isActive){C=x.collision,M=C.bodyA,P=C.bodyB;var E=1;!P.isStatic&&!M.isStatic&&(E=.5),P.isStatic&&(E=0),p.moveTo(P.position.x,P.position.y),p.lineTo(P.position.x-C.penetration.x*E,P.position.y-C.penetration.y*E),E=1,!P.isStatic&&!M.isStatic&&(E=.5),M.isStatic&&(E=0),p.moveTo(M.position.x,M.position.y),p.lineTo(M.position.x+C.penetration.x*E,M.position.y+C.penetration.y*E)}k.wireframes?p.strokeStyle="rgba(255,165,0,0.5)":p.strokeStyle="orange",p.stroke()},e.inspector=function(d,m){d.engine;var y=d.selected,p=d.render,k=p.options,x;if(k.hasBounds){var C=p.bounds.max.x-p.bounds.min.x,M=p.bounds.max.y-p.bounds.min.y,P=C/p.options.width,I=M/p.options.height;m.scale(1/P,1/I),m.translate(-p.bounds.min.x,-p.bounds.min.y)}for(var E=0;E<y.length;E++){var A=y[E].data;switch(m.translate(.5,.5),m.lineWidth=1,m.strokeStyle="rgba(255,165,0,0.9)",m.setLineDash([1,2]),A.type){case"body":x=A.bounds,m.beginPath(),m.rect(Math.floor(x.min.x-3),Math.floor(x.min.y-3),Math.floor(x.max.x-x.min.x+6),Math.floor(x.max.y-x.min.y+6)),m.closePath(),m.stroke();break;case"constraint":var R=A.pointA;A.bodyA&&(R=A.pointB),m.beginPath(),m.arc(R.x,R.y,10,0,2*Math.PI),m.closePath(),m.stroke();break}m.setLineDash([]),m.translate(-.5,-.5)}d.selectStart!==null&&(m.translate(.5,.5),m.lineWidth=1,m.strokeStyle="rgba(255,165,0,0.6)",m.fillStyle="rgba(255,165,0,0.1)",x=d.selectBounds,m.beginPath(),m.rect(Math.floor(x.min.x),Math.floor(x.min.y),Math.floor(x.max.x-x.min.x),Math.floor(x.max.y-x.min.y)),m.closePath(),m.stroke(),m.fill(),m.translate(-.5,-.5)),k.hasBounds&&m.setTransform(1,0,0,1,0,0)};var n=function(d,m){var y=d.engine,p=d.timing,k=p.historySize,x=y.timing.timestamp;p.delta=m-p.lastTime||e._goodDelta,p.lastTime=m,p.timestampElapsed=x-p.lastTimestamp||0,p.lastTimestamp=x,p.deltaHistory.unshift(p.delta),p.deltaHistory.length=Math.min(p.deltaHistory.length,k),p.engineDeltaHistory.unshift(y.timing.lastDelta),p.engineDeltaHistory.length=Math.min(p.engineDeltaHistory.length,k),p.timestampElapsedHistory.unshift(p.timestampElapsed),p.timestampElapsedHistory.length=Math.min(p.timestampElapsedHistory.length,k),p.engineUpdatesHistory.unshift(y.timing.lastUpdatesPerFrame),p.engineUpdatesHistory.length=Math.min(p.engineUpdatesHistory.length,k),p.engineElapsedHistory.unshift(y.timing.lastElapsed),p.engineElapsedHistory.length=Math.min(p.engineElapsedHistory.length,k),p.elapsedHistory.unshift(p.lastElapsed),p.elapsedHistory.length=Math.min(p.elapsedHistory.length,k)},c=function(d){for(var m=0,y=0;y<d.length;y+=1)m+=d[y];return m/d.length||0},g=function(d,m){var y=document.createElement("canvas");return y.width=d,y.height=m,y.oncontextmenu=function(){return!1},y.onselectstart=function(){return!1},y},S=function(d){var m=d.getContext("2d"),y=window.devicePixelRatio||1,p=m.webkitBackingStorePixelRatio||m.mozBackingStorePixelRatio||m.msBackingStorePixelRatio||m.oBackingStorePixelRatio||m.backingStorePixelRatio||1;return y/p},b=function(d,m){var y=d.textures[m];return y||(y=d.textures[m]=new Image,y.src=m,y)},B=function(d,m){var y=m;/(jpg|gif|png)$/.test(m)&&(y="url("+m+")"),d.canvas.style.background=y,d.canvas.style.backgroundSize="contain",d.currentBackground=m}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(5),r=h(17),s=h(0);(function(){e._maxFrameDelta=1e3/15,e._frameDeltaFallback=1e3/60,e._timeBufferMargin=1.5,e._elapsedNextEstimate=1,e._smoothingLowerBound=.1,e._smoothingUpperBound=.9,e.create=function(i){var f={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},l=s.extend(f,i);return l.fps=0,l},e.run=function(i,f){return i.timeBuffer=e._frameDeltaFallback,(function l(t){i.frameRequestId=e._onNextFrame(i,l),t&&i.enabled&&e.tick(i,f,t)})(),i},e.tick=function(i,f,l){var t=s.now(),a=i.delta,n=0,c=l-i.timeLastTick;if((!c||!i.timeLastTick||c>Math.max(e._maxFrameDelta,i.maxFrameTime))&&(c=i.frameDelta||e._frameDeltaFallback),i.frameDeltaSmoothing){i.frameDeltaHistory.push(c),i.frameDeltaHistory=i.frameDeltaHistory.slice(-i.frameDeltaHistorySize);var g=i.frameDeltaHistory.slice(0).sort(),S=i.frameDeltaHistory.slice(g.length*e._smoothingLowerBound,g.length*e._smoothingUpperBound),b=u(S);c=b||c}i.frameDeltaSnapping&&(c=1e3/Math.round(1e3/c)),i.frameDelta=c,i.timeLastTick=l,i.timeBuffer+=i.frameDelta,i.timeBuffer=s.clamp(i.timeBuffer,0,i.frameDelta+a*e._timeBufferMargin),i.lastUpdatesDeferred=0;var B=i.maxUpdates||Math.ceil(i.maxFrameTime/a),d={timestamp:f.timing.timestamp};o.trigger(i,"beforeTick",d),o.trigger(i,"tick",d);for(var m=s.now();a>0&&i.timeBuffer>=a*e._timeBufferMargin;){o.trigger(i,"beforeUpdate",d),r.update(f,a),o.trigger(i,"afterUpdate",d),i.timeBuffer-=a,n+=1;var y=s.now()-t,p=s.now()-m,k=y+e._elapsedNextEstimate*p/n;if(n>=B||k>i.maxFrameTime){i.lastUpdatesDeferred=Math.round(Math.max(0,i.timeBuffer/a-e._timeBufferMargin));break}}f.timing.lastUpdatesPerFrame=n,o.trigger(i,"afterTick",d),i.frameDeltaHistory.length>=100&&(i.lastUpdatesDeferred&&Math.round(i.frameDelta/a)>B?s.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):i.lastUpdatesDeferred&&s.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof i.isFixed<"u"&&s.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(i.deltaMin||i.deltaMax)&&s.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),i.fps!==0&&s.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},e.stop=function(i){e._cancelNextFrame(i)},e._onNextFrame=function(i,f){if(typeof window<"u"&&window.requestAnimationFrame)i.frameRequestId=window.requestAnimationFrame(f);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return i.frameRequestId},e._cancelNextFrame=function(i){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(i.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var u=function(i){for(var f=0,l=i.length,t=0;t<l;t+=1)f+=i[t];return f/l||0}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(8),r=h(0),s=r.deprecated;(function(){e.collides=function(u,i){return o.collides(u,i)},s(e,"collides","SAT.collides âž¤ replaced by Collision.collides")})()}),(function(w,T,h){var e={};w.exports=e,h(1);var o=h(0);(function(){e.pathToVertices=function(r,s){typeof window<"u"&&!("SVGPathSeg"in window)&&o.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var u,i,f,l,t,a,n,c,g,S,b=[],B,d,m=0,y=0,p=0;s=s||15;var k=function(C,M,P){var I=P%2===1&&P>1;if(!g||C!=g.x||M!=g.y){g&&I?(B=g.x,d=g.y):(B=0,d=0);var E={x:B+C,y:d+M};(I||!g)&&(g=E),b.push(E),y=B+C,p=d+M}},x=function(C){var M=C.pathSegTypeAsLetter.toUpperCase();if(M!=="Z"){switch(M){case"M":case"L":case"T":case"C":case"S":case"Q":y=C.x,p=C.y;break;case"H":y=C.x;break;case"V":p=C.y;break}k(y,p,C.pathSegType)}};for(e._svgPathToAbsolute(r),f=r.getTotalLength(),a=[],u=0;u<r.pathSegList.numberOfItems;u+=1)a.push(r.pathSegList.getItem(u));for(n=a.concat();m<f;){if(S=r.getPathSegAtLength(m),t=a[S],t!=c){for(;n.length&&n[0]!=t;)x(n.shift());c=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":l=r.getPointAtLength(m),k(l.x,l.y,0);break}m+=s}for(u=0,i=n.length;u<i;++u)x(n[u]);return b},e._svgPathToAbsolute=function(r){for(var s,u,i,f,l,t,a=r.pathSegList,n=0,c=0,g=a.numberOfItems,S=0;S<g;++S){var b=a.getItem(S),B=b.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(B))"x"in b&&(n=b.x),"y"in b&&(c=b.y);else switch("x1"in b&&(i=n+b.x1),"x2"in b&&(l=n+b.x2),"y1"in b&&(f=c+b.y1),"y2"in b&&(t=c+b.y2),"x"in b&&(n+=b.x),"y"in b&&(c+=b.y),B){case"m":a.replaceItem(r.createSVGPathSegMovetoAbs(n,c),S);break;case"l":a.replaceItem(r.createSVGPathSegLinetoAbs(n,c),S);break;case"h":a.replaceItem(r.createSVGPathSegLinetoHorizontalAbs(n),S);break;case"v":a.replaceItem(r.createSVGPathSegLinetoVerticalAbs(c),S);break;case"c":a.replaceItem(r.createSVGPathSegCurvetoCubicAbs(n,c,i,f,l,t),S);break;case"s":a.replaceItem(r.createSVGPathSegCurvetoCubicSmoothAbs(n,c,l,t),S);break;case"q":a.replaceItem(r.createSVGPathSegCurvetoQuadraticAbs(n,c,i,f),S);break;case"t":a.replaceItem(r.createSVGPathSegCurvetoQuadraticSmoothAbs(n,c),S);break;case"a":a.replaceItem(r.createSVGPathSegArcAbs(n,c,b.r1,b.r2,b.angle,b.largeArcFlag,b.sweepFlag),S);break;case"z":case"Z":n=s,c=u;break}(B=="M"||B=="m")&&(s=n,u=c)}}})()}),(function(w,T,h){var e={};w.exports=e;var o=h(6);h(0),(function(){e.create=o.create,e.add=o.add,e.remove=o.remove,e.clear=o.clear,e.addComposite=o.addComposite,e.addBody=o.addBody,e.addConstraint=o.addConstraint})()})])})})(te)),te.exports}var be=ke();const G=we(be),Ce=JSON.parse('["ace","act","add","age","aid","aim","air","all","and","ant","any","ape","arc","are","ark","arm","art","ash","ask","ate","bad","bag","ban","bar","bat","bay","bed","bee","bet","big","bin","bit","bow","box","boy","bud","bug","bus","but","buy","cab","can","cap","car","cat","cop","cow","cry","cub","cup","cut","dad","dam","day","den","dew","did","die","dig","dim","dip","dog","dot","dry","dub","dud","due","dug","dye","ear","eat","eel","egg","elm","end","era","eve","eye","fan","far","fat","fax","fed","fee","few","fig","fin","fir","fit","fix","fly","foe","fog","for","fox","fry","fun","fur","gag","gap","gas","gel","gem","get","gig","got","gum","gun","gut","guy","gym","had","ham","has","hat","hay","hen","her","hid","him","hip","his","hit","hog","hop","hot","how","hub","hue","hug","hum","hut","ice","icy","ill","imp","ink","inn","ion","its","ivy","jab","jam","jar","jaw","jay","jet","jig","job","jog","jot","joy","jug","keg","key","kid","kin","kit","lab","lad","lag","lap","law","lay","led","leg","let","lid","lie","lip","lit","log","lot","low","lug","mad","man","map","mat","max","may","men","met","mid","mix","mob","mom","mop","mud","mug","nab","nag","nap","net","new","nit","nod","nor","not","now","nut","oak","oar","oat","odd","off","oft","oil","old","one","opt","orb","ore","our","out","owe","owl","own","pad","pal","pan","pat","paw","pay","pea","peg","pen","per","pet","pie","pig","pin","pit","ply","pod","pop","pot","pry","pub","pug","pun","pup","put","rag","ram","ran","rap","rat","raw","ray","red","ref","rib","rid","rig","rim","rip","rob","rod","rot","row","rub","rug","run","rut","rye","sad","sag","sap","sat","saw","say","sea","set","sew","she","shy","sin","sip","sir","sis","sit","six","ski","sky","sly","sob","sod","son","sop","sow","soy","spa","spy","sub","sue","sum","sun","tab","tad","tag","tan","tap","tar","tax","tea","ten","the","thy","tie","tin","tip","toe","ton","too","top","tot","tow","toy","try","tub","tug","two","urn","use","van","vat","vet","via","vie","vow","wad","wag","war","was","wax","way","web","wed","wet","who","why","wig","win","wit","woe","wok","won","woo","wow","yak","yam","yap","yaw","yea","yen","yes","yet","yew","you","zap","zed","zen","zig","zip","zoo","able","ache","acid","aged","ally","also","amid","arch","area","army","away","baby","back","bake","ball","band","bank","bare","bark","barn","base","bath","beam","bean","bear","beat","been","beer","bell","belt","bend","bent","best","bill","bind","bird","bite","blow","blue","boat","body","boil","bold","bolt","bone","book","boom","boot","born","boss","both","bowl","bulk","bull","burn","bury","bush","busy","cake","call","calm","came","camp","card","care","cart","case","cash","cast","cave","chip","city","clam","clay","clip","club","clue","coal","coat","code","coil","coin","cold","come","cook","cool","cope","copy","cord","core","corn","cost","cozy","crew","crop","cute","dame","damp","dare","dark","dash","data","date","dawn","days","dead","deal","dean","dear","debt","deck","deed","deem","deep","deer","demo","deny","desk","dial","dice","died","diet","dirt","disc","dish","dive","dock","does","doll","dome","done","doom","door","dose","down","drag","draw","drew","drip","drop","drum","dual","duck","dude","duel","duke","dull","dumb","dump","dune","dunk","dusk","dust","duty","each","earn","ease","east","easy","echo","edge","edit","else","emit","envy","epic","even","ever","evil","exam","exit","face","fact","fade","fail","fair","fake","fall","fame","fang","fare","farm","fast","fate","fear","feat","feed","feel","feet","fell","felt","fern","fest","file","fill","film","find","fine","fire","firm","fish","fist","five","flag","flap","flat","flaw","fled","flew","flip","flow","foam","fold","folk","fond","font","food","fool","foot","ford","fork","form","fort","foul","four","fowl","free","from","fuel","full","fume","fund","funk","fury","fuse","fuss","gain","gala","gale","game","gang","gape","garb","gate","gave","gaze","gear","gene","gift","girl","give","glad","glee","glow","glue","goal","goat","goes","gold","golf","gone","good","gown","grab","gram","gray","grew","grid","grim","grin","grip","grit","grow","gulf","gust","guts","hack","hail","hair","half","hall","halt","hand","hang","hard","harm","harp","hash","hate","haul","have","hawk","haze","hazy","head","heal","heap","hear","heat","heel","heir","held","hell","helm","help","herb","herd","here","hero","hide","high","hike","hill","hint","hire","hold","hole","holy","home","hood","hook","hope","horn","hose","host","hour","howl","huge","hull","hung","hunt","hurt","hush","icon","idea","idle","inch","into","iron","isle","item","jack","jade","jail","jazz","jean","jerk","jest","join","joke","jolt","jump","June","July","junk","jury","just","keen","keep","kept","kick","kids","kill","kind","king","kiss","kite","knee","knew","knit","knob","knot","know","lace","lack","lady","laid","lake","lamb","lamp","land","lane","lank","last","late","lava","lawn","lazy","lead","leaf","leak","lean","leap","left","lend","lens","less","lick","lied","life","lift","like","limb","lime","limp","line","link","lion","list","live","load","loaf","loan","lock","loft","lone","long","look","loop","loot","lord","lose","loss","lost","loud","love","luck","lump","lung","lure","lurk","lush","made","maid","mail","main","make","male","mall","mane","many","mark","mars","mash","mask","mass","mast","mate","math","maze","meal","mean","meat","meek","meet","melt","memo","menu","mere","mesh","mess","mile","milk","mill","mind","mine","mint","miss","mist","moan","mock","mode","mold","molt","monk","mood","moon","more","moss","most","moth","move","much","mule","mush","musk","must","mute","myth","nail","name","navy","near","neat","neck","need","nest","next","nice","nick","nine","node","none","noon","norm","nose","note","noun","odds","okay","once","only","onto","open","oven","over","pace","pack","page","paid","pail","pain","pair","pale","palm","pane","park","part","pass","past","path","pave","peak","pear","peat","peel","peer","pelt","pest","pick","pier","pike","pile","pill","pine","pink","pipe","pity","plan","play","plea","plot","plow","plug","plum","plus","poem","poet","poke","pole","poll","pond","pony","pool","poor","pope","pork","port","pose","post","pour","pray","prep","prey","prod","prop","pull","pulp","pump","punk","pure","push","quit","quiz","race","rack","raft","rage","raid","rail","rain","rake","ramp","rang","rank","rare","rash","rate","rave","rays","read","real","reap","rear","reed","reef","reel","rely","rent","rest","rice","rich","ride","rift","ring","riot","rise","risk","road","roam","roar","robe","rock","rode","role","roll","roof","room","root","rope","rose","ruin","rule","rung","rush","rust","sack","safe","sage","said","sail","sake","sale","salt","same","sand","sane","sang","sank","save","seal","seam","seat","sect","seed","seek","seem","seen","self","sell","semi","send","sent","sept","ship","shoe","shop","shot","show","shut","sick","side","sigh","sign","silk","sing","sink","site","size","skim","skin","skip","slab","slam","slap","slat","sled","slew","slid","slim","slip","slit","slob","slop","slot","slow","slug","slum","snap","snow","snub","snug","soak","soap","soar","sock","sofa","soft","soil","sold","sole","solo","some","song","soon","soot","sore","sort","soul","soup","sour","span","spar","spec","sped","spin","spit","spot","spun","spur","stab","star","stay","stem","step","stew","stir","stop","stub","stud","stun","such","suit","sulk","sung","sunk","sure","surf","swan","swap","sway","swim","tail","take","tale","talk","tall","tame","tank","tape","task","team","tear","teen","tell","temp","tend","tent","term","test","text","than","that","them","then","they","thin","this","thus","tick","tide","tidy","tied","tier","tile","tilt","time","tint","tiny","tips","tire","toad","toes","toil","told","toll","tomb","tone","took","tool","tops","tore","torn","toss","tour","town","trap","tray","tree","trek","trim","trip","trod","trot","true","tuck","tuft","tune","turf","turn","tusk","twin","type","ugly","undo","unit","unto","upon","urge","used","user","vain","vale","vary","vase","vast","veil","vein","vent","verb","very","vest","veto","vice","view","vine","visa","void","volt","vote","wade","wage","wait","wake","walk","wall","wand","want","ward","warm","warn","warp","wary","wash","wasp","wave","wavy","waxy","ways","weak","wear","weed","week","weep","well","went","were","west","what","when","whip","whom","wick","wide","wife","wild","will","wilt","wind","wine","wing","wink","wipe","wire","wise","wish","with","woke","wolf","womb","wont","wood","wool","word","wore","work","worm","worn","wrap","wren","yard","yarn","yawn","year","yell","yoga","yoke","your","zeal","zero","zest","zinc","zone","zoom","about","above","adapt","admit","adopt","adult","after","again","agent","agree","ahead","alarm","album","alert","alien","align","alike","alive","allow","alone","along","alter","among","anger","angle","angry","apart","apple","apply","arena","argue","arise","armor","array","arrow","asset","avoid","award","aware","awful","bacon","badge","basic","basin","basis","batch","beach","beard","beast","begin","being","belly","below","bench","berry","birth","black","blade","blame","blank","blast","blaze","blend","bless","blind","block","blood","blown","blues","blunt","board","boast","bonus","boost","booth","bound","brain","brand","brass","brave","bread","break","breed","brick","bride","brief","bring","broad","broke","brook","broom","brown","brush","build","bunch","burst","buyer","cable","camel","candy","cargo","carry","carve","catch","cause","cease","chain","chair","chaos","charm","chart","chase","cheap","cheat","check","cheek","cheer","chess","chest","child","chill","china","choir","chord","civil","claim","class","clean","clear","clerk","click","cliff","climb","clock","close","cloth","cloud","coach","coast","color","colon","couch","could","count","court","cover","crack","craft","crane","crash","crawl","crazy","cream","creek","creep","crest","crisp","cross","crowd","crown","crude","cruel","crush","curve","cycle","daily","dairy","dance","dealt","death","debut","decay","delay","dense","depot","depth","devil","diary","dirty","disco","ditch","dizzy","dodge","doing","donor","doubt","dough","dozen","draft","drain","drama","drank","drape","dream","dress","drift","drill","drink","drive","drown","drunk","dying","eager","eagle","early","earth","eaten","eight","elbow","elder","elect","elite","email","empty","enemy","enjoy","enter","entry","equal","equip","error","essay","ethic","evade","event","every","exact","exert","exist","extra","faint","fairy","faith","false","fancy","fatal","fault","favor","feast","fence","ferry","fetch","fever","fiber","field","fiery","fifth","fifty","fight","final","first","fixed","flame","flash","flask","fleet","flesh","float","flock","flood","floor","flora","flour","fluid","flush","flute","focal","focus","foggy","force","forge","forth","forty","forum","found","frame","frank","fraud","freak","fresh","fried","front","frost","fruit","fully","funny","ghost","giant","given","glass","glide","globe","glory","gloss","glove","going","grace","grade","grain","grand","grant","grape","graph","grasp","grass","grave","great","green","greet","grief","grind","gross","group","grove","guard","guess","guest","guide","guild","guilt","habit","happy","harsh","hasty","hatch","haven","heart","heart","heavy","hedge","hello","hence","herbs","hinge","hobby","honey","honor","horse","hotel","hound","house","human","humor","hurry","ideal","image","imply","incur","index","indie","inner","input","irony","issue","items","ivory","jelly","jewel","joint","joker","jolly","judge","juice","juicy","jumbo","jumpy","karma","kayak","kebab","kiosk","knife","knock","known","label","labor","lance","large","laser","latch","later","laugh","layer","learn","lease","least","leave","ledge","legal","lemon","level","lever","light","likely","limit","linen","liver","local","lodge","logic","loose","lorry","lotus","lover","lower","loyal","lucky","lunar","lunch","lunge","lyric","macro","magic","major","maker","manor","maple","march","marry","marsh","match","maybe","mayor","medal","media","melee","melon","mercy","merge","merit","merry","messy","metal","meter","micro","midst","might","miner","minor","minus","mirth","misty","mixed","model","modem","moist","money","month","moral","motif","motor","motto","mould","mount","mouse","mouth","movie","muddy","music","myths","naive","nasty","naval","nerve","never","newly","night","ninja","noble","noise","noisy","north","notch","noted","novel","nudge","nurse","nylon","occur","ocean","often","olive","onion","onset","opera","orbit","order","other","ought","ounce","outer","outgo","overt","owner","oxide","ozone","panda","panel","panic","paper","party","pasta","paste","patch","pause","peace","peach","pearl","pedal","penny","perch","peril","petal","petty","phase","phone","photo","piano","piece","pilot","pinch","pitch","pivot","pixel","pizza","place","plain","plane","plant","plate","plaza","plead","plumb","plump","point","polar","poppy","porch","posse","pouch","pound","power","press","price","pride","prime","print","prior","prize","probe","proof","proud","prove","proxy","prune","pulse","punch","pupil","puppy","purse","queen","query","quest","queue","quick","quiet","quilt","quota","quote","radar","radio","rainy","raise","rally","ranch","range","rapid","ratio","reach","react","ready","realm","rebel","refer","reign","relax","relay","relic","renew","reply","rider","ridge","rifle","right","rigid","rigor","rinse","risky","rival","river","roast","robot","rocky","rogue","roman","roost","rough","round","route","royal","rugby","ruler","rumor","rural","rusty","sadly","saint","salad","salon","sandy","sauce","sauna","savor","scale","scant","scare","scarf","scary","scene","scent","scope","score","scout","scrap","screw","scrub","seize","sense","serve","setup","seven","shade","shaft","shake","shall","shame","shape","share","shark","sharp","sheep","sheer","sheet","shelf","shell","shift","shine","shiny","shirt","shock","shore","short","shout","shown","shrug","sight","sigma","silly","since","sixth","sixty","sized","skate","skill","skull","slate","slave","sleep","slice","slide","slope","sloth","small","smart","smell","smile","smoke","snack","snake","snare","snarl","solar","solid","solve","sorry","sound","south","space","spare","spark","speak","spear","speed","spell","spend","spice","spicy","spike","spine","spire","spite","split","spoke","spoon","sport","spray","squad","stack","staff","stage","stain","stair","stake","stall","stamp","stand","stark","start","state","stave","stays","steak","steal","steam","steel","steep","steer","stern","stick","stiff","still","sting","stock","stoic","stoke","stone","stood","stool","stoop","store","storm","story","stout","stove","strap","straw","stray","strip","stuck","study","stuff","stump","stunt","style","sugar","suite","sunny","super","surge","swamp","swarm","swear","sweat","sweep","sweet","swell","swept","swift","swing","swirl","swoop","sword","sworn","syrup","table","taken","taste","teach","teddy","teens","teeth","tempo","tense","tenth","terms","tests","thank","theft","their","theme","there","these","thick","thief","thigh","thing","think","third","thorn","those","three","threw","throw","thumb","tiger","tight","timer","tired","titan","title","toast","today","token","topic","torch","total","touch","tough","towel","tower","toxic","trace","track","trade","trail","train","trait","trash","treat","trend","trial","tribe","trick","tried","troop","trout","truck","truly","trunk","trust","truth","tutor","twice","twist","tying","ultra","uncle","under","undue","union","unity","until","upper","upset","urban","usage","usual","valid","value","valve","vapor","vault","venom","venue","verge","verse","video","vigor","villa","vinyl","viral","virus","visit","vital","vivid","vocal","vodka","vogue","voice","voila","voter","wager","wagon","waist","waste","watch","water","weary","weave","wedge","weigh","weird","whale","wheat","wheel","where","which","while","whine","white","whole","whose","width","widen","widow","wield","windy","witch","woman","world","worry","worse","worst","worth","would","wound","woven","wreck","wrist","write","wrong","wrote","yacht","yield","young","yours","youth","zebra","accept","access","across","action","active","actual","advice","afford","afraid","agency","agenda","almost","always","amount","animal","annual","answer","anyone","anyway","appear","artist","assume","attack","attend","author","battle","beauty","become","before","behalf","behind","belief","belong","beside","better","beyond","border","bottom","branch","bridge","bright","broken","budget","burden","button","camera","cancer","cannot","carbon","career","castle","cattle","caught","caution","center","chance","change","charge","choice","choose","church","circle","client","closed","closer","coffee","column","combat","coming","commit","common","comply","cookie","corner","cotton","county","couple","course","covers","create","credit","crisis","custom","damage","danger","dealer","debate","decade","decide","defeat","defend","define","degree","demand","depend","deputy","desert","design","desire","detail","detect","device","differ","dinner","direct","doctor","dollar","domain","double","driver","during","easier","easily","eating","editor","effect","effort","either","emerge","empire","employ","enable","ending","energy","engage","engine","enough","ensure","entire","escape","estate","ethnic","exceed","except","excuse","expand","expect","expert","extend","extent","fabric","facing","factor","fairly","fallen","family","famous","farmer","faster","father","fellow","female","figure","finger","finish","fiscal","flight","flower","follow","forced","forest","forget","formal","format","former","foster","fought","fourth","friend","frozen","future","galaxy","garden","gather","gender","genius","gentle","giving","global","golden","gotten","govern","ground","growth","guitar","handle","happen","hardly","headed","health","height","helped","hidden","holder","honest","horror","horses","hungry","hunter","ignore","impact","import","impose","income","indeed","infant","inform","injury","insect","inside","insist","intend","intent","invest","island","itself","jacket","jersey","jockey","joined","junior","kernel","kidney","killer","landed","laptop","larger","launch","lawyer","leader","league","legend","length","lesson","letter","lights","linked","listen","little","lively","living","locate","locked","lonely","longer","lookup","losing","luxury","magnet","mainly","making","manage","manner","marked","market","master","matter","medium","member","memory","mental","merely","merger","method","middle","mighty","minute","mirror","mobile","modern","modest","moment","monkey","mostly","mother","motion","moving","murder","museum","mutual","myself","namely","narrow","nation","native","nature","nearby","nearly","nickel","normal","notice","notion","number","object","obtain","occupy","office","online","oppose","option","orange","origin","output","packet","palace","parent","partly","patent","patrol","patron","paying","people","period","permit","person","phrase","picked","pillow","planet","player","please","pledge","plenty","pocket","poetry","poison","police","policy","polish","poorly","portal","poster","potato","powder","praise","prayer","prefer","pretty","prince","prison","profit","proper","proven","public","pursue","puzzle","rabbit","racing","racial","random","rarely","rather","rating","reader","really","reason","recall","recent","record","reduce","reform","refuse","regard","regime","region","reject","relate","relief","remain","remark","remedy","remind","remote","remove","render","rental","repair","repeat","report","rescue","resign","resist","resort","result","retail","retain","retire","return","reveal","review","reward","rhythm","riding","rising","ritual","robust","rocket","roller","rubber","ruling","runner","sacred","safety","sailor","salary","salmon","sample","saving","saying","scheme","school","screen","script","search","season","second","secret","sector","secure","seeing","select","seller","senior","series","settle","severe","shadow","shared","shield","shorts","should","shower","signal","silver","simple","simply","singer","single","sister","slight","smooth","soccer","social","socket","sodium","solely","sooner","sorrow","sought","source","speech","sphere","spider","spirit","spoken","spread","spring","square","stable","status","steady","sticky","stolen","strain","strand","stream","street","stress","strict","strike","string","stroke","strong","struck","studio","stupid","submit","subtle","suburb","sudden","suffer","summer","summit","sunday","supply","surely","survey","switch","symbol","system","tablet","tackle","taking","talent","target","temple","tenant","tender","tennis","tenure","thanks","theory","threat","throne","thrown","timber","timing","tissue","toilet","tongue","topped","toward","trader","travel","treaty","tribal","troops","trophy","trying","tunnel","turkey","twelve","twenty","unable","unique","united","unless","unlike","update","upward","urgent","useful","valley","vendor","versus","vessel","victim","viewer","virgin","vision","visual","volume","voting","waking","walker","wallet","wanted","warmth","wealth","weapon","weekly","weight","wheels","whilst","wholly","wicked","widget","window","winner","winter","wisdom","within","wonder","worker","worthy","writer","yellow","zombie","ability","absence","account","achieve","acquire","address","advance","adverse","affairs","airline","airport","alcohol","ancient","another","anxiety","anymore","appoint","approve","article","attract","auction","average","awesome","backing","balance","banking","barrier","battery","bearing","because","bedroom","believe","beneath","benefit","besides","bicycle","billion","binding","biscuit","bizarre","blanket","blessed","bombing","booking","bracket","brewery","briefing","broadly","brother","browser","buffalo","builder","burning","cabinet","captain","capture","careful","carrier","cartoon","catalog","caution","central","century","certain","chamber","channel","chapter","charity","charter","chicken","chronic","citizen","classic","climate","closely","clothes","cluster","coastal","coating","cocaine","collect","college","combine","comfort","command","comment","compact","company","compare","compete","compile","complex","compose","compute","concept","concern","concert","conduct","confirm","connect","consent","consist","contact","contain","content","contest","context","control","convert","cooking","cooling","copying","correct","costume","council","counter","country","courage","courses","covered","crucial","crystal","culture","current","custody","customs","cutting","dealing","decline","default","defence","deficit","deliver","density","deposit","derived","despite","destiny","destroy","develop","devoted","diamond","digital","diploma","disable","discuss","disease","dismiss","display","dispute","distant","diverse","divided","drawing","dressed","eastern","eclipse","economy","edition","elderly","element","embrace","emperor","enabled","endless","engaged","enhance","episode","equally","essence","eternal","ethical","evening","evident","examine","example","excited","exclude","execute","exhaust","exhibit","expense","explain","explode","exploit","explore","express","extract","extreme","factory","faculty","failing","failure","fantasy","farming","fashion","feature","federal","feeling","fighter","finally","finance","finding","fishing","fitness","foreign","forever","formula","fortune","forward","founder","freedom","freight","frequent","funding","funeral","further","gallery","garbage","gateway","general","genuine","gesture","getting","glimpse","goddess","gradual","graphic","greater","greatly","grounds","growing","halfway","handful","hanging","happily","harmony","healing","hearing","healthy","heating","heavily","helpful","highway","himself","history","holding","holiday","horizon","hostile","however","hundred","hunting","husband","illegal","illness","imagine","imaging","impress","improve","include","invalid","involve","journey","justice","justify","keeping","killing","kingdom","kitchen","knowing","landing","largely","lasting","lateral","leading","learned","leather","leaving","lecture","lending","liberal","liberty","library","license","limited","listing","loading","logical","looking","machine","magical","mansion","married","massive","measure","meeting","mention","message","mineral","minimum","miracle","missing","mission","mistake","mixture","monitor","monthly","morning","musical","mystery","natural","network","neutral","notably","nothing","nuclear","nursing","obvious","offense","officer","ongoing","opening","operate","opinion","opposed","organic","origins","outdoor","outlook","outline","outside","overall","package","painful","painter","parking","partial","partner","passage","passing","passion","patient","pattern","payment","peasant","penalty","pending","pension","percent","perfect","perform","perhaps","pioneer","placing","planned","plastic","pleased","plywood","pointed","pointer","popular","portion","poverty","powered","pumpkin","precise","predict","premier","premium","prepare","present","prevent","pricing","primary","printer","privacy","private","problem","process","produce","product","profile","program","project","promise","promote","protect","protein","protest","provide","publish","pulling","purpose","pursuit","pushing","putting","qualify","quality","quantum","quarter","railway","rainbow","rapidly","reading","reality","realize","rebuild","receipt","receive","recover","reflect","refugee","regular","related","release","remains","removal","removed","renewal","replace","replica","request","require","reserve","resolve","respect","respond","restore","retired","retreat","returns","reverse","revised","routine","running","sandwich","satisfy","savings","scaling","scandal","science","scratch","section","seeking","segment","selling","seminar","senator","serious","servant","service","session","setting","settler","seventh","several","shelter","sheriff","shocked","shortly","shopper","showing","shuttle","sibling","signals","silence","silicon","similar","sitting","skating","skilled","slavery","sleeping","smoking","society","somehow","someone","speaker","special","spirits","sponsor","stadium","staging","stellar","stomach","storage","strange","stretch","student","studied","subject","success","suggest","summary","sunrise","support","suppose","supreme","surface","surgeon","surplus","survive","suspect","sustain","symptom","tactics","teacher","telecom","telling","tension","terminal","testing","texture","theater","therapy","thereby","thermal","thought","thunder","tobacco","tonight","toolbar","tourism","tourist","towards","tracker","trading","traffic","tragedy","trailer","trained","trainer","transit","trapped","trilogy","trouble","tsunami","turning","typical","unclear","undergo","unhappy","uniform","unknown","unusual","upgrade","upscale","utility","various","venture","version","veteran","victory","viewing","village","violent","virtual","visible","waiting","walking","wanting","warfare","warming","warning","washing","wealthy","weather","webcast","website","wedding","weekend","welfare","western","whoever","winning","without","witness","worried","worship","wrapper","writing","younger","yourself"]'),L={BUCKET_WIDTH_RATIO:.6,BUCKET_WALL_THICKNESS:20,BUCKET_CORNER_RADIUS:30,SPAWN_INTERVAL_MIN:1,SPAWN_INTERVAL_MAX:2.5,GRAVITY:.8,WORD_RESTITUTION:0,WORD_FRICTION:1,WORD_CHAMFER_RADIUS:8,PROB_BOMB:.03,PROB_FREEZE:.03,PROB_SHRINK:.02,FREEZE_DURATION:5,SHRINK_SCALE:.7,SHRINK_MIN_SCALE:.5,BOMB_RADIUS:120,DANGER_LINE_PERCENT:.15,GRACE_PERIOD:1,SCORE_BASE:10,SCORE_BOMB:25,SCORE_FREEZE:25,SCORE_SHRINK:20,SCORE_BOMB_BONUS:8,COMBO_TIMEOUT:2,COLOR_NORMAL:{bg:"#ffffff",text:"#1a1a2e",glow:"rgba(255,255,255,0.6)"},COLOR_BOMB:{bg:"#ff4757",text:"#ffffff",glow:"rgba(255,71,87,0.8)"},COLOR_FREEZE:{bg:"#00bfff",text:"#ffffff",glow:"rgba(0,191,255,0.8)"},COLOR_SHRINK:{bg:"#a855f7",text:"#ffffff",glow:"rgba(168,85,247,0.8)"},COLOR_BUCKET:"#1e293b",COLOR_BUCKET_BORDER:"#334155"};function he(z,v){return z+Math.random()*(v-z)}function pe(z){const v=Math.floor(z/60),w=Math.floor(z%60);return v+":"+(w<10?"0":"")+w}class Me{particles=[];emit(v,w,T,h){console.log("[ParticleSystem.emit]",h,"particles at",v,w);for(let e=0;e<h;e++){const o=Math.random()*Math.PI*2,r=2+Math.random()*6;this.particles.push({x:v,y:w,vx:Math.cos(o)*r,vy:Math.sin(o)*r-2,life:1,size:4+Math.random()*8,color:T,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.4})}}emitExplosion(v,w,T){this.emit(v,w,T,12),this.emit(v,w,"#ffffff",6)}emitBombExplosion(v,w){this.emit(v,w,L.COLOR_BOMB.bg,25),this.emit(v,w,"#ff8a5b",15),this.emit(v,w,"#ffd700",10)}update(v){for(let w=this.particles.length-1;w>=0;w--){const T=this.particles[w];T.x+=T.vx*v*60,T.y+=T.vy*v*60,T.vy+=.2*v*60,T.rotation+=T.rotationSpeed*v*60,T.life-=.025*v*60,T.life<=0&&this.particles.splice(w,1)}}draw(v){for(const w of this.particles){v.save(),v.globalAlpha=w.life*.9,v.translate(w.x,w.y),v.rotate(w.rotation),v.fillStyle=w.color;const T=w.size*w.life;v.fillRect(-T/2,-T/2,T,T),v.restore()}}}class Be{intensity=0;x=0;y=0;trigger(v){this.intensity=Math.max(this.intensity,v)}update(v){this.intensity>0&&(this.x=(Math.random()-.5)*this.intensity*15,this.y=(Math.random()-.5)*this.intensity*15,this.intensity*=Math.pow(.85,v*60),this.intensity<.01&&(this.intensity=0,this.x=0,this.y=0))}}class Te{ctx=null;masterGain=null;initialized=!1;init(){if(!this.initialized)try{this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.gain.value=.4,this.masterGain.connect(this.ctx.destination),this.initialized=!0}catch(v){console.warn("[AudioManager.init] Failed:",v)}}playTone(v,w,T="sine",h=.3){if(!this.ctx||!this.masterGain)return;const e=this.ctx.currentTime,o=this.ctx.createOscillator(),r=this.ctx.createGain();o.type=T,o.frequency.value=v,r.gain.setValueAtTime(h,e),r.gain.exponentialRampToValueAtTime(.01,e+w),o.connect(r),r.connect(this.masterGain),o.start(e),o.stop(e+w)}playClear(){[400,500,600].forEach((v,w)=>{setTimeout(()=>this.playTone(v,.15,"sine",.25),w*50)})}playBomb(){if(!this.ctx||!this.masterGain)return;const v=this.ctx.currentTime,w=this.ctx.createOscillator(),T=this.ctx.createGain();w.type="sawtooth",w.frequency.setValueAtTime(80,v),w.frequency.exponentialRampToValueAtTime(30,v+.4),T.gain.setValueAtTime(.4,v),T.gain.exponentialRampToValueAtTime(.01,v+.4),w.connect(T),T.connect(this.masterGain),w.start(v),w.stop(v+.5),this.playTone(200,.15,"square",.2)}playFreeze(){if(!this.ctx||!this.masterGain)return;const v=this.ctx.currentTime,w=this.ctx.createOscillator(),T=this.ctx.createGain();w.type="sine",w.frequency.setValueAtTime(800,v),w.frequency.exponentialRampToValueAtTime(1200,v+.3),T.gain.setValueAtTime(.2,v),T.gain.exponentialRampToValueAtTime(.01,v+.4),w.connect(T),T.connect(this.masterGain),w.start(v),w.stop(v+.5)}playShrink(){if(!this.ctx||!this.masterGain)return;const v=this.ctx.currentTime,w=this.ctx.createOscillator(),T=this.ctx.createGain();w.type="triangle",w.frequency.setValueAtTime(600,v),w.frequency.exponentialRampToValueAtTime(200,v+.2),T.gain.setValueAtTime(.25,v),T.gain.exponentialRampToValueAtTime(.01,v+.25),w.connect(T),T.connect(this.masterGain),w.start(v),w.stop(v+.3)}playGameOver(){[400,350,300,200].forEach((v,w)=>{setTimeout(()=>this.playTone(v,.3,"sawtooth",.2),w*150)})}playCombo(v){const w=500+v*50;[0,4,7].forEach((T,h)=>{const e=w*Math.pow(2,T/12);setTimeout(()=>this.playTone(e,.12,"square",.15),h*60)})}}class Pe{canvas;ctx;engine;world;runner;particles;shake;audio;state;words=[];wordsByLength=new Map;nextWordId=0;spawnTimer=0;nextSpawnInterval=1;typedBuffer="";isMobile;bucket={x:0,y:0,width:0,height:0,innerLeft:0,innerRight:0,innerTop:0,innerBottom:0,dangerLineY:0};wallBodies=[];lastTime=0;constructor(){console.log("[WordfallGame] Initializing with Matter.js"),this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.engine=G.Engine.create({enableSleeping:!0,positionIterations:10,velocityIterations:10}),this.world=this.engine.world,this.engine.world.gravity.y=L.GRAVITY,this.runner=G.Runner.create(),this.particles=new Me,this.shake=new Be,this.audio=new Te,this.isMobile=window.matchMedia("(pointer: coarse)").matches;for(const v of Ce){const w=v.length;this.wordsByLength.has(w)||this.wordsByLength.set(w,[]),this.wordsByLength.get(w).push(v)}this.state=this.createInitialState(),this.setupEventListeners(),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),requestAnimationFrame(v=>this.gameLoop(v))}createInitialState(){return{started:!1,gameOver:!1,frozen:!1,freezeTimer:0,score:0,wordsCleared:0,survivalTime:0,combo:0,maxCombo:0,lastClearTime:0,dangerGraceTimer:0}}resizeCanvas(){console.log("[WordfallGame.resizeCanvas]");const v=Math.min(window.devicePixelRatio||1,2);this.canvas.width=window.innerWidth*v,this.canvas.height=window.innerHeight*v,this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.ctx.setTransform(v,0,0,v,0,0),this.calculateLayout(),this.createBucketWalls()}calculateLayout(){const v=window.innerWidth,w=window.innerHeight,T=this.isMobile?.95:L.BUCKET_WIDTH_RATIO,h=this.isMobile?.8:.4,e=Math.min(v*T,500);let r=(this.isMobile?w*.45:w)*h;this.isMobile||(r=Math.min(r,400));const s=(v-e)/2,u=this.isMobile?10:(w-r)/2,i=L.BUCKET_WALL_THICKNESS;this.bucket={x:s,y:u,width:e,height:r,innerLeft:s+i,innerRight:s+e-i,innerTop:u,innerBottom:u+r-i,dangerLineY:u+r*L.DANGER_LINE_PERCENT};const f=document.getElementById("bufferDisplay");f&&(this.isMobile?(f.style.top=u+r+10+"px",f.style.bottom="auto"):(f.style.top="auto",f.style.bottom="2rem")),console.log("[WordfallGame.calculateLayout] bucket:",this.bucket)}createBucketWalls(){for(const u of this.wallBodies)G.Composite.remove(this.world,u);this.wallBodies=[];const{x:v,y:w,width:T,height:h}=this.bucket,e=L.BUCKET_WALL_THICKNESS,o=G.Bodies.rectangle(v+T/2,w+h-e/2,T,e,{isStatic:!0,friction:1,label:"wall"}),r=G.Bodies.rectangle(v+e/2,w+h/2,e,h,{isStatic:!0,friction:1,label:"wall"}),s=G.Bodies.rectangle(v+T-e/2,w+h/2,e,h,{isStatic:!0,friction:1,label:"wall"});this.wallBodies=[o,r,s],G.Composite.add(this.world,this.wallBodies)}setupEventListeners(){console.log("[WordfallGame.setupEventListeners]");const v=document.getElementById("typingInput"),w=document.getElementById("startButton"),T=document.getElementById("restartButton"),h=document.getElementById("menuButton");w?.addEventListener("click",()=>this.startGame()),T?.addEventListener("click",()=>this.startGame()),h?.addEventListener("click",()=>this.showMenu()),v.addEventListener("input",e=>{const o=e.target;this.typedBuffer=o.value.toLowerCase(),this.updateBufferDisplay(),this.checkAutoMatch()}),v.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),this.submitBuffer())}),this.canvas.addEventListener("click",()=>{this.state.started&&!this.state.gameOver&&v.focus()}),v.addEventListener("blur",()=>{this.state.started&&!this.state.gameOver&&setTimeout(()=>v.focus(),10)})}startGame(){console.log("[WordfallGame.startGame]"),this.audio.init();for(const w of this.words)G.Composite.remove(this.world,w.body);this.state=this.createInitialState(),this.state.started=!0,this.words=[],this.typedBuffer="",this.spawnTimer=0,this.nextSpawnInterval=he(L.SPAWN_INTERVAL_MIN,L.SPAWN_INTERVAL_MAX),G.Runner.run(this.runner,this.engine),document.getElementById("startScreen")?.classList.add("hidden"),document.getElementById("gameOverScreen")?.classList.add("hidden"),document.getElementById("hud").style.display="flex",document.getElementById("bufferDisplay").style.display="block";const v=document.getElementById("typingInput");v.value="",v.focus(),this.updateBufferDisplay(),this.updateHUD()}showMenu(){G.Runner.stop(this.runner);for(const v of this.words)G.Composite.remove(this.world,v.body);this.words=[],document.getElementById("gameOverScreen")?.classList.add("hidden"),document.getElementById("startScreen")?.classList.remove("hidden"),document.getElementById("hud").style.display="none",document.getElementById("bufferDisplay").style.display="none"}updateBufferDisplay(){const v=document.getElementById("bufferText");v&&(v.textContent=this.typedBuffer)}updateHUD(){document.getElementById("score").textContent=this.state.score.toString(),document.getElementById("timer").textContent=pe(this.state.survivalTime)}spawnWord(){const v=this.getRandomWordType(),w=v==="normal"?this.getRandomWord():v;console.log("[WordfallGame.spawnWord]",w,"type:",v);const T=this.isMobile?20:18;this.ctx.font="700 "+T+"px 'JetBrains Mono', monospace";const h=this.ctx.measureText(w).width,e=14,o=h+e*2,r=T+e*1.5,s=10,u=this.bucket.innerLeft+o/2+s,i=this.bucket.innerRight-o/2-s,f=u+Math.random()*Math.max(0,i-u),l=this.bucket.y-r-40-Math.random()*30,t=G.Bodies.rectangle(f,l,o,r,{chamfer:{radius:L.WORD_CHAMFER_RADIUS},restitution:L.WORD_RESTITUTION,friction:L.WORD_FRICTION,frictionStatic:1,frictionAir:.02,label:"word-"+this.nextWordId});G.Body.setAngularVelocity(t,(Math.random()-.5)*.05),G.Composite.add(this.world,t);const a={id:this.nextWordId++,text:w,type:v,body:t,width:o,height:r,scale:1,exploding:!1,explosionProgress:0};this.words.push(a)}getRandomWordType(){const v=Math.random();return v<L.PROB_BOMB?"bomb":v<L.PROB_BOMB+L.PROB_FREEZE?"freeze":v<L.PROB_BOMB+L.PROB_FREEZE+L.PROB_SHRINK?"shrink":"normal"}getRandomWord(){const v=Array.from(this.wordsByLength.keys()).sort((o,r)=>o-r);if(v.length===0)return"error";const w=Math.pow(Math.random(),.6),T=Math.floor(w*v.length),h=v[T],e=this.wordsByLength.get(h);return e[Math.floor(Math.random()*e.length)]}checkAutoMatch(){if(!this.typedBuffer)return;const v=this.findMatchingWord(this.typedBuffer);v&&(this.clearWord(v),this.typedBuffer="",document.getElementById("typingInput").value="",this.updateBufferDisplay())}submitBuffer(){if(!this.typedBuffer)return;const v=this.findMatchingWord(this.typedBuffer);v&&(this.clearWord(v),this.typedBuffer="",document.getElementById("typingInput").value="",this.updateBufferDisplay())}findMatchingWord(v){let w=null,T=-1/0;for(const h of this.words)if(!h.exploding&&h.text.toLowerCase()===v.toLowerCase()){const e=h.body.position.y;e>T&&(T=e,w=h)}return w}clearWord(v){console.log("[WordfallGame.clearWord]",v.text,"type:",v.type);const w=v.body.position;let T=L.SCORE_BASE+v.text.length;switch(v.type){case"bomb":T=L.SCORE_BOMB,this.triggerBombEffect(v);break;case"freeze":T=L.SCORE_FREEZE,this.triggerFreezeEffect(),this.particles.emitExplosion(w.x,w.y,L.COLOR_FREEZE.bg);break;case"shrink":T=L.SCORE_SHRINK,this.triggerShrinkEffect(),this.particles.emitExplosion(w.x,w.y,L.COLOR_SHRINK.bg);break;default:this.particles.emitExplosion(w.x,w.y,L.COLOR_NORMAL.bg),this.audio.playClear()}const h=this.state.survivalTime;h-this.state.lastClearTime<L.COMBO_TIMEOUT?(this.state.combo++,this.state.combo>1&&(T=Math.floor(T*(1+this.state.combo*.25)),this.showCombo(this.state.combo),this.audio.playCombo(this.state.combo))):this.state.combo=1,this.state.lastClearTime=h,this.state.maxCombo=Math.max(this.state.maxCombo,this.state.combo),this.state.score+=T,this.state.wordsCleared++,this.removeWord(v),this.updateHUD()}removeWord(v){G.Composite.remove(this.world,v.body);const w=this.words.indexOf(v);w!==-1&&this.words.splice(w,1)}triggerBombEffect(v){console.log("[WordfallGame.triggerBombEffect]");const w=v.body.position;this.particles.emitBombExplosion(w.x,w.y),this.shake.trigger(1),this.audio.playBomb();const T=[];for(const h of this.words){if(h.id===v.id||h.exploding)continue;const e=h.body.position;Math.sqrt(Math.pow(e.x-w.x,2)+Math.pow(e.y-w.y,2))<L.BOMB_RADIUS&&(this.particles.emitExplosion(e.x,e.y,this.getWordColor(h.type).bg),this.state.score+=L.SCORE_BOMB_BONUS+Math.floor(h.text.length/2),this.state.wordsCleared++,T.push(h))}for(const h of T)this.removeWord(h)}triggerFreezeEffect(){console.log("[WordfallGame.triggerFreezeEffect]"),this.state.frozen=!0,this.state.freezeTimer=L.FREEZE_DURATION,this.engine.timing.timeScale=0,document.getElementById("freezeOverlay")?.classList.add("active"),document.getElementById("freezeTimer")?.classList.add("active"),this.audio.playFreeze()}triggerShrinkEffect(){console.log("[WordfallGame.triggerShrinkEffect]"),this.audio.playShrink();for(const v of this.words){if(v.exploding)continue;const w=Math.max(L.SHRINK_MIN_SCALE,v.scale*L.SHRINK_SCALE),T=w/v.scale;v.scale=w,G.Body.scale(v.body,T,T),v.width*=T,v.height*=T,this.particles.emit(v.body.position.x,v.body.position.y,L.COLOR_SHRINK.bg,5)}}showCombo(v){const w=document.getElementById("comboDisplay");w&&(w.textContent=v+"x COMBO!",w.classList.remove("active"),w.offsetWidth,w.classList.add("active"),setTimeout(()=>w.classList.remove("active"),800))}getWordColor(v){switch(v){case"bomb":return L.COLOR_BOMB;case"freeze":return L.COLOR_FREEZE;case"shrink":return L.COLOR_SHRINK;default:return L.COLOR_NORMAL}}checkDangerLine(){if(this.state.survivalTime<2)return!1;for(const v of this.words){if(v.exploding)continue;const w=v.body.position,T=w.y-v.height/2;if(!(w.y+v.height/2<this.bucket.y+40||Math.abs(v.body.velocity.y)>1.5&&!v.body.isSleeping)&&T<this.bucket.dangerLineY)return!0}return!1}endGame(){console.log("[WordfallGame.endGame] Final score:",this.state.score),this.state.gameOver=!0,G.Runner.stop(this.runner),this.audio.playGameOver(),typeof window.submitScore=="function"&&window.submitScore(this.state.score),document.getElementById("finalScore").textContent=this.state.score.toString(),document.getElementById("finalTime").textContent=pe(this.state.survivalTime),document.getElementById("wordsCleared").textContent=this.state.wordsCleared.toString(),document.getElementById("bestCombo").textContent=this.state.maxCombo.toString(),document.getElementById("freezeOverlay")?.classList.remove("active"),document.getElementById("freezeTimer")?.classList.remove("active"),setTimeout(()=>{document.getElementById("gameOverScreen")?.classList.remove("hidden")},500)}update(v){if(!(!this.state.started||this.state.gameOver)){this.state.survivalTime+=v,this.state.frozen&&(this.state.freezeTimer-=v,document.getElementById("freezeTimer").textContent=Math.ceil(this.state.freezeTimer).toString(),this.state.freezeTimer<=0&&(this.state.frozen=!1,this.engine.timing.timeScale=1,document.getElementById("freezeOverlay")?.classList.remove("active"),document.getElementById("freezeTimer")?.classList.remove("active"))),this.state.frozen||(this.spawnTimer+=v,this.spawnTimer>=this.nextSpawnInterval&&(this.spawnTimer=0,this.nextSpawnInterval=he(L.SPAWN_INTERVAL_MIN,L.SPAWN_INTERVAL_MAX),this.spawnWord()));for(let w=this.words.length-1;w>=0;w--){const T=this.words[w];T.body.position.y>window.innerHeight+200&&this.removeWord(T)}this.checkDangerLine()?(this.state.dangerGraceTimer+=v,this.state.dangerGraceTimer>=L.GRACE_PERIOD&&this.endGame()):this.state.dangerGraceTimer=0,this.particles.update(v),this.shake.update(v),this.updateHUD()}}render(){const v=this.ctx,w=window.innerWidth,T=window.innerHeight,h=v.createLinearGradient(0,0,0,T);if(h.addColorStop(0,"#0f172a"),h.addColorStop(.5,"#0a0a1a"),h.addColorStop(1,"#050510"),v.fillStyle=h,v.fillRect(0,0,w,T),!!this.state.started){v.save(),v.translate(this.shake.x,this.shake.y),this.renderBucket(v),this.renderDangerLine(v);for(const e of this.words)e.exploding||this.renderWord(v,e);this.particles.draw(v),v.restore()}}renderBucket(v){const{x:w,y:T,width:h,height:e}=this.bucket,o=L.BUCKET_WALL_THICKNESS,r=L.BUCKET_CORNER_RADIUS;v.beginPath(),v.moveTo(w,T),v.lineTo(w,T+e-r),v.quadraticCurveTo(w,T+e,w+r,T+e),v.lineTo(w+h-r,T+e),v.quadraticCurveTo(w+h,T+e,w+h,T+e-r),v.lineTo(w+h,T),v.lineTo(w+h-o,T),v.lineTo(w+h-o,T+e-r-o),v.quadraticCurveTo(w+h-o,T+e-o,w+h-o-r,T+e-o),v.lineTo(w+o+r,T+e-o),v.quadraticCurveTo(w+o,T+e-o,w+o,T+e-o-r),v.lineTo(w+o,T),v.closePath(),v.fillStyle=L.COLOR_BUCKET,v.fill(),v.strokeStyle=L.COLOR_BUCKET_BORDER,v.lineWidth=2,v.stroke();const s=v.createLinearGradient(w,T,w,T+e);s.addColorStop(0,"rgba(30, 41, 59, 0.3)"),s.addColorStop(1,"rgba(15, 23, 42, 0.8)"),v.fillStyle=s,v.fillRect(w+o,T,h-o*2,e-o)}renderDangerLine(v){const{innerLeft:w,innerRight:T,dangerLineY:h}=this.bucket,o=this.state.dangerGraceTimer>0?.5+Math.sin(Date.now()/100)*.5:.3;v.strokeStyle="rgba(255, 71, 87, "+o+")",v.lineWidth=2,v.setLineDash([8,8]),v.beginPath(),v.moveTo(w,h),v.lineTo(T,h),v.stroke(),v.setLineDash([]);const r=v.createLinearGradient(0,this.bucket.y,0,h);r.addColorStop(0,"rgba(255, 71, 87, "+o*.2+")"),r.addColorStop(1,"rgba(255, 71, 87, 0)"),v.fillStyle=r,v.fillRect(w,this.bucket.y,T-w,h-this.bucket.y)}renderWord(v,w){const T=this.getWordColor(w.type),h=w.body.position,e=w.body.angle;v.save(),v.translate(h.x,h.y),v.rotate(e);const o=w.width,r=w.height,s=L.WORD_CHAMFER_RADIUS*w.scale;v.shadowColor=T.glow,v.shadowBlur=12,v.fillStyle=T.bg,v.beginPath(),v.moveTo(-o/2+s,-r/2),v.lineTo(o/2-s,-r/2),v.quadraticCurveTo(o/2,-r/2,o/2,-r/2+s),v.lineTo(o/2,r/2-s),v.quadraticCurveTo(o/2,r/2,o/2-s,r/2),v.lineTo(-o/2+s,r/2),v.quadraticCurveTo(-o/2,r/2,-o/2,r/2-s),v.lineTo(-o/2,-r/2+s),v.quadraticCurveTo(-o/2,-r/2,-o/2+s,-r/2),v.closePath(),v.fill(),v.shadowBlur=0;const u=(this.isMobile?20:18)*w.scale;v.font="700 "+u+"px 'JetBrains Mono', monospace",v.textBaseline="middle";const i=w.text.toLowerCase(),f=this.typedBuffer.toLowerCase();if(f.length>0&&i.startsWith(f)){const t=f.length,a=w.text.substring(0,t),n=w.text.substring(t),c=v.measureText(a).width,g=v.measureText(n).width,b=-(c+g)/2;v.textAlign="left",v.fillStyle="#22c55e",v.fillText(a,b,1),v.fillStyle=T.text,v.fillText(n,b+c,1)}else v.fillStyle=T.text,v.textAlign="center",v.fillText(w.text,0,1);v.restore()}gameLoop(v){const w=Math.min((v-this.lastTime)/1e3,.1);this.lastTime=v,this.update(w),this.render(),requestAnimationFrame(T=>this.gameLoop(T))}}window.addEventListener("DOMContentLoaded",()=>{console.log("[main] Initializing Wordfall with Matter.js physics"),new Pe});</script>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  
  <!-- Hidden input for keyboard capture -->
  <input type="text" id="typingInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  
  <!-- HUD -->
  <div id="hud">
    <div class="hud-badge">
      <div class="hud-label">Score</div>
      <div class="hud-value" id="score">0</div>
    </div>
    <div class="hud-badge">
      <div class="hud-label">Time</div>
      <div class="hud-value" id="timer">0:00</div>
    </div>
  </div>

  <!-- Typing Buffer Display -->
  <div id="bufferDisplay">
    <div class="buffer-container">
      <div class="buffer-label">Type Here</div>
      <div class="buffer-text">
        <span id="bufferText"></span><span class="buffer-cursor"></span>
      </div>
    </div>
  </div>

  <!-- Freeze Overlay -->
  <div id="freezeOverlay"></div>
  <div id="freezeTimer"></div>

  <!-- Combo Display -->
  <div id="comboDisplay"></div>

  <!-- Start Screen -->
  <div id="startScreen" class="overlay">
    <div class="overlay-content">
      <h1 class="game-title">Wordfall</h1>
      <p class="game-subtitle">Type falling words before they stack up! Special words trigger powerful effects.</p>
      <button class="btn btn-primary" id="startButton">Start Game</button>
    </div>
  </div>

  <!-- Game Over Screen -->
  <div id="gameOverScreen" class="overlay hidden">
    <div class="overlay-content">
      <h1 class="game-over-title">Game Over</h1>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-label">Final Score</div>
          <div class="stat-value highlight" id="finalScore">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Time Survived</div>
          <div class="stat-value" id="finalTime">0:00</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Words Cleared</div>
          <div class="stat-value" id="wordsCleared">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Best Combo</div>
          <div class="stat-value" id="bestCombo">0</div>
        </div>
      </div>
      <div class="buttons-row">
        <button class="btn btn-primary" id="restartButton">Play Again</button>
        <button class="btn btn-secondary" id="menuButton">Main Menu</button>
      </div>
    </div>
  </div>

</body>
</html>
