<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Hoops Jump</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --console-color: #d4752c;
            --console-color-dark: #b85a1a;
            --console-color-light: #e8934a;
            --console-btn-color: #fff5e6;
            --console-btn-dark: #f0d4b8;
            --screen-border: #2a2a2a;
            --screen-bg: #f5e6d3;
            --accent-color: #ff6b35;
            --pixel-black: #1a1a1a;
        }

        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            font-family: 'Press Start 2P', monospace;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.5s ease;
        }

        @media (pointer: coarse) {
            html, body {
                background: var(--console-color);
            }
        }

        /* Checkered background pattern on the console */

        #game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(45deg, var(--console-color-dark) 25%, transparent 25%),
                linear-gradient(-45deg, var(--console-color-dark) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, var(--console-color-dark) 75%),
                linear-gradient(-45deg, transparent 75%, var(--console-color-dark) 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            pointer-events: none;
            z-index: 0;
            border-radius: 24px;
            transition: background-image 0.5s ease;
        }

        @media (pointer: coarse) {
            #game-container::before {
                border-radius: 0;
            }
        }

        /* Desktop background pattern */

        @media (pointer: fine) {
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: 
                    radial-gradient(circle at 50% 50%, #2a2a4e 0%, #1a1a2e 70%);
                pointer-events: none;
                z-index: -1;
            }
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 520px;
            max-height: 1100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            z-index: 1;
            margin: auto;
            border-radius: 24px;
            background: var(--console-color);
            box-shadow: 
                0 0 0 4px var(--console-color-dark),
                0 0 0 8px rgba(0,0,0,0.2),
                0 8px 30px rgba(0,0,0,0.4);
            transition: background 0.5s ease, box-shadow 0.5s ease;
        }

        @media (pointer: coarse) {
            #game-container {
                max-width: none;
                max-height: none;
                border-radius: 0;
                box-shadow: none;
            }
        }

        /* Game screen area */

        #screen-container {
            position: relative;
            width: 100%;
            max-width: 470px;
            flex: 1;
            max-height: 72%;
            background: #0a0a0a;
            border: 8px solid var(--screen-border);
            border-radius: 12px;
            box-shadow: 
                inset 0 0 0 3px #1a1a1a,
                inset 0 0 20px rgba(0,0,0,0.8),
                0 6px 0 0 #3a3a3a,
                0 10px 0 0 #2a2a2a,
                0 14px 20px rgba(0,0,0,0.3);
            overflow: hidden;
            margin-top: 100px;
            z-index: 2;
            transition: border-color 0.5s ease;
        }

        @media (pointer: coarse) {
            #screen-container {
                margin-top: 100px;
                max-height: 60%;
                max-width: 440px;
            }
        }

        /* Screen bezel shine effect */

        #screen-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30%;
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 100%);
            pointer-events: none;
            z-index: 10;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* HUD below screen */

        #hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 420px;
            padding: 12px 10px;
            margin-top: 4px;
            z-index: 2;
        }

        .hud-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #000000;
            padding: 12px 18px;
            border-radius: 12px;
            border: 4px solid #ffffff;
            box-shadow: 
                0 6px 0 rgba(0,0,0,0.4),
                inset 0 0 10px rgba(255,255,255,0.1);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), border-color 0.2s;
            min-width: 110px;
        }

        .hud-label {
            font-size: 10px;
            color: #ffffff;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: bold;
            opacity: 0.9;
        }

        .hud-value {
            font-size: 24px;
            color: #ffffff;
            text-shadow: 
                0 0 8px rgba(255,255,255,0.3);
            letter-spacing: 3px;
        }

        .timer-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-bonus {
            position: absolute;
            top: -25px;
            right: -10px;
            font-size: 24px;
            color: #00ffaa;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(0, 255, 170, 0.8), 2px 2px 0 rgba(0,0,0,0.5);
            z-index: 100;
        }

        .timer-bonus.animate {
            animation: timer-pop-fade 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes timer-pop-fade {
            0% { opacity: 0; transform: translateY(10px) scale(0.5); }
            30% { opacity: 1; transform: translateY(-15px) scale(1.4); }
            100% { opacity: 0; transform: translateY(-45px) scale(1); }
        }

        .hud-item.pop {
            transform: scale(1.1);
            border-color: #ffff00;
            box-shadow: 
                0 0 10px rgba(255,255,0,0.3),
                0 6px 0 rgba(0,0,0,0.4);
        }

        .hud-item.warning {
            border-color: #ff4040;
            animation: pulse-warning 0.5s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { border-color: #ff4040; }
            50% { border-color: #ff8080; }
        }

        @media (pointer: coarse) {
            #hud {
                max-width: 400px;
            }
            .hud-item {
                min-width: 130px;
                padding: 14px 22px;
            }
            .hud-value {
                font-size: 28px;
            }
            .hud-label {
                font-size: 11px;
            }
        }

        /* Combo display */

        #combo-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            color: #ffff00;
            text-shadow: 
                2px 2px 0 #000,
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000;
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        #combo-display.active {
            opacity: 1;
            animation: combo-bounce 0.5s ease-out;
        }

        @keyframes combo-bounce {
            0% { transform: translate(-50%, -50%) scale(0.5); }
            50% { transform: translate(-50%, -50%) scale(1.3); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Control buttons area */

        #controls {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 440px;
            padding: 12px 8px;
            margin-top: -40px;
            z-index: 2;
        }

        @media (pointer: coarse) {
            #controls {
                max-width: 420px;
                padding: 16px 8px;
                margin-top: -10px;
            }
        }

        /* Boost button - large and prominent */

        #boost-btn {
            width: 120px;
            height: 120px;
            background: linear-gradient(180deg, #ffffff 0%, var(--console-btn-color) 40%, var(--console-btn-dark) 100%);
            border: 6px solid var(--pixel-black);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 
                0 8px 0 0 #404040,
                0 12px 0 0 #2a2a2a,
                0 16px 15px rgba(0,0,0,0.3),
                inset 0 4px 0 rgba(255,255,255,0.8),
                inset 0 -6px 0 rgba(0,0,0,0.1);
            transition: transform 0.05s, box-shadow 0.05s, background 0.5s ease;
            touch-action: manipulation;
            flex-direction: column;
            gap: 4px;
        }

        #boost-btn:active, #boost-btn.pressed {
            transform: translateY(8px);
            box-shadow: 
                0 0 0 0 #404040,
                0 4px 0 0 #2a2a2a,
                0 6px 6px rgba(0,0,0,0.15),
                inset 0 5px 10px rgba(0,0,0,0.25);
        }

        #boost-btn .btn-label {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.6rem;
            color: var(--pixel-black);
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
        }

        #boost-btn .btn-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff8c42 0%, #d4752c 50%, #a85a1a 100%);
            border: 4px solid var(--pixel-black);
            border-radius: 50%;
            position: relative;
        }

        /* Basketball lines on icon */

        #boost-btn .btn-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 2px;
            right: 2px;
            height: 3px;
            background: var(--pixel-black);
            transform: translateY(-50%);
        }

        #boost-btn .btn-icon::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 2px;
            bottom: 2px;
            width: 3px;
            background: var(--pixel-black);
            transform: translateX(-50%);
        }

        @media (pointer: coarse) {
            #boost-btn {
                width: 140px;
                height: 140px;
                border-width: 7px;
            }
            #boost-btn .btn-icon {
                width: 60px;
                height: 60px;
            }
            #boost-btn .btn-label {
                font-size: 0.7rem;
            }
        }

        /* Pause button */

        #pauseBtn {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 38px;
            height: 38px;
            background: linear-gradient(180deg, #ffffff 0%, var(--screen-bg) 100%);
            border: 4px solid var(--pixel-black);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 
                0 4px 0 0 #404040,
                0 6px 0 0 #2a2a2a;
            z-index: 20;
            transition: transform 0.05s, box-shadow 0.05s;
        }

        #pauseBtn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 0 #404040, 0 2px 0 0 #2a2a2a;
        }

        #pauseBtn svg {
            width: 16px;
            height: 16px;
            fill: var(--pixel-black);
        }

        @media (pointer: coarse) {
            #pauseBtn {
                top: 115px;
                width: 42px;
                height: 42px;
            }
            #pauseBtn svg {
                width: 18px;
                height: 18px;
            }
        }

        /* Settings button */

        #settingsBtn {
            position: absolute;
            top: 16px;
            left: 16px;
            width: 38px;
            height: 38px;
            background: linear-gradient(180deg, #ffffff 0%, var(--screen-bg) 100%);
            border: 4px solid var(--pixel-black);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 
                0 4px 0 0 #404040,
                0 6px 0 0 #2a2a2a;
            z-index: 20;
            transition: transform 0.05s, box-shadow 0.05s;
        }

        #settingsBtn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 0 #404040, 0 2px 0 0 #2a2a2a;
        }

        #settingsBtn svg {
            width: 18px;
            height: 18px;
            fill: var(--pixel-black);
        }

        @media (pointer: coarse) {
            #settingsBtn {
                top: 115px;
                width: 42px;
                height: 42px;
            }
            #settingsBtn svg {
                width: 20px;
                height: 20px;
            }
        }

        /* Overlays */

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(2px);
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
        }

        .overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .overlay:not(.hidden) {
            pointer-events: auto;
        }

        .overlay-content {
            text-align: center;
            padding: 35px 30px;
            background: linear-gradient(180deg, #ffffff 0%, var(--console-btn-color) 100%);
            border: 8px solid var(--pixel-black);
            border-radius: 16px;
            box-shadow: 
                0 10px 0 0 #404040,
                0 15px 0 0 #2a2a2a,
                0 20px 30px rgba(0,0,0,0.4);
            max-width: 92%;
            width: 340px;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: background 0.5s ease;
            position: relative;
            z-index: 10;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Start Screen - transparent overlay to show live preview */

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            overflow: hidden;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 5px;
        }

        #startScreen.hidden {
            display: none !important;
        }

        /* Gradient overlay at top and bottom for readability */

        .start-overlay-gradient {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(180deg, 
                    rgba(0,0,0,0.55) 0%, 
                    rgba(0,0,0,0.25) 15%,
                    rgba(0,0,0,0.05) 35%,
                    rgba(0,0,0,0) 50%,
                    rgba(0,0,0,0.05) 65%,
                    rgba(0,0,0,0.35) 85%,
                    rgba(0,0,0,0.65) 100%);
            pointer-events: none;
            z-index: 1;
        }

        /* Title area at the top */

        .start-title-area {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 30px 20px 20px;
            text-align: center;
            z-index: 10;
        }

        @media (pointer: coarse) {
            .start-title-area {
                padding-top: 20px;
            }
        }

        .start-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .logo-main {
            font-size: 2.2rem;
            color: #ffffff;
            text-shadow: 
                4px 4px 0 var(--console-color-dark),
                6px 6px 0 rgba(0,0,0,0.3),
                0 0 30px rgba(255,107,53,0.6);
            letter-spacing: 2px;
            line-height: 1;
            animation: logo-bounce 2.5s ease-in-out infinite;
        }

        @keyframes logo-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.02); }
        }

        .logo-sub {
            font-size: 0.55rem;
            color: #ffd700;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
            letter-spacing: 4px;
            text-transform: uppercase;
            animation: glow-pulse 2s ease-in-out infinite alternate;
        }

        @keyframes glow-pulse {
            from { text-shadow: 2px 2px 0 rgba(0,0,0,0.5), 0 0 10px rgba(255,215,0,0.3); }
            to { text-shadow: 2px 2px 0 rgba(0,0,0,0.5), 0 0 20px rgba(255,215,0,0.6); }
        }

        /* Animated basketball icons */

        .start-ball-icon {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff8c42 0%, #d4752c 50%, #a85a1a 100%);
            border: 4px solid rgba(0,0,0,0.8);
            box-shadow: 
                0 4px 10px rgba(0,0,0,0.4),
                inset 0 0 20px rgba(255,255,255,0.2);
            z-index: 5;
        }

        .start-ball-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 3px;
            right: 3px;
            height: 3px;
            background: rgba(0,0,0,0.6);
            transform: translateY(-50%);
        }

        .start-ball-icon::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 3px;
            bottom: 3px;
            width: 3px;
            background: rgba(0,0,0,0.6);
            transform: translateX(-50%);
        }

        .ball-left {
            top: 80px;
            left: 20px;
            animation: ball-float-left 3s ease-in-out infinite;
        }

        .ball-right {
            top: 60px;
            right: 20px;
            animation: ball-float-right 3.5s ease-in-out infinite 0.5s;
        }

        @keyframes ball-float-left {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        @keyframes ball-float-right {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-25px) rotate(-180deg); }
        }

        @media (pointer: coarse) {
            .ball-left { top: 60px; left: 15px; width: 40px; height: 40px; }
            .ball-right { top: 45px; right: 15px; width: 40px; height: 40px; }
        }

        /* Court selector at the center */

        .court-selector {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .court-label {
            font-size: 0.5rem;
            color: #ffffff;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
            margin-bottom: 12px;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .court-buttons {
            display: flex;
            gap: 10px;
        }

        .court-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            background: rgba(0,0,0,0.7);
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            min-width: 80px;
        }

        .court-btn:active {
            transform: scale(0.95);
        }

        .court-btn.active {
            border-color: var(--accent-color);
            background: rgba(212,117,44,0.4);
            box-shadow: 0 0 20px rgba(255,107,53,0.5);
        }

        .court-btn .court-icon {
            font-size: 1.6rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .court-btn .court-name {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.4rem;
            color: rgba(255,255,255,0.7);
            letter-spacing: 1px;
        }

        .court-btn.active .court-name {
            color: #ffffff;
        }

        /* Start button area - on the Game Boy chassis */

        .start-action {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%;
            max-width: 320px;
            padding: 0 20px;
        }

        @media (pointer: coarse) {
            .start-action {
                bottom: 140px;
            }
        }

        .start-action.hidden {
            display: none !important;
        }

        .start-instructions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px 16px;
            margin-bottom: 5px;
        }

        .start-tip {
            font-size: 0.4rem;
            color: rgba(255,255,255,0.9);
            text-shadow: 1px 1px 0 rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tip-icon {
            display: inline-block;
            width: 14px;
            height: 14px;
            background: var(--accent-color);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.35rem;
        }

        #startButton {
            width: 100%;
            padding: 20px 30px;
            font-size: 1rem;
            letter-spacing: 3px;
            animation: start-pulse 1.5s ease-in-out infinite;
            box-shadow: 
                0 6px 0 0 #8a4a1a,
                0 10px 0 0 #6a3a0a,
                0 0 40px rgba(255,107,53,0.4),
                inset 0 2px 0 rgba(255,255,255,0.3);
        }

        @keyframes start-pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 6px 0 0 #8a4a1a, 0 10px 0 0 #6a3a0a, 0 0 40px rgba(255,107,53,0.4), inset 0 2px 0 rgba(255,255,255,0.3);
            }
            50% { 
                transform: scale(1.03); 
                box-shadow: 0 6px 0 0 #8a4a1a, 0 10px 0 0 #6a3a0a, 0 0 60px rgba(255,107,53,0.6), inset 0 2px 0 rgba(255,255,255,0.3);
            }
        }

        .start-hint {
            font-size: 0.35rem;
            color: rgba(255,255,255,0.6);
            text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Scanlines overlay for retro effect */

        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0,0,0,0.03) 0px,
                rgba(0,0,0,0.03) 1px,
                transparent 1px,
                transparent 3px
            );
            pointer-events: none;
            z-index: 50;
        }

        .btn {
            background: linear-gradient(180deg, var(--console-color-light) 0%, var(--console-color) 50%, var(--console-color-dark) 100%);
            color: #ffffff;
            border: 5px solid var(--pixel-black);
            padding: 14px 24px;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.65rem;
            cursor: pointer;
            border-radius: 6px;
            box-shadow: 
                0 5px 0 0 #8a4a1a,
                0 7px 0 0 #6a3a0a,
                inset 0 2px 0 rgba(255,255,255,0.2);
            transition: transform 0.05s, box-shadow 0.05s, background 0.5s ease;
            margin: 5px;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(5px);
            box-shadow: 
                0 0 0 0 #8a4a1a,
                0 2px 0 0 #6a3a0a,
                inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(180deg, #f0e8e0 0%, var(--console-btn-dark) 50%, #c8c0b8 100%);
            color: var(--pixel-black);
            box-shadow: 
                0 5px 0 0 #a8a098,
                0 7px 0 0 #888078,
                inset 0 2px 0 rgba(255,255,255,0.4);
            text-shadow: none;
        }

        .btn-secondary:active {
            box-shadow: 
                0 0 0 0 #a8a098,
                0 2px 0 0 #888078,
                inset 0 2px 4px rgba(0,0,0,0.15);
        }

        /* Score display */

        .final-score {
            font-size: 1.5rem;
            color: var(--pixel-black);
            margin: 8px 0 20px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
            opacity: 0.8;
        }

        .score-label {
            font-size: 0.45rem;
            color: var(--pixel-black);
            opacity: 0.5;
            margin-bottom: 4px;
        }

        .baskets-made {
            font-size: 1.8rem;
            color: var(--accent-color);
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(212, 117, 44, 0.3), 3px 3px 0 rgba(0,0,0,0.1);
            font-weight: bold;
            display: block;
            border-top: 4px solid var(--console-color-dark);
            border-bottom: 4px solid var(--console-color-dark);
            padding: 15px 0;
            animation: pulse-score 2s infinite ease-in-out;
        }

        @keyframes pulse-score {
            0%, 100% { transform: scale(1); text-shadow: 0 0 10px rgba(212, 117, 44, 0.3), 3px 3px 0 rgba(0,0,0,0.1); }
            50% { transform: scale(1.05); text-shadow: 0 0 20px rgba(212, 117, 44, 0.6), 3px 3px 0 rgba(0,0,0,0.1); }
        }

        .rank-container {
            margin-bottom: 20px;
        }

        .rank-value {
            font-size: 0.8rem;
            color: #ffd700;
            background: #000;
            display: inline-block;
            padding: 8px 16px;
            border-radius: 4px;
            border: 2px solid #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
            margin-top: 5px;
            letter-spacing: 2px;
        }

        .baskets-made-label {
            font-size: 0.5rem;
            color: var(--pixel-black);
            opacity: 0.8;
            margin-bottom: 6px;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 2px;
        }

        /* Settings Modal */

        .settings-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, #ffffff 0%, var(--console-btn-color) 100%);
            border: 8px solid var(--pixel-black);
            border-radius: 12px;
            padding: 22px 20px;
            z-index: 150;
            box-shadow: 
                0 8px 0 0 #404040,
                0 12px 0 0 #2a2a2a,
                0 16px 30px rgba(0,0,0,0.4);
            min-width: 240px;
        }

        .settings-modal.hidden {
            display: none;
        }

        .settings-title {
            font-size: 0.7rem;
            color: var(--pixel-black);
            margin-bottom: 18px;
            text-align: center;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 3px solid rgba(0,0,0,0.1);
        }

        .settings-row:last-of-type {
            border-bottom: none;
        }

        .settings-label {
            font-size: 0.45rem;
            color: var(--pixel-black);
        }

        .toggle {
            width: 48px;
            height: 26px;
            background: #b0a8a0;
            border: 4px solid var(--pixel-black);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            transition: background 0.2s ease;
        }

        .toggle.active {
            background: var(--console-color);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            background: linear-gradient(180deg, #ffffff 0%, #e0e0e0 100%);
            border: 3px solid var(--pixel-black);
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.2s ease;
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        .toggle.active::after {
            transform: translateX(22px);
        }

        .settings-divider {
            height: 3px;
            background: rgba(0,0,0,0.1);
            margin: 12px 0;
        }

        .settings-subtitle {
            font-size: 0.5rem;
            color: var(--pixel-black);
            margin-bottom: 10px;
            text-align: center;
            opacity: 0.7;
        }

        .map-selector {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .map-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 12px;
            background: linear-gradient(180deg, #e8e0d8 0%, #d0c8c0 100%);
            border: 4px solid var(--pixel-black);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 3px 0 0 #888078;
        }

        .map-btn:active {
            transform: translateY(3px);
            box-shadow: 0 0 0 0 #888078;
        }

        .map-btn.active {
            background: linear-gradient(180deg, var(--console-color-light) 0%, var(--console-color) 100%);
            box-shadow: 0 3px 0 0 #8a4a1a;
        }

        .map-btn .map-icon {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .map-btn .map-name {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.35rem;
            color: var(--pixel-black);
        }

        .map-btn.active .map-name {
            color: #ffffff;
        }

        /* Decorative screws */

        .screw {
            position: absolute;
            width: 14px;
            height: 14px;
            background: linear-gradient(135deg, #909090 0%, #707070 50%, #505050 100%);
            border-radius: 50%;
            border: 2px solid #404040;
            z-index: 3;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .screw::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            width: 8px;
            height: 2px;
            background: #404040;
        }

        .screw-tl { top: 10px; left: 10px; }

        .screw-tr { top: 10px; right: 10px; }

        .screw-bl { bottom: 10px; left: 10px; }

        .screw-br { bottom: 10px; right: 10px; }

        @media (pointer: coarse) {
            .screw-tl { top: 80px; }
            .screw-tr { top: 80px; }
        }

        /* Hide controls on desktop */

        @media (pointer: fine) {
            #controls {
                opacity: 0.4;
                transition: opacity 0.3s ease;
            }
            #controls:hover {
                opacity: 1;
            }
        }

        /* Mobile adjustments */

        @media (max-height: 680px) {
            #screen-container {
                max-height: 42%;
            }
            #boost-btn {
                width: 100px;
                height: 100px;
            }
            #boost-btn .btn-icon {
                width: 45px;
                height: 45px;
            }
            .overlay-content {
                padding: 20px 18px;
            }
            .game-title {
                font-size: 1.2rem;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
  <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))m(r);new MutationObserver(r=>{for(const g of r)if(g.type==="childList")for(const x of g.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&m(x)}).observe(document,{childList:!0,subtree:!0});function a(r){const g={};return r.integrity&&(g.integrity=r.integrity),r.referrerPolicy&&(g.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?g.credentials="include":r.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function m(r){if(r.ep)return;r.ep=!0;const g=a(r);fetch(r.href,g)}})();const d={BALL_RADIUS:20,GRAVITY:.7,HORIZONTAL_BIAS:.8,WALL_BOUNCE:.7,GROUND_BOUNCE:.9,AIR_RESISTANCE:.998,HOOP_WIDTH:80,RIM_RADIUS:5.5,NET_SEGMENTS:7,BACKBOARD_WIDTH:18,BACKBOARD_HEIGHT:170,HOOP_MARGIN:0,HOOP_Y_MIN_RATIO:.5,HOOP_Y_MAX_RATIO:.7,HOOP_SWITCH_DURATION:500,BASE_POINTS:100,COMBO_MULTIPLIER:1.5,COMBO_WINDOW:3e3,GAME_DURATION:30,TIME_BONUS_PER_SCORE:2,WARNING_TIME:10,RIM_RATTLE_THRESHOLD:300,BACKBOARD_VALID_WINDOW:700,PARTICLE_COUNT:12,PARTICLE_LIFE:600,SHAKE_BOOST:2,SHAKE_SCORE:6,SHAKE_COMBO:10,SHAKE_DECAY:.85,POPUP_DURATION:1200},K=document.getElementById("gameCanvas"),e=K.getContext("2d"),Ze=document.getElementById("screen-container"),ge=document.getElementById("startScreen"),ve=document.getElementById("startAction"),Re=document.getElementById("gameOverScreen"),j=document.getElementById("pauseScreen"),ue=document.getElementById("pauseBtn"),de=document.getElementById("settingsModal"),Qe=document.getElementById("scoreDisplay"),je=document.getElementById("timerDisplay"),Oe=document.getElementById("score-badge"),J=document.getElementById("timer-badge"),et=document.getElementById("finalScore"),tt=document.getElementById("basketsMade"),le=document.getElementById("rankValue"),re=document.getElementById("combo-display"),Le=document.getElementById("hud"),Ce=document.getElementById("controls"),W=document.getElementById("boost-btn");let w="START",n=0,E=0;window.matchMedia("(pointer: coarse)").matches;let s={x:0,y:0,vx:0,vy:0,rotation:0,lastGroundTime:0},f={side:"right",x:0,y:0,targetX:0,targetY:0,animationProgress:1,netWave:0,scored:!1},N=[],q=[],G=0,U=0,H=0,Me=0,$=!1,X=[],ne=!1,fe=0,he=!1,Be=0;function Fe(){ne=!1,fe=0,he=!1,Be=0}let Z=d.GAME_DURATION,i=0,xe=0,Ie=0,Y=0,z=0,Ke="#ffffff",B=0,Ee=0,O={music:localStorage.getItem("hoopsJump_music")!=="false",fx:localStorage.getItem("hoopsJump_fx")!=="false",haptics:localStorage.getItem("hoopsJump_haptics")!=="false"},me=localStorage.getItem("hoopsJump_map")||"city";function _e(t,o,a){return t+(o-t)*a}function ot(t){return 1-(1-t)*(1-t)}function at(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}function nt(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}let c=null;function lt(){c||(c=new AudioContext,console.log("[initAudio] Audio context initialized"))}function it(){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const t=c.createOscillator(),o=c.createGain();t.connect(o),o.connect(c.destination),t.type="sine",t.frequency.setValueAtTime(300,c.currentTime),t.frequency.exponentialRampToValueAtTime(500,c.currentTime+.08),o.gain.setValueAtTime(.15,c.currentTime),o.gain.exponentialRampToValueAtTime(.01,c.currentTime+.1),t.start(c.currentTime),t.stop(c.currentTime+.1)}function ie(){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const t=c.createOscillator(),o=c.createGain();t.connect(o),o.connect(c.destination),t.type="triangle",t.frequency.setValueAtTime(150,c.currentTime),t.frequency.exponentialRampToValueAtTime(80,c.currentTime+.06),o.gain.setValueAtTime(.1,c.currentTime),o.gain.exponentialRampToValueAtTime(.01,c.currentTime+.08),t.start(c.currentTime),t.stop(c.currentTime+.08)}function st(){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const t=c.createOscillator(),o=c.createOscillator(),a=c.createGain();t.connect(a),o.connect(a),a.connect(c.destination),t.type="sine",t.frequency.setValueAtTime(800,c.currentTime),t.frequency.exponentialRampToValueAtTime(400,c.currentTime+.15),o.type="triangle",o.frequency.setValueAtTime(1200,c.currentTime),o.frequency.exponentialRampToValueAtTime(600,c.currentTime+.15),a.gain.setValueAtTime(.12,c.currentTime),a.gain.exponentialRampToValueAtTime(.01,c.currentTime+.2),t.start(c.currentTime),o.start(c.currentTime),t.stop(c.currentTime+.2),o.stop(c.currentTime+.2)}function rt(t){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const o=523+t*100;[o,o*1.25,o*1.5].forEach((m,r)=>{const g=c.createOscillator(),x=c.createGain();g.connect(x),x.connect(c.destination),g.type="square",g.frequency.setValueAtTime(m,c.currentTime+r*.08),x.gain.setValueAtTime(.08,c.currentTime+r*.08),x.gain.exponentialRampToValueAtTime(.01,c.currentTime+r*.08+.15),g.start(c.currentTime+r*.08),g.stop(c.currentTime+r*.08+.15)})}function ct(){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const t=c.createOscillator(),o=c.createGain();t.connect(o),o.connect(c.destination),t.type="sawtooth",t.frequency.setValueAtTime(200,c.currentTime),t.frequency.exponentialRampToValueAtTime(100,c.currentTime+.5),o.gain.setValueAtTime(.2,c.currentTime),o.gain.exponentialRampToValueAtTime(.01,c.currentTime+.5),t.start(c.currentTime),t.stop(c.currentTime+.5)}function V(){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const t=c.createOscillator(),o=c.createGain();t.connect(o),o.connect(c.destination),t.type="square",t.frequency.setValueAtTime(800,c.currentTime),o.gain.setValueAtTime(.06,c.currentTime),o.gain.exponentialRampToValueAtTime(.01,c.currentTime+.03),t.start(c.currentTime),t.stop(c.currentTime+.03)}function _(t){O.haptics&&typeof window.triggerHaptic=="function"&&window.triggerHaptic(t)}function F(t){Y=Math.max(Y,t)}function ee(t,o=1){z=o,Ke=t}function dt(){Y>.1?(xe=(Math.random()-.5)*Y*2,Ie=(Math.random()-.5)*Y*2,Y*=d.SHAKE_DECAY):(xe=0,Ie=0,Y=0),z>0&&(z*=.85,z<.05&&(z=0))}let Q=[];function Je(){Q=[];const t=[{minH:250,maxH:500,baseColor:[200,210,225],depth:0,alpha:.3},{minH:200,maxH:450,baseColor:[180,195,215],depth:.15,alpha:.5},{minH:180,maxH:400,baseColor:[160,180,200],depth:.3,alpha:.7},{minH:140,maxH:320,baseColor:[130,155,180],depth:.5,alpha:.85},{minH:100,maxH:250,baseColor:[100,130,160],depth:.7,alpha:.95},{minH:60,maxH:180,baseColor:[70,100,135],depth:.9,alpha:1}];for(let o=0;o<t.length;o++){const a=t[o];let m=-100+o*17;const r=8-o;for(;m<n+150;){const g=30+o*15,x=g+Math.floor(Math.random()*(g*.8)),R=a.minH+Math.floor(Math.random()*(a.maxH-a.minH)),h=Math.floor(Math.random()*20)-10,P=Math.min(255,Math.max(0,a.baseColor[0]+h)),S=Math.min(255,Math.max(0,a.baseColor[1]+h)),I=Math.min(255,Math.max(0,a.baseColor[2]+h)),T="rgb("+P+","+S+","+I+")",u="rgb("+Math.floor(P*.7)+","+Math.floor(S*.7)+","+Math.floor(I*.7)+")",D="rgb("+Math.min(255,P+30)+","+Math.min(255,S+30)+","+Math.min(255,I+30)+")",b=[],A=Math.max(2,2+Math.floor(a.depth*6)),v=A+4+Math.floor(a.depth*4),L=A+5+Math.floor(a.depth*5),l=Math.floor((R-15)/L),y=Math.floor((x-8)/v);for(let M=0;M<l;M++)for(let C=0;C<y;C++)Math.random()>.1&&b.push({wx:C*v+6,wy:M*L+10,ww:A,wh:A+1});Q.push({x:m,width:x,height:R,color:T,shadowColor:u,highlightColor:D,depth:a.depth,hasSpire:R>350&&Math.random()>.6,hasWaterTower:a.depth>.5&&R>100&&R<200&&Math.random()>.7,hasAC:a.depth>.6&&Math.random()>.5,windows:b}),m+=x+r+Math.floor(Math.random()*15)}}Q.sort((o,a)=>o.depth-a.depth)}function ft(){switch(me){case"mountain":gt();break;case"beach":ut();break;default:ht();break}}function ht(){const t=e.createLinearGradient(0,0,0,i);t.addColorStop(0,"#2d8adb"),t.addColorStop(.3,"#5aa8e8"),t.addColorStop(.6,"#8fc5f2"),t.addColorStop(.85,"#c5e0f8"),t.addColorStop(1,"#e8f2fc"),e.fillStyle=t,e.fillRect(0,0,n,i);const o=e.createLinearGradient(0,i*.5,0,i);o.addColorStop(0,"rgba(255, 255, 255, 0)"),o.addColorStop(1,"rgba(255, 255, 255, 0.3)"),e.fillStyle=o,e.fillRect(0,i*.5,n,i*.5);const a=n*.15,m=i*.18,r=35,g=e.createRadialGradient(a,m,0,a,m,r*4);g.addColorStop(0,"rgba(255, 250, 220, 0.3)"),g.addColorStop(.5,"rgba(255, 250, 220, 0.1)"),g.addColorStop(1,"rgba(255, 250, 220, 0)"),e.fillStyle=g,e.beginPath(),e.arc(a,m,r*4,0,Math.PI*2),e.fill();const x=e.createRadialGradient(a,m,0,a,m,r*1.5);x.addColorStop(0,"rgba(255, 255, 240, 0.9)"),x.addColorStop(.7,"rgba(255, 255, 200, 0.4)"),x.addColorStop(1,"rgba(255, 255, 200, 0)"),e.fillStyle=x,e.beginPath(),e.arc(a,m,r*1.5,0,Math.PI*2),e.fill(),e.fillStyle="#fffef0",e.beginPath(),e.arc(a,m,r,0,Math.PI*2),e.fill();const R=[{baseX:0,y:30,scale:1.3,speed:.007},{baseX:n*.25,y:50,scale:1,speed:.006},{baseX:n*.5,y:20,scale:1.1,speed:.009},{baseX:n*.75,y:65,scale:.85,speed:.008},{baseX:n*.1,y:80,scale:.7,speed:.005},{baseX:n*.4,y:35,scale:.95,speed:.01},{baseX:n*.6,y:90,scale:.6,speed:.004},{baseX:n*.85,y:45,scale:.8,speed:.007},{baseX:n*.15,y:55,scale:.75,speed:.006},{baseX:n*.55,y:70,scale:.65,speed:.0055},{baseX:n*.3,y:15,scale:1,speed:.008},{baseX:n*.7,y:100,scale:.5,speed:.003}];for(const S of R){const I=(S.baseX+B*S.speed)%(n+150)-75,T=S.y,u=S.scale;e.fillStyle="rgba(200, 215, 235, 0.4)",e.beginPath(),e.arc(I+5,T+8*u,22*u,0,Math.PI*2),e.arc(I+30*u,T+10*u,18*u,0,Math.PI*2),e.arc(I+55*u,T+8*u,20*u,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.95)",e.beginPath(),e.arc(I,T,20*u,0,Math.PI*2),e.arc(I+18*u,T-8*u,16*u,0,Math.PI*2),e.arc(I+35*u,T-5*u,22*u,0,Math.PI*2),e.arc(I+55*u,T,18*u,0,Math.PI*2),e.arc(I+70*u,T+5*u,14*u,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 1)",e.beginPath(),e.arc(I+5*u,T-5*u,12*u,0,Math.PI*2),e.arc(I+35*u,T-12*u,14*u,0,Math.PI*2),e.arc(I+55*u,T-6*u,10*u,0,Math.PI*2),e.fill(),e.fillStyle="rgba(220, 230, 245, 0.6)",e.beginPath(),e.arc(I+10*u,T+6*u,10*u,0,Math.PI*2),e.arc(I+40*u,T+8*u,12*u,0,Math.PI*2),e.arc(I+62*u,T+6*u,8*u,0,Math.PI*2),e.fill()}e.fillStyle="rgba(255, 255, 255, 0.25)";for(let S=0;S<6;S++){const I=(S*120+30)%n,T=i*.25+S%3*15;e.fillRect(I,T,40+S%4*15,2),e.fillRect(I+10,T+4,25+S%3*10,1)}const h=[{baseX:0,y:40,speed:.05,size:4},{baseX:n*.4,y:30,speed:.045,size:4},{baseX:n*.7,y:50,speed:.055,size:5},{baseX:n*.2,y:80,speed:.04,size:5},{baseX:n*.55,y:100,speed:.035,size:6},{baseX:n*.85,y:70,speed:.042,size:5},{baseX:n*.1,y:140,speed:.06,size:7},{baseX:n*.5,y:160,speed:.055,size:8},{baseX:n*.75,y:130,speed:.05,size:7},{baseX:n*.3,y:180,speed:.065,size:8},{baseX:n*.15,y:i*.5,speed:.07,size:9},{baseX:n*.6,y:i*.55,speed:.065,size:9},{baseX:n*.9,y:i*.45,speed:.06,size:8}];for(let S=0;S<h.length;S++){const I=h[S],T=(I.baseX+B*I.speed)%(n+80)-40,u=I.y+Math.sin(B*.008+S*2)*4,D=Math.sin(B*.025+S*1.5)*(I.size*.5),b=.4+I.y/i*.4;e.strokeStyle="rgba(40, 40, 60, "+b+")",e.lineWidth=I.size>6?2:1.5,e.beginPath(),e.moveTo(T-I.size,u+D),e.lineTo(T,u),e.lineTo(T+I.size,u+D),e.stroke()}Q.length===0&&Je();for(const S of Q){const I=S.x-s.x*S.depth*.08,T=i-S.height;if(e.fillStyle=S.color,e.fillRect(I,T,S.width,S.height),e.fillStyle=S.highlightColor,e.fillRect(I,T,Math.max(2,S.width*.08),S.height),e.fillStyle=S.shadowColor,e.fillRect(I+S.width-Math.max(2,S.width*.1),T,Math.max(2,S.width*.1),S.height),S.depth>.4){e.fillStyle="rgba(0, 0, 0, 0.05)";for(let u=T+20;u<i;u+=25)e.fillRect(I,u,S.width,2)}if(S.windows.length>0)for(const u of S.windows){e.fillStyle="rgba(0, 0, 0, 0.2)",e.fillRect(I+u.wx-1,T+u.wy-1,u.ww+2,u.wh+2);const D=e.createLinearGradient(0,T+u.wy,0,T+u.wy+u.wh);D.addColorStop(0,"rgba(180, 220, 255, 0.7)"),D.addColorStop(1,"rgba(100, 150, 200, 0.5)"),e.fillStyle=D,e.fillRect(I+u.wx,T+u.wy,u.ww,u.wh)}}e.fillStyle="#b0a090",e.fillRect(0,i,n,E-i),e.strokeStyle="rgba(0, 0, 0, 0.08)",e.lineWidth=1;for(let S=0;S<n;S+=30)e.beginPath(),e.moveTo(S,i),e.lineTo(S,E),e.stroke();e.fillStyle="rgba(255, 255, 255, 0.3)",e.fillRect(0,i,n,3);const P=e.createLinearGradient(0,i,0,i+20);P.addColorStop(0,"rgba(0, 0, 0, 0.15)"),P.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=P,e.fillRect(0,i,n,20)}let ae=[];function mt(){me==="mountain"&&Math.random()<.005&&ae.push({x:Math.random()*n,y:Math.random()*i*.3,vx:4+Math.random()*4,vy:1+Math.random()*2,life:100,length:20+Math.random()*30});for(let t=ae.length-1;t>=0;t--){const o=ae[t];o.x+=o.vx,o.y+=o.vy,o.life-=1.5,o.life<=0&&ae.splice(t,1)}}function gt(){const t=e.createLinearGradient(0,0,0,i);t.addColorStop(0,"#0a0015"),t.addColorStop(.08,"#1a0533"),t.addColorStop(.18,"#3a1055"),t.addColorStop(.3,"#6a1a5a"),t.addColorStop(.42,"#9c2848"),t.addColorStop(.55,"#cc4433"),t.addColorStop(.68,"#e87722"),t.addColorStop(.8,"#f5a020"),t.addColorStop(.9,"#ffc830"),t.addColorStop(.97,"#ffe888"),t.addColorStop(1,"#fff8dd"),e.fillStyle=t,e.fillRect(0,0,n,i),mt();for(const l of ae){const y=l.life/100,M=e.createLinearGradient(l.x,l.y,l.x-l.vx*5,l.y-l.vy*5);M.addColorStop(0,`rgba(255, 255, 255, ${y})`),M.addColorStop(1,"rgba(255, 255, 255, 0)"),e.strokeStyle=M,e.lineWidth=2,e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(l.x-l.vx*3,l.y-l.vy*3),e.stroke()}const o=n*.65,a=i*.72;e.save();const m=10;for(let l=0;l<m;l++){const y=l/m*Math.PI*2+B*5e-5,M=e.createLinearGradient(o,a,o+Math.cos(y)*300,a+Math.sin(y)*300);M.addColorStop(0,"rgba(255, 200, 100, 0.06)"),M.addColorStop(.5,"rgba(255, 150, 80, 0.02)"),M.addColorStop(1,"rgba(255, 100, 50, 0)"),e.fillStyle=M,e.beginPath(),e.moveTo(o,a);const C=.12;e.lineTo(o+Math.cos(y-C)*400,a+Math.sin(y-C)*400),e.lineTo(o+Math.cos(y+C)*400,a+Math.sin(y+C)*400),e.closePath(),e.fill()}e.restore();const r=e.createRadialGradient(o,a,0,o,a,200);r.addColorStop(0,"rgba(255, 240, 180, 0.6)"),r.addColorStop(.2,"rgba(255, 200, 120, 0.4)"),r.addColorStop(.4,"rgba(255, 150, 80, 0.2)"),r.addColorStop(.7,"rgba(255, 100, 60, 0.05)"),r.addColorStop(1,"rgba(255, 80, 50, 0)"),e.fillStyle=r,e.beginPath(),e.arc(o,a,200,0,Math.PI*2),e.fill();const g=45,x=e.createRadialGradient(o,a,0,o,a,g*1.3);x.addColorStop(0,"#fffff8"),x.addColorStop(.3,"#fffae0"),x.addColorStop(.6,"#ffdd66"),x.addColorStop(.85,"#ffaa22"),x.addColorStop(1,"rgba(255, 140, 30, 0)"),e.fillStyle=x,e.beginPath(),e.arc(o,a,g*1.3,0,Math.PI*2),e.fill();const R=[{x:n*.05,y:12,s:1.5,b:.9},{x:n*.12,y:28,s:1,b:.6},{x:n*.18,y:8,s:2,b:1},{x:n*.25,y:42,s:1.2,b:.5},{x:n*.32,y:18,s:1.8,b:.8},{x:n*.38,y:55,s:.8,b:.4},{x:n*.45,y:22,s:1.5,b:.7},{x:n*.52,y:35,s:1,b:.5},{x:n*.6,y:15,s:1.8,b:.85},{x:n*.68,y:48,s:1.2,b:.45},{x:n*.75,y:25,s:2,b:.9},{x:n*.82,y:10,s:1.5,b:.75},{x:n*.88,y:38,s:1,b:.55},{x:n*.95,y:20,s:1.8,b:.8},{x:n*.08,y:50,s:.8,b:.35},{x:n*.22,y:62,s:.7,b:.3},{x:n*.42,y:68,s:.6,b:.25},{x:n*.55,y:58,s:.9,b:.35},{x:n*.03,y:32,s:1.1,b:.6},{x:n*.15,y:45,s:.9,b:.4},{x:n*.28,y:15,s:1.3,b:.7},{x:n*.48,y:12,s:1,b:.5},{x:n*.65,y:38,s:1.4,b:.65},{x:n*.85,y:52,s:.8,b:.4},{x:n*.92,y:8,s:1.6,b:.8},{x:n*.07,y:18,s:1.2,b:.55},{x:n*.35,y:32,s:1.1,b:.6},{x:n*.58,y:25,s:.9,b:.45},{x:n*.72,y:15,s:1.5,b:.75},{x:n*.88,y:42,s:1,b:.5},{x:n*.1,y:65,s:.7,b:.3},{x:n*.3,y:72,s:.6,b:.25},{x:n*.5,y:68,s:.8,b:.3},{x:n*.7,y:75,s:.7,b:.35}];for(const l of R){const y=e.createRadialGradient(l.x,l.y,0,l.x,l.y,l.s*3),M=.8+Math.sin(B*.005+l.x)*.2;y.addColorStop(0,"rgba(255, 255, 255, "+l.b*.8*M+")"),y.addColorStop(.5,"rgba(255, 255, 255, "+l.b*.2*M+")"),y.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=y,e.beginPath(),e.arc(l.x,l.y,l.s*3,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, "+l.b*M+")",e.beginPath(),e.arc(l.x,l.y,l.s,0,Math.PI*2),e.fill()}const h=(l,y,M,C)=>{const p=M;e.fillStyle="rgba(80, 40, 60, "+.3*C+")",e.beginPath(),e.ellipse(l+5,y+12*p,35*p,10*p,0,0,Math.PI*2),e.ellipse(l+40*p,y+14*p,28*p,8*p,0,0,Math.PI*2),e.fill();const k=e.createLinearGradient(l,y-15*p,l,y+15*p);k.addColorStop(0,"rgba(255, 200, 160, "+.7*C+")"),k.addColorStop(.5,"rgba(255, 150, 120, "+.6*C+")"),k.addColorStop(1,"rgba(200, 100, 100, "+.4*C+")"),e.fillStyle=k,e.beginPath(),e.ellipse(l,y,28*p,14*p,0,0,Math.PI*2),e.ellipse(l+22*p,y-6*p,22*p,12*p,.1,0,Math.PI*2),e.ellipse(l+45*p,y-3*p,26*p,14*p,-.1,0,Math.PI*2),e.ellipse(l+68*p,y+2*p,20*p,11*p,0,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 240, 200, "+.5*C+")",e.beginPath(),e.ellipse(l+8*p,y-8*p,15*p,6*p,.2,0,Math.PI*2),e.ellipse(l+35*p,y-12*p,18*p,7*p,0,0,Math.PI*2),e.ellipse(l+58*p,y-6*p,12*p,5*p,-.15,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 220, "+.35*C+")",e.beginPath(),e.ellipse(l+25*p,y-14*p,12*p,4*p,0,0,Math.PI*2),e.ellipse(l+50*p,y-10*p,10*p,3*p,.1,0,Math.PI*2),e.fill()};h(n*.02,i*.12,.9,.6),h(n*.25,i*.08,1.1,.7),h(n*.55,i*.15,.75,.55),h(n*.78,i*.1,.95,.65),h(n*.15,i*.22,.6,.45),h(n*.85,i*.2,.5,.4);const P=e.createLinearGradient(0,i*.45,0,i*.7);P.addColorStop(0,"rgba(100, 70, 100, 0.4)"),P.addColorStop(1,"rgba(120, 80, 110, 0.2)"),e.fillStyle=P,e.beginPath(),e.moveTo(0,i*.65),e.lineTo(n*.1,i*.58),e.lineTo(n*.2,i*.62),e.lineTo(n*.35,i*.5),e.lineTo(n*.45,i*.55),e.lineTo(n*.6,i*.45),e.lineTo(n*.75,i*.58),e.lineTo(n*.9,i*.52),e.lineTo(n,i*.6),e.lineTo(n,i),e.lineTo(0,i),e.closePath(),e.fill();const S=(l,y,M,C)=>{e.fillStyle=M,e.beginPath(),e.moveTo(l[0].x,i);for(let p=0;p<l.length;p++)if(e.lineTo(l[p].x,l[p].y),p<l.length-1&&l[p].y<l[p+1].y){const k=(l[p].x+l[p+1].x)/2;e.lineTo(k,i),e.lineTo(l[p].x,i)}e.closePath(),e.fill(),e.fillStyle=C,e.beginPath(),e.moveTo(l[l.length-1].x,i);for(let p=l.length-1;p>=0;p--)if(e.lineTo(l[p].x,l[p].y),p>0&&l[p].y<l[p-1].y){const k=(l[p].x+l[p-1].x)/2;e.lineTo(k,i),e.lineTo(l[p].x,i)}e.closePath(),e.fill(),e.strokeStyle=C,e.lineWidth=1,e.globalAlpha=.3;for(let p=1;p<l.length-1;p++)p%2===0&&(e.beginPath(),e.moveTo(l[p].x,l[p].y),e.lineTo(l[p].x+(Math.random()-.5)*20,l[p].y+40+Math.random()*40),e.stroke());e.globalAlpha=1},I=[{x:-20,y:i*.75},{x:n*.15,y:i*.52},{x:n*.25,y:i*.62},{x:n*.42,y:i*.45},{x:n*.55,y:i*.58},{x:n*.72,y:i*.48},{x:n*.88,y:i*.65},{w:n+20,y:i*.78}];I[I.length-1].x=n+20,S(I,"#4a2848","#5a3855","#3a1838"),e.fillStyle="rgba(255, 230, 245, 0.4)";const T=(l,y,M)=>{e.beginPath(),e.moveTo(l,y),e.lineTo(l-M,y+M*1.5);for(let C=l-M+4;C<l+M;C+=6)e.lineTo(C,y+M*1.2+Math.sin(C*.5)*4);e.lineTo(l+M,y+M*1.5),e.closePath(),e.fill()};T(n*.42,i*.45,18),T(n*.72,i*.48,15);const u=e.createLinearGradient(0,i*.55,0,i*.85);u.addColorStop(0,"rgba(255, 180, 160, 0)"),u.addColorStop(.5,"rgba(255, 180, 160, 0.1)"),u.addColorStop(1,"rgba(255, 160, 140, 0.05)"),e.fillStyle=u,e.fillRect(0,i*.55,n,i*.3);const D=[{x:-50,y:i*.85},{x:n*.1,y:i*.68},{x:n*.22,y:i*.78},{x:n*.38,y:i*.55},{x:n*.52,y:i*.68},{x:n*.65,y:i*.52},{x:n*.82,y:i*.75},{x:n+50,y:i*.88}];S(D,"#2d1538","#3d2248","#1d0a28"),e.fillStyle="rgba(255, 240, 250, 0.7)",T(n*.38,i*.55,25),T(n*.65,i*.52,22);const b=[{x:-100,y:i},{x:n*.15,y:i*.78},{x:n*.3,y:i*.88},{x:n*.5,y:i*.72},{x:n*.7,y:i*.85},{x:n*.88,y:i*.78},{x:n+100,y:i*.95}];S(b,"#120818","#1a0d20","#0a0410"),e.strokeStyle="rgba(255, 255, 255, 0.05)",e.lineWidth=1;for(let l=0;l<20;l++){const y=Math.random()*n,M=i*.8+Math.random()*i*.2;e.beginPath(),e.moveTo(y,M),e.lineTo(y+5,M-3),e.stroke()}e.strokeStyle="rgba(10, 5, 15, 0.7)",e.lineWidth=1.5;const A=[{baseX:0,y:i*.35,s:6,speed:.05},{baseX:n*.4,y:i*.28,s:5,speed:.04},{baseX:n*.6,y:i*.32,s:4,speed:.06},{baseX:n*.2,y:i*.25,s:5,speed:.045},{baseX:n*.8,y:i*.3,s:6,speed:.055}];for(let l=0;l<A.length;l++){const y=A[l],M=(y.baseX+B*y.speed)%(n+40)-20,C=y.y+Math.sin(B*.008+l*2)*4,p=Math.sin(B*.02+l*1.8)*3;e.beginPath(),e.moveTo(M-y.s,C+p),e.quadraticCurveTo(M-y.s*.3,C-2,M,C),e.quadraticCurveTo(M+y.s*.3,C-2,M+y.s,C+p),e.stroke()}const v=e.createLinearGradient(0,i,0,E);v.addColorStop(0,"#6a4535"),v.addColorStop(.3,"#5a3a2a"),v.addColorStop(.7,"#4a2f20"),v.addColorStop(1,"#3a2415"),e.fillStyle=v,e.fillRect(0,i,n,E-i);const L=e.createLinearGradient(0,i,0,i+30);L.addColorStop(0,"rgba(255, 180, 120, 0.25)"),L.addColorStop(1,"rgba(255, 150, 100, 0)"),e.fillStyle=L,e.fillRect(0,i,n,30),e.strokeStyle="rgba(0, 0, 0, 0.2)",e.lineWidth=2;for(let l=0;l<n;l+=32)e.beginPath(),e.moveTo(l,i),e.lineTo(l,E),e.stroke();e.fillStyle="rgba(60, 35, 20, 0.3)";for(let l=0;l<8;l++){const y=(l*47+15)%n,M=i+8+l%3*12;e.beginPath(),e.ellipse(y,M,3+l%2,2,0,0,Math.PI*2),e.fill()}e.fillStyle="rgba(255, 200, 150, 0.3)",e.fillRect(0,i,n,3)}function ut(){const t=e.createLinearGradient(0,0,0,i);t.addColorStop(0,"#0077aa"),t.addColorStop(.3,"#1fb1d9"),t.addColorStop(.6,"#7dd3e8"),t.addColorStop(.85,"#b8e8f5"),t.addColorStop(1,"#e0f6fc"),e.fillStyle=t,e.fillRect(0,0,n,i);const o=n*.8,a=i*.2,m=45;e.save();const r=12;for(let b=0;b<r;b++){const A=b/r*Math.PI*2+B*1e-4,v=e.createLinearGradient(o,a,o+Math.cos(A)*400,a+Math.sin(A)*400);v.addColorStop(0,"rgba(255, 255, 240, 0.08)"),v.addColorStop(.5,"rgba(255, 255, 220, 0.03)"),v.addColorStop(1,"rgba(255, 255, 200, 0)"),e.fillStyle=v,e.beginPath(),e.moveTo(o,a);const L=.15;e.lineTo(o+Math.cos(A-L)*600,a+Math.sin(A-L)*600),e.lineTo(o+Math.cos(A+L)*600,a+Math.sin(A+L)*600),e.closePath(),e.fill()}e.restore();const g=e.createRadialGradient(o,a,0,o,a,m*4);g.addColorStop(0,"rgba(255, 255, 240, 0.7)"),g.addColorStop(.2,"rgba(255, 255, 200, 0.4)"),g.addColorStop(.5,"rgba(255, 255, 150, 0.1)"),g.addColorStop(1,"rgba(255, 255, 120, 0)"),e.fillStyle=g,e.beginPath(),e.arc(o,a,m*4,0,Math.PI*2),e.fill(),e.fillStyle="#fffdf0",e.beginPath(),e.arc(o,a,m,0,Math.PI*2),e.fill();const x=(b,A,v,L)=>{const l=v;e.fillStyle=`rgba(255, 255, 255, ${L})`,e.beginPath(),e.arc(b,A,18*l,0,Math.PI*2),e.arc(b+15*l,A-10*l,14*l,0,Math.PI*2),e.arc(b+35*l,A-5*l,20*l,0,Math.PI*2),e.arc(b+55*l,A,16*l,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(255, 255, 240, ${L*.8})`,e.beginPath(),e.arc(b+8*l,A-8*l,10*l,0,Math.PI*2),e.arc(b+30*l,A-12*l,12*l,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(180, 220, 240, ${L*.4})`,e.beginPath(),e.arc(b+10*l,A+8*l,12*l,0,Math.PI*2),e.arc(b+40*l,A+10*l,14*l,0,Math.PI*2),e.fill()},R=[{baseX:0,y:35,s:1.1,speed:.008},{baseX:n*.3,y:55,s:1.3,speed:.006},{baseX:n*.6,y:25,s:.9,speed:.009},{baseX:n*.85,y:65,s:1,speed:.007}];for(const b of R){const A=(b.baseX+B*b.speed)%(n+150)-75;x(A,b.y,b.s,.9)}const h=i*.65,P=e.createLinearGradient(0,h,0,i);P.addColorStop(0,"#005588"),P.addColorStop(.4,"#0077aa"),P.addColorStop(.8,"#20a0cc"),P.addColorStop(1,"#40b8dd"),e.fillStyle=P,e.fillRect(0,h,n,i-h);for(let b=0;b<5;b++){const A=h+15+b*25,v=B*.03+b*50;e.strokeStyle=`rgba(255, 255, 255, ${.15+b*.03})`,e.lineWidth=2,e.beginPath();for(let L=0;L<n;L+=6){const l=A+Math.sin((L+v)*.045)*4;L===0?e.moveTo(L,l):e.lineTo(L,l)}e.stroke(),e.fillStyle="rgba(255, 255, 240, 0.2)";for(let L=0;L<n;L+=40){const l=(L+v*.8)%n,y=A+Math.sin((l+v)*.045)*4-2;e.fillRect(l,y,10,1)}}const S=(b,A,v,L)=>{const l=(b+B*L)%(n+100)-50,y=v,M=Math.sin(B*.002+b)*2;e.fillStyle="#ffffff",e.beginPath(),e.moveTo(l-12*y,A+M),e.lineTo(l+12*y,A+M),e.lineTo(l+8*y,A+5*y+M),e.lineTo(l-8*y,A+5*y+M),e.closePath(),e.fill(),e.strokeStyle="#dddddd",e.lineWidth=1,e.stroke(),e.fillStyle="#8b4513",e.fillRect(l-1,A-18*y+M,2,18*y),e.fillStyle="#fffdf0",e.beginPath(),e.moveTo(l,A-16*y+M),e.lineTo(l+10*y,A-2*y+M),e.lineTo(l,A-2*y+M),e.closePath(),e.fill(),e.beginPath(),e.moveTo(l-1,A-14*y+M),e.lineTo(l-7*y,A-3*y+M),e.lineTo(l-1,A-3*y+M),e.closePath(),e.fill()};S(n*.2,h+25,1,.015),S(n*.6,h+45,.8,.012),S(n*.45,h+15,.6,.008),e.fillStyle="#e8d8a0",e.beginPath(),e.moveTo(0,h+20),e.lineTo(0,i),e.lineTo(n*.12,i),e.lineTo(n*.04,h+30),e.closePath(),e.fill(),e.beginPath(),e.moveTo(n,h+25),e.lineTo(n,i),e.lineTo(n*.88,i),e.lineTo(n*.96,h+35),e.closePath(),e.fill(),e.fillStyle="rgba(0, 0, 0, 0.05)";for(let b=0;b<20;b++){const A=b*23%(n*.12),v=i-5-b%8*4;e.fillRect(A,v,2,2);const L=n-b*19%(n*.12);e.fillRect(L,v,2,2)}const I=(b,A,v,L)=>{e.save(),e.translate(b,A),e.rotate(L),e.fillStyle="#6b4423",e.beginPath(),e.moveTo(-5,0),e.quadraticCurveTo(-2,-v*.5,-3,-v),e.lineTo(3,-v),e.quadraticCurveTo(2,-v*.5,5,0),e.closePath(),e.fill(),e.strokeStyle="#4a3015",e.lineWidth=1;for(let y=-10;y>-v+10;y-=8)e.beginPath(),e.arc(0,y,4,.3,Math.PI-.3),e.stroke();e.fillStyle="#228833";const l=7;for(let y=0;y<l;y++){const M=y/l*Math.PI*2+B*2e-4,C=35+Math.sin(y*1.5)*10;e.save(),e.translate(0,-v),e.rotate(M),e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(C*.5,-12,C,8),e.quadraticCurveTo(C*.5,-4,0,0),e.fill(),e.fillStyle="#32a852",e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(C*.4,-8,C*.8,2),e.quadraticCurveTo(C*.4,-2,0,0),e.fill(),e.restore()}e.restore()};I(n*.06,i,85,-.05),I(n*.03,i+10,70,-.12),I(n*.94,i,90,.08),I(n*.97,i+15,65,.15);const T=e.createLinearGradient(0,i,0,E);T.addColorStop(0,"#8a6a4a"),T.addColorStop(.5,"#705838"),T.addColorStop(1,"#504028"),e.fillStyle=T,e.fillRect(0,i,n,E-i),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.lineWidth=2;for(let b=0;b<n;b+=30)e.beginPath(),e.moveTo(b,i),e.lineTo(b,E),e.stroke(),e.strokeStyle="rgba(255, 255, 255, 0.1)",e.beginPath(),e.moveTo(b+2,i),e.lineTo(b+2,E),e.stroke();const u=(b,A,v,L,l,y)=>{const M=b-s.x*.05,C=A-L;e.fillStyle=l,e.fillRect(M,C,v,L);const p=v/6;for(let k=0;k<6;k++)e.fillStyle=k%2===0?"#ffffff":"#ff4040",e.fillRect(M+k*p,C-12,p,14);e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(M+v*.2,C+L*.3,v*.6,L*.5),e.fillStyle="#fff5e6",e.strokeStyle="#4a2500",e.lineWidth=2,e.fillRect(M+5,C+5,v-10,15),e.strokeRect(M+5,C+5,v-10,15),e.fillStyle="#4a2500",e.font="bold 6px 'Press Start 2P'",e.fillText(y,M+v*.5-y.length*3,C+16),e.fillStyle="rgba(0, 0, 0, 0.1)",e.fillRect(M,A,v,8)};u(n*.15,i,60,50,"#f5e6d3","SURF"),u(n*.45,i,70,60,"#d3f5e6","TACO"),u(n*.75,i,65,55,"#e6d3f5","ICE"),e.fillStyle="#4a2500";for(let b=0;b<n;b+=40){const A=b-s.x*.02;e.fillRect(A,i-20,4,20),e.fillRect(A-20,i-20,40,3),e.fillRect(A-20,i-12,40,2)}const D=[{baseX:n*.3,y:80,speed:.04},{baseX:n*.5,y:65,speed:.05},{baseX:n*.8,y:100,speed:.035},{baseX:n*.1,y:90,speed:.045}];e.strokeStyle="rgba(255, 255, 255, 0.85)",e.lineWidth=1.5;for(let b=0;b<D.length;b++){const A=D[b],v=(A.baseX+B*A.speed)%(n+60)-30,L=A.y+Math.sin(B*.012+b)*6,l=Math.sin(B*.025+b*1.5)*5;e.beginPath(),e.moveTo(v-8,L+l),e.quadraticCurveTo(v-4,L-2,v,L),e.quadraticCurveTo(v+4,L-2,v+8,L+l),e.stroke()}e.fillStyle="rgba(255, 255, 255, 0.25)",e.fillRect(0,i,n,3)}function pe(){const t=s.x,o=s.y,a=d.BALL_RADIUS,m=i-o,r=Math.max(.5,1-m/800),g=Math.max(.25,.5-m/1e3);e.fillStyle="rgba(0, 0, 0, "+g+")",e.beginPath(),e.ellipse(t,i-2,a*r*1.2,a*.3*r,0,0,Math.PI*2),e.fill(),e.save(),e.translate(t,o),e.rotate(s.rotation);const x=e.createRadialGradient(-a*.3,-a*.3,0,0,0,a);if(x.addColorStop(0,"#ff9955"),x.addColorStop(.5,"#ff7722"),x.addColorStop(1,"#cc5500"),e.fillStyle=x,e.beginPath(),e.arc(0,0,a,0,Math.PI*2),e.fill(),e.strokeStyle="#8b4513",e.lineWidth=2,e.stroke(),e.strokeStyle="#4a2500",e.lineWidth=2,e.beginPath(),e.moveTo(-a+2,0),e.lineTo(a-2,0),e.stroke(),e.beginPath(),e.moveTo(0,-a+2),e.lineTo(0,a-2),e.stroke(),e.beginPath(),e.arc(-a*.4,0,a*.7,-Math.PI/2,Math.PI/2),e.stroke(),e.beginPath(),e.arc(a*.4,0,a*.7,Math.PI/2,-Math.PI/2),e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.ellipse(-a*.3,-a*.3,a*.25,a*.15,-Math.PI/4,0,Math.PI*2),e.fill(),e.restore(),$){e.save();const R=e.createRadialGradient(t,o,a,t,o,a*2.5);R.addColorStop(0,"rgba(255, 100, 0, 0.4)"),R.addColorStop(.5,"rgba(255, 50, 0, 0.2)"),R.addColorStop(1,"rgba(255, 0, 0, 0)"),e.fillStyle=R,e.beginPath(),e.arc(t,o,a*2.5,0,Math.PI*2),e.fill();const h=8;for(let P=0;P<h;P++){const S=P/h*Math.PI*2+B*.01,I=a*(.8+Math.sin(B*.03+P*2)*.4),T=t+Math.cos(S)*(a+2),u=o+Math.sin(S)*(a+2),D=t+Math.cos(S)*(a+I),b=o+Math.sin(S)*(a+I)-I*.3,A=e.createLinearGradient(T,u,D,b);A.addColorStop(0,"rgba(255, 200, 0, 0.9)"),A.addColorStop(.5,"rgba(255, 100, 0, 0.7)"),A.addColorStop(1,"rgba(255, 0, 0, 0)"),e.fillStyle=A,e.beginPath(),e.moveTo(T-4,u),e.quadraticCurveTo(D,b,T+4,u),e.fill()}e.restore()}}function Se(){const t=f.x,o=f.y,a=d.HOOP_WIDTH,m=d.RIM_RADIUS,r=f.side==="left",g=r?t-a/2-d.BACKBOARD_WIDTH:t+a/2,x=d.BACKBOARD_HEIGHT*.7,R=o-x;e.fillStyle="#ffffff",e.fillRect(g,R,d.BACKBOARD_WIDTH,d.BACKBOARD_HEIGHT),e.strokeStyle="#333333",e.lineWidth=3,e.strokeRect(g,R,d.BACKBOARD_WIDTH,d.BACKBOARD_HEIGHT),e.strokeStyle="#ff4444",e.lineWidth=2;const h=20,P=g+d.BACKBOARD_WIDTH/2-h/2;e.strokeRect(P,o-h/2,h,h),e.fillStyle="#666666";const S=r?t-a/2:t+a/2-8;e.fillRect(S,o-4,8,8),yt(t,o,a),e.strokeStyle="#ff6600",e.lineWidth=6,e.fillStyle="#ff6600",e.beginPath(),e.arc(t-a/2+m,o,m,0,Math.PI*2),e.fill(),e.strokeStyle="#cc4400",e.lineWidth=2,e.stroke(),e.fillStyle="#ff6600",e.beginPath(),e.arc(t+a/2-m,o,m,0,Math.PI*2),e.fill(),e.stroke(),e.strokeStyle="#ff6600",e.lineWidth=4,e.beginPath(),e.moveTo(t-a/2+m,o-m),e.lineTo(t+a/2-m,o-m),e.stroke(),e.beginPath(),e.moveTo(t-a/2+m,o+m),e.lineTo(t+a/2-m,o+m),e.stroke()}function yt(t,o,a){const r=d.NET_SEGMENTS,g=o+d.RIM_RADIUS,x=a*.5,R=Math.min(Math.abs(f.netWave)*.8+1,20);e.strokeStyle="#ffffff",e.lineWidth=2,e.globalAlpha=.8;for(let h=0;h<=r;h++){const P=h/r,S=t-a/2+a*P,I=t-x/2+x*P,T=Math.sin(f.netWave*.5+h*.8)*R;e.beginPath(),e.moveTo(S,g),e.quadraticCurveTo((S+I)/2+T,g+35*.6,I+T,g+35),e.stroke()}for(let h=1;h<=3;h++){const P=g+8.75*h,S=h/4,I=a*(1-S*.5),T=Math.sin(f.netWave*.5+h*1.2)*R*.8;e.beginPath(),e.moveTo(t-I/2+T,P+Math.sin(f.netWave+h)*R*.5),e.lineTo(t+I/2+T,P+Math.sin(f.netWave+h+1)*R*.5),e.stroke()}e.globalAlpha=1}function pt(t){const o=t.life/t.maxLife;if(e.save(),e.globalAlpha=o,e.translate(t.x,t.y),e.rotate(t.rotation),t.type==="star"){e.fillStyle=t.color;const a=t.size*o;e.beginPath();for(let m=0;m<5;m++){const r=m/5*Math.PI*2-Math.PI/2,g=r+Math.PI/5;e.lineTo(Math.cos(r)*a,Math.sin(r)*a),e.lineTo(Math.cos(g)*a*.4,Math.sin(g)*a*.4)}e.closePath(),e.fill()}else if(t.type==="confetti")e.fillStyle=t.color,e.fillRect(-t.size/2,-t.size/4,t.size,t.size/2);else{const a=t.size*o;e.fillStyle=t.color,e.beginPath(),e.arc(0,0,a,0,Math.PI*2),e.fill()}e.restore()}function we(){for(const t of N)pt(t)}function De(){for(const t of q){const o=1-t.life/t.maxLife,a=1-ot(o),m=t.y-o*40,r=t.scale*(1+at(Math.min(o*2,1))*.2);e.save(),e.globalAlpha=a,e.translate(t.x,m),e.scale(r,r),e.font="bold 16px 'Press Start 2P', monospace",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#000000",e.fillText(t.value,2,2),e.fillStyle=t.color,e.fillText(t.value,0,0),e.restore()}}function ke(){z>0&&(e.fillStyle=Ke,e.globalAlpha=z*.4,e.fillRect(0,0,n,E),e.globalAlpha=1)}let ce=-1,Ae=-1;function He(){G!==ce&&(Qe.textContent=G.toString(),ce!==-1&&(Oe.classList.add("pop"),setTimeout(()=>Oe.classList.remove("pop"),120)),ce=G);const t=Math.ceil(Z);t!==Ae&&(je.textContent=t.toString(),Ae=t,t<=d.WARNING_TIME&&t>0?J.classList.add("warning"):J.classList.remove("warning"))}function St(){const t=document.getElementById("timer-bonus-popup");t.classList.remove("animate"),J.classList.remove("pop"),t.offsetWidth,t.classList.add("animate"),J.classList.add("pop"),setTimeout(()=>J.classList.remove("pop"),150)}function te(t,o,a,m,r=1){const x=Math.max(60,Math.min(n-60,t)),R=Math.max(60,Math.min(i-60,o));q.push({x,y:R,value:a,life:d.POPUP_DURATION,maxLife:d.POPUP_DURATION,color:m,scale:r})}function bt(t,o){const a=["#ff9955","#ffcc88","#ffffff"];for(let m=0;m<8;m++){const r=m/8*Math.PI*2,g=2+Math.random()*2;N.push({x:t,y:o,vx:Math.cos(r)*g,vy:Math.sin(r)*g+2,life:300+Math.random()*100,maxLife:400,size:4+Math.random()*3,color:a[Math.floor(Math.random()*a.length)],type:"burst",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2})}}function Tt(t,o){const a=["#ffff00","#ff8800","#ffffff","#ff4400"];for(let m=0;m<d.PARTICLE_COUNT;m++){const r=m/d.PARTICLE_COUNT*Math.PI*2,g=4+Math.random()*4,x=Math.random()>.5;N.push({x:t,y:o,vx:Math.cos(r)*g,vy:Math.sin(r)*g-3,life:d.PARTICLE_LIFE+Math.random()*200,maxLife:d.PARTICLE_LIFE+Math.random()*200,size:x?8+Math.random()*5:5+Math.random()*4,color:a[Math.floor(Math.random()*a.length)],type:x?"star":"burst",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.25})}}function Mt(t,o,a){const m=["#ffff00","#00ffff","#ff00ff","#00ff00"];for(let r=0;r<20+a*5;r++){const g=Math.random()*Math.PI*2,x=3+Math.random()*5;N.push({x:t+(Math.random()-.5)*60,y:o+(Math.random()-.5)*40,vx:Math.cos(g)*x,vy:Math.sin(g)*x-4,life:800+Math.random()*400,maxLife:1e3,size:6+Math.random()*4,color:m[Math.floor(Math.random()*m.length)],type:"confetti",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.4})}}function xt(t){s.vy+=d.GRAVITY,s.vx*=d.AIR_RESISTANCE,s.vy*=d.AIR_RESISTANCE,s.x+=s.vx,s.y+=s.vy,s.rotation+=s.vx*.05;const o=!0;if(s.x-d.BALL_RADIUS<0&&(f.side==="left"&&o?(s.x=n-d.BALL_RADIUS-5,console.log("[updateBall] Ball portaled from left wall to right")):(s.x=d.BALL_RADIUS,s.vx=-s.vx*d.WALL_BOUNCE,ie(),_("light"))),s.x+d.BALL_RADIUS>n&&(f.side==="right"&&o?(s.x=d.BALL_RADIUS+5,console.log("[updateBall] Ball portaled from right wall to left")):(s.x=n-d.BALL_RADIUS,s.vx=-s.vx*d.WALL_BOUNCE,ie(),_("light"))),s.y+d.BALL_RADIUS>=i&&(s.y=i-d.BALL_RADIUS,s.vy=-s.vy*d.GROUND_BOUNCE,s.lastGroundTime=B,Math.abs(s.vy)>1&&(ie(),_("light")),Math.abs(s.vy)<2&&(s.vy=0)),s.y-d.BALL_RADIUS<0&&(s.y=d.BALL_RADIUS,s.vy=-s.vy*d.WALL_BOUNCE,ie(),_("light")),Pt(),$){const a=Math.sqrt(s.vx*s.vx+s.vy*s.vy),m=Math.min(3,Math.floor(a*.3)+1);for(let r=0;r<m;r++){const g=["#ff4400","#ff6600","#ff8800","#ffaa00","#ffcc00"];X.push({x:s.x+(Math.random()-.5)*d.BALL_RADIUS,y:s.y+(Math.random()-.5)*d.BALL_RADIUS,vx:-s.vx*.2+(Math.random()-.5)*2,vy:-s.vy*.2-Math.random()*3,life:300+Math.random()*200,size:4+Math.random()*8,color:g[Math.floor(Math.random()*g.length)]})}X.length>100&&(X=X.slice(-80))}}function It(t){for(let o=X.length-1;o>=0;o--){const a=X[o];a.x+=a.vx,a.y+=a.vy,a.vy-=.1,a.life-=t,a.size*=.97,(a.life<=0||a.size<1)&&X.splice(o,1)}}function At(){for(const t of X){const o=Math.min(1,t.life/200);e.globalAlpha=o,e.fillStyle=t.color,e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fill()}e.globalAlpha=1}function be(){if(w!=="PLAYING")return;Fe(),s.vy=-13;const t=f.side==="left"?-1:1;t===-1&&s.vx>0||t===1&&s.vx<0?s.vx=t*Math.abs(s.vx)*.5+t*d.HORIZONTAL_BIAS:s.vx+=t*d.HORIZONTAL_BIAS,s.vx=Math.max(-8,Math.min(8,s.vx)),bt(s.x,s.y),F(d.SHAKE_BOOST),it(),_("light"),console.log("[boost] Boost used")}let se=!1;function Pt(){const t=f.x-d.HOOP_WIDTH/2+d.RIM_RADIUS,o=f.x+d.HOOP_WIDTH/2-d.RIM_RADIUS,a=f.y,m=d.RIM_RADIUS,r=Ge(s.x,s.y,d.BALL_RADIUS,t,a,m);r.colliding&&Ne(t,a,r);const g=Ge(s.x,s.y,d.BALL_RADIUS,o,a,m);g.colliding&&Ne(o,a,g),vt(),Lt(),Rt()}function Ge(t,o,a,m,r,g){const x=t-m,R=o-r,h=Math.sqrt(x*x+R*R),P=a+g;return h<P&&h>0?{colliding:!0,overlap:P-h,normalX:x/h,normalY:R/h}:{colliding:!1,overlap:0,normalX:0,normalY:0}}function Ne(t,o,a){s.x+=a.normalX*(a.overlap+2),s.y+=a.normalY*(a.overlap+2);const r=s.vx*a.normalX+s.vy*a.normalY;if(r<0){s.vx-=2*r*a.normalX*.8,s.vy-=2*r*a.normalY*.8;const x=3,R=Math.sqrt(s.vx*s.vx+s.vy*s.vy);if(R<x){const h=x/Math.max(R,.1);s.vx*=h,s.vy*=h}Bt(),_("medium"),F(3),Ct(t,o),he=!0,Be=B,console.log("[resolveRimBounce] Ball bounced off rim at time "+B)}}function vt(){const t=f.side==="left",o=t?f.x-d.HOOP_WIDTH/2-d.BACKBOARD_WIDTH:f.x+d.HOOP_WIDTH/2,a=d.BACKBOARD_HEIGHT*.7,m=f.y-a,r=f.y+(d.BACKBOARD_HEIGHT-a);if(t){const g=o+d.BACKBOARD_WIDTH;s.x-d.BALL_RADIUS<g&&s.x+d.BALL_RADIUS>o&&s.y>m&&s.y<r&&s.vx<0&&(s.x=g+d.BALL_RADIUS,s.vx=-s.vx*.75,s.vy*=.9,Ue(),_("medium"),F(4),We(g,s.y),ne=!0,fe=B,console.log("[checkBackboardCollision] Bank shot off left backboard at time "+B))}else s.x+d.BALL_RADIUS>o&&s.x-d.BALL_RADIUS<o+d.BACKBOARD_WIDTH&&s.y>m&&s.y<r&&s.vx>0&&(s.x=o-d.BALL_RADIUS,s.vx=-s.vx*.75,s.vy*=.9,Ue(),_("medium"),F(4),We(o,s.y),ne=!0,fe=B,console.log("[checkBackboardCollision] Bank shot off right backboard at time "+B))}function We(t,o){const a=["#ffffff","#dddddd","#ff4444"];for(let m=0;m<8;m++){const r=Math.random()*Math.PI*2,g=2+Math.random()*3;N.push({x:t,y:o,vx:Math.cos(r)*g,vy:Math.sin(r)*g,life:400,maxLife:400,size:2+Math.random()*3,color:a[Math.floor(Math.random()*a.length)],type:"burst",rotation:0,rotationSpeed:0})}}function Ue(){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const t=c.createOscillator(),o=c.createGain();t.connect(o),o.connect(c.destination),t.type="square",t.frequency.setValueAtTime(150,c.currentTime),t.frequency.exponentialRampToValueAtTime(80,c.currentTime+.1),o.gain.setValueAtTime(.3,c.currentTime),o.gain.exponentialRampToValueAtTime(.01,c.currentTime+.15),t.start(c.currentTime),t.stop(c.currentTime+.15)}let Te=!1;function Rt(){const t=f.y+d.RIM_RADIUS,o=t+35,a=Math.max(0,Math.min(1,(s.y-t)/(o-t))),m=d.HOOP_WIDTH*(1-a*.5),r=f.x-m/2,g=f.x+m/2,x=s.y>t&&s.y<o,R=s.x>r&&s.x<g;if(x&&R){if(!Te){Te=!0;const P=Math.sqrt(s.vx*s.vx+s.vy*s.vy)*.8;f.netWave+=P*(s.vx>0?1:-1),f.netWave+=s.vy*.3,console.log("[checkNetCollision] Ball entered net, wave: "+f.netWave.toFixed(2))}f.netWave+=s.vx*.15,s.vx*=.97,s.vy*=.98;const h=d.BALL_RADIUS*.5;s.x-h<r?(s.x=r+h,s.vx=Math.abs(s.vx)*.5,f.netWave-=8):s.x+h>g&&(s.x=g-h,s.vx=-Math.abs(s.vx)*.5,f.netWave+=8)}else Te=!1}function Lt(){if(f.scored)return;const t=f.x-d.HOOP_WIDTH/2+d.RIM_RADIUS*2,o=f.x+d.HOOP_WIDTH/2-d.RIM_RADIUS*2,a=f.y,m=a+d.RIM_RADIUS+40,r=s.y+d.BALL_RADIUS<a,g=s.x>t&&s.x<o;r&&g&&s.vy>0&&(se=!0);const x=s.y>a+d.RIM_RADIUS,R=s.y<m,h=s.vy>0;se&&x&&R&&g&&h&&(f.scored=!0,se=!1,Ot(),console.log("[checkScoring] SCORE! Ball went through cleanly")),(!g||s.y>m+20)&&(se=!1)}function Ct(t,o){const a=["#ff6600","#ff8844","#ffaa66"];for(let m=0;m<6;m++){const r=Math.random()*Math.PI*2,g=2+Math.random()*2;N.push({x:t,y:o,vx:Math.cos(r)*g,vy:Math.sin(r)*g,life:300,maxLife:300,size:3+Math.random()*2,color:a[Math.floor(Math.random()*a.length)],type:"burst",rotation:0,rotationSpeed:0})}}function Bt(){if(!O.fx||!c)return;c.state==="suspended"&&c.resume();const t=c.createOscillator(),o=c.createGain();t.connect(o),o.connect(c.destination),t.type="sine",t.frequency.setValueAtTime(600,c.currentTime),t.frequency.exponentialRampToValueAtTime(400,c.currentTime+.1),o.gain.setValueAtTime(.15,c.currentTime),o.gain.exponentialRampToValueAtTime(.01,c.currentTime+.15),t.start(c.currentTime),t.stop(c.currentTime+.15)}function Ot(){U++;const t=f.side==="left"?1:-1;s.vx=t*4,s.vy=-2;const o=B;o-Me<d.COMBO_WINDOW?H++:(H=1,$=!1),Me=o,H>=5&&!$&&($=!0,F(15),ee("#ff4400",1),_("heavy"),console.log("[onScore] BALL IS ON FIRE!"));const a=B-Be,m=B-fe,r=ne&&m<d.BACKBOARD_VALID_WINDOW,g=he&&a>d.RIM_RATTLE_THRESHOLD&&!r,x=!r&&!g,R=r;let h=d.BASE_POINTS,P=1;x?P=1.5:R&&(P=1.25),H>1?h=Math.floor(d.BASE_POINTS*Math.pow(d.COMBO_MULTIPLIER,H-1)*P):h=Math.floor(d.BASE_POINTS*P),G+=h,Z+=d.TIME_BONUS_PER_SCORE,St(),Tt(f.x,f.y),f.netWave+=12;const S=n/2,I=E*.3;if(x){const T=[{text:"SWISH!",color:"#00ffaa"},{text:"NOTHING BUT NET!",color:"#60c0ff"},{text:"CLEAN!",color:"#90ff90"},{text:"PERFECT!",color:"#ffd700"},{text:"PURE!",color:"#ffffff"}],u=T[Math.floor(Math.random()*T.length)];te(S,I,u.text,u.color,1.5),ee(u.color,.6),st(),_("success"),console.log("[onScore] "+u.text+" Nothing but net!")}else if(R){const T=[{text:"BANK SHOT!",color:"#ff88ff"},{text:"OFF THE GLASS!",color:"#88ccff"},{text:"BANKED IT!",color:"#ffcc00"},{text:"ANGLES!",color:"#90ffcc"},{text:"TIM DUNCAN!",color:"#a0a0a0"}],u=T[Math.floor(Math.random()*T.length)];te(S,I,u.text,u.color,1.4),ee(u.color,.5),_("medium"),console.log("[onScore] "+u.text+" Off the glass!")}else if(g){const T=[{text:"RIM BOUNCE!",color:"#ffaa00"},{text:"LUCKY BOUNCE!",color:"#ff7070"},{text:"OFF THE RIM!",color:"#ffa0a0"},{text:"RATTLED IN!",color:"#ffcc80"}],u=T[Math.floor(Math.random()*T.length)];te(S,I,u.text,u.color,1.3),ee(u.color,.4),_("light"),console.log("[onScore] "+u.text+" Lucky bounce! (rattled for "+a+"ms)")}H>1?(Mt(n/2,E/2,H),te(f.x,f.y-30,"+"+h+" x"+H,"#ffff00",1.2),F(d.SHAKE_COMBO),ee("#ffff00",.8),rt(H),_("medium"),re.textContent=H+"x COMBO!",re.classList.add("active"),setTimeout(()=>re.classList.remove("active"),1500)):(te(f.x,f.y-30,"+"+h,"#ffffff",1),F(d.SHAKE_SCORE)),ne=!1,he=!1,Et(),console.log("[onScore] Scored! Points: "+h+", Combo: "+H+", Total: "+G)}function Et(){f.side=f.side==="left"?"right":"left",f.targetX=ye(f.side);const t=E*d.HOOP_Y_MIN_RATIO,o=E*d.HOOP_Y_MAX_RATIO;f.targetY=t+Math.random()*(o-t),f.animationProgress=0,f.scored=!1,Fe(),console.log("[switchHoopSide] Hoop switching to "+f.side+" at height "+Math.round(f.targetY))}function ye(t){return t==="left"?d.HOOP_MARGIN+d.HOOP_WIDTH/2+d.BACKBOARD_WIDTH:n-d.HOOP_MARGIN-d.HOOP_WIDTH/2-d.BACKBOARD_WIDTH}function _t(t){if(f.animationProgress<1){f.animationProgress+=t/d.HOOP_SWITCH_DURATION,f.animationProgress>1&&(f.animationProgress=1);const o=nt(f.animationProgress);f.x=_e(f.x,f.targetX,o*.2),f.y=_e(f.y,f.targetY,o*.2)}else f.x=f.targetX,f.y=f.targetY;f.netWave*=.92,Math.abs(f.netWave)<.01&&(f.netWave=0)}function Xe(t){for(let o=N.length-1;o>=0;o--){const a=N[o];a.x+=a.vx,a.y+=a.vy,a.vy+=.15,a.vx*=.98,a.rotation+=a.rotationSpeed,a.life-=t,a.life<=0&&N.splice(o,1)}}function Ye(t){for(let o=q.length-1;o>=0;o--)q[o].life-=t,q[o].life<=0&&q.splice(o,1)}function wt(t){w==="PLAYING"&&(Z-=t/1e3,Z<=0&&(Z=0,kt()))}function Dt(){console.log("[resetGame] Resetting game state"),G=0,U=0,H=0,Me=0,$=!1,X=[],Z=d.GAME_DURATION,B=0,N=[],q=[],Y=0,z=0,ce=-1,Ae=-1,s.x=n/2,s.y=i-d.BALL_RADIUS-125,s.vx=0,s.vy=0,s.rotation=0,s.lastGroundTime=0,f.side="right",f.x=ye("right"),f.targetX=f.x,f.y=E*d.HOOP_Y_MIN_RATIO,f.targetY=f.y,f.animationProgress=1,f.netWave=0,f.scored=!1,re.classList.remove("active"),J.classList.remove("warning")}function kt(){w="GAME_OVER",console.log("[gameOver] Final score: "+G+", Baskets: "+U),typeof window.submitScore=="function"&&(window.submitScore(G),console.log("[gameOver] Score submitted: "+G)),ct(),_("error"),et.textContent=G.toString(),tt.textContent=U.toString();let t="ROOKIE",o="#ffd700";U>=30?(t="HALL OF FAME",o="#00ffff"):U>=20?(t="LEGEND",o="#ff00ff"):U>=15?(t="MVP",o="#ffd700"):U>=10?(t="ALL-STAR",o="#ffffff"):U>=5&&(t="PRO",o="#a0a0a0"),le.textContent=t,le.style.color=o,le.style.borderColor=o,le.style.boxShadow="0 0 15px "+o+"66",ge.classList.add("hidden"),ve.classList.add("hidden"),j.classList.add("hidden"),Re.classList.remove("hidden"),ue.classList.add("hidden"),document.getElementById("settingsBtn").classList.add("hidden"),de.classList.add("hidden"),Le.classList.add("hidden"),Ce.classList.add("hidden")}function oe(){console.log("[startGame] Starting game"),w="PLAYING",lt(),Dt(),ge.classList.add("hidden"),ve.classList.add("hidden"),Re.classList.add("hidden"),j.classList.add("hidden"),ue.classList.remove("hidden"),document.getElementById("settingsBtn").classList.remove("hidden"),Le.classList.remove("hidden"),Ce.classList.remove("hidden"),V(),_("light")}function ze(){w==="PLAYING"&&(console.log("[pauseGame] Game paused"),w="PAUSED",j.classList.remove("hidden"),_("light"))}function Ve(){w==="PAUSED"&&(console.log("[resumeGame] Game resumed"),w="PLAYING",j.classList.add("hidden"),_("light"))}function Pe(){console.log("[showStartScreen] Showing start screen"),w="START",ge.classList.remove("hidden"),ve.classList.remove("hidden"),Re.classList.add("hidden"),j.classList.add("hidden"),ue.classList.add("hidden"),document.getElementById("settingsBtn").classList.add("hidden"),de.classList.add("hidden"),Le.classList.add("hidden"),Ce.classList.add("hidden")}function Ht(){window.addEventListener("keydown",h=>{(h.key===" "||h.key==="ArrowUp"||h.key==="w"||h.key==="W")&&(h.preventDefault(),w==="PLAYING"?be():w==="START"&&oe()),h.key==="Escape"&&(w==="PLAYING"?ze():w==="PAUSED"&&Ve())});function t(h){h.preventDefault(),W.classList.add("pressed"),w==="PLAYING"&&be()}function o(h){h.preventDefault(),W.classList.remove("pressed")}W.addEventListener("touchstart",t),W.addEventListener("touchend",o),W.addEventListener("touchcancel",o),W.addEventListener("mousedown",t),W.addEventListener("mouseup",o),W.addEventListener("mouseleave",()=>W.classList.remove("pressed")),K.addEventListener("click",()=>{w==="PLAYING"&&be()}),document.getElementById("startButton").addEventListener("click",oe),ue.addEventListener("click",ze),document.getElementById("resumeButton").addEventListener("click",Ve),document.getElementById("pauseRestartBtn").addEventListener("click",()=>{j.classList.add("hidden"),oe()}),document.getElementById("pauseMenuBtn").addEventListener("click",Pe),document.getElementById("restartButton").addEventListener("click",oe),document.getElementById("menuButton").addEventListener("click",Pe);const a=document.getElementById("musicToggle"),m=document.getElementById("fxToggle"),r=document.getElementById("hapticToggle");a.classList.toggle("active",O.music),m.classList.toggle("active",O.fx),r.classList.toggle("active",O.haptics),a.addEventListener("click",()=>{O.music=!O.music,a.classList.toggle("active",O.music),localStorage.setItem("hoopsJump_music",O.music.toString()),V(),_("light")}),m.addEventListener("click",()=>{O.fx=!O.fx,m.classList.toggle("active",O.fx),localStorage.setItem("hoopsJump_fx",O.fx.toString()),O.fx&&V(),_("light")}),r.addEventListener("click",()=>{O.haptics=!O.haptics,r.classList.toggle("active",O.haptics),localStorage.setItem("hoopsJump_haptics",O.haptics.toString()),V(),_("light")}),document.getElementById("settingsClose").addEventListener("click",()=>{de.classList.add("hidden"),V(),_("light")}),document.getElementById("settingsBtn").addEventListener("click",()=>{de.classList.toggle("hidden"),V(),_("light")});const x=document.querySelectorAll(".map-btn, .court-btn"),R=h=>{console.log("[initEventListeners] Updating map to:",h),me=h,localStorage.setItem("hoopsJump_map",h),document.querySelectorAll(".map-btn, .court-btn").forEach(P=>{P.classList.toggle("active",P.getAttribute("data-map")===h)})};R(me),x.forEach(h=>{h.addEventListener("click",()=>{const P=h.getAttribute("data-map");R(P),V(),_("light")})}),ge.addEventListener("click",h=>{const P=h.target;!P.closest(".court-btn")&&!P.closest("#startButton")&&oe()})}function qe(){const t=E,o=Ze.getBoundingClientRect();n=o.width,E=o.height;const a=Math.min(window.devicePixelRatio||1,2);if(K.width=n*a,K.height=E*a,K.style.width=n+"px",K.style.height=E+"px",e.setTransform(a,0,0,a,0,0),e.imageSmoothingEnabled=!1,i=E-30,Q=[],Je(),f.targetX=ye(f.side),f.x=f.targetX,f.targetY>0&&t>0){const m=f.y/t;f.y=E*m,f.targetY=f.y}s.y>i-d.BALL_RADIUS&&(s.y=i-d.BALL_RADIUS),console.log("[resizeCanvas] Canvas resized to: "+n+" x "+E)}function $e(t){const o=Math.min(t-Ee,100);Ee=t,B=t,dt(),e.save(),e.translate(xe,Ie),e.clearRect(-20,-20,n+40,E+40),ft(),w==="PLAYING"?(wt(o),xt(),_t(o),Xe(o),Ye(o),It(o),At(),Se(),pe(),we(),De(),ke(),He()):w==="START"?(Se(),pe()):(w==="PAUSED"||w==="GAME_OVER")&&(Xe(o),Ye(o),Se(),w==="PAUSED"&&pe(),we(),De(),ke(),He()),e.restore(),requestAnimationFrame($e)}function Gt(){console.log("[init] Initializing Hoops Jump"),qe(),window.addEventListener("resize",qe),Ht(),s.x=n/2,s.y=i-d.BALL_RADIUS-125,f.x=ye("right"),f.targetX=f.x,f.y=E*d.HOOP_Y_MIN_RATIO,f.targetY=f.y,requestAnimationFrame($e),Pe(),console.log("[init] Game initialized")}Gt();</script>
</head>
<body>
    <div id="game-container">
        <!-- Decorative screws -->
        <div class="screw screw-tl"></div>
        <div class="screw screw-tr"></div>
        <div class="screw screw-bl"></div>
        <div class="screw screw-br"></div>

        <!-- Pause Button -->
        <button id="pauseBtn" class="hidden">
            <svg viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
        </button>

        <!-- Settings Button -->
        <button id="settingsBtn" class="hidden">
            <svg viewBox="0 0 24 24">
                <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
        </button>

        <!-- Game Screen -->
        <div id="screen-container">
            <canvas id="gameCanvas"></canvas>
            <div id="combo-display"></div>
            
            <!-- Start Screen - inside screen container to overlay canvas -->
            <div id="startScreen">
                <!-- Gradient overlay for readability -->
                <div class="start-overlay-gradient"></div>
                
                <!-- Scanlines for retro effect -->
                <div class="scanlines"></div>
                
                <!-- Floating basketballs -->
                <div class="start-ball-icon ball-left"></div>
                <div class="start-ball-icon ball-right"></div>
                
                <!-- Title at top -->
                <div class="start-title-area">
                    <div class="start-logo">
                        <h1 class="logo-main">HOOPS JUMP</h1>
                        <p class="logo-sub">Arcade Basketball</p>
                    </div>
                </div>
                
                <!-- Court selector -->
                <div class="court-selector">
                    <span class="court-label">SELECT COURT</span>
                    <div class="court-buttons">
                        <button class="court-btn active" data-map="city">
                            <span class="court-icon"></span>
                            <span class="court-name">CITY</span>
                        </button>
                        <button class="court-btn" data-map="mountain">
                            <span class="court-icon"></span>
                            <span class="court-name">MOUNTAIN</span>
                        </button>
                        <button class="court-btn" data-map="beach">
                            <span class="court-icon"></span>
                            <span class="court-name">PIER</span>
                        </button>
                    </div>
                </div>
                
            </div>

            <!-- Game Over Screen -->
            <div id="gameOverScreen" class="overlay hidden">
                <div class="overlay-content">
                    <h2 class="game-title">GAME OVER</h2>
                    
                    <div class="baskets-made-container">
                        <p class="baskets-made-label">BASKETS</p>
                        <div class="baskets-made" id="basketsMade">0</div>
                    </div>

                    <div class="rank-container">
                        <p class="score-label">RANK</p>
                        <div class="rank-value" id="rankValue">ROOKIE</div>
                    </div>

                    <p class="score-label">FINAL SCORE</p>
                    <div class="final-score" id="finalScore">0</div>
                    
                    <button class="btn" id="restartButton">RETRY</button>
                    <button class="btn btn-secondary" id="menuButton">MENU</button>
                </div>
            </div>

            <!-- Pause Screen -->
            <div id="pauseScreen" class="overlay hidden">
                <div class="overlay-content">
                    <h2 class="game-title">PAUSED</h2>
                    <button class="btn" id="resumeButton">RESUME</button>
                    <button class="btn btn-secondary" id="pauseRestartBtn">RESTART</button>
                    <button class="btn btn-secondary" id="pauseMenuBtn">MENU</button>
                </div>
            </div>

            <!-- Settings Modal -->
            <div id="settingsModal" class="settings-modal hidden">
                <h3 class="settings-title">SETTINGS</h3>
                <div class="settings-row">
                    <span class="settings-label">MUSIC</span>
                    <div class="toggle active" id="musicToggle"></div>
                </div>
                <div class="settings-row">
                    <span class="settings-label">SOUND FX</span>
                    <div class="toggle active" id="fxToggle"></div>
                </div>
                <div class="settings-row">
                    <span class="settings-label">HAPTICS</span>
                    <div class="toggle active" id="hapticToggle"></div>
                </div>
                <div class="settings-divider"></div>
                <h4 class="settings-subtitle">COURT</h4>
                <div class="map-selector">
                    <button class="map-btn active" id="mapCity" data-map="city">
                        <span class="map-icon"></span>
                        <span class="map-name">CITY</span>
                    </button>
                    <button class="map-btn" id="mapMountain" data-map="mountain">
                        <span class="map-icon"></span>
                        <span class="map-name">MOUNTAIN</span>
                    </button>
                    <button class="map-btn" id="mapBeach" data-map="beach">
                        <span class="map-icon"></span>
                        <span class="map-name">PIER</span>
                    </button>
                </div>
                <button class="btn" id="settingsClose">DONE</button>
            </div>
        </div>

        <!-- Start button area - on the Game Boy chassis -->
        <div class="start-action" id="startAction">
            <button class="btn" id="startButton">PRESS START</button>
            <span class="start-hint">TAP ANYWHERE OR PRESS SPACE</span>
        </div>

        <!-- HUD -->
        <div id="hud" class="hidden">
            <div class="hud-item" id="score-badge">
                <span class="hud-label">SCORE</span>
                <span class="hud-value" id="scoreDisplay">0</span>
            </div>
            <div class="hud-item" id="timer-badge">
                <span class="hud-label">TIME</span>
                <div class="timer-container">
                    <span class="hud-value" id="timerDisplay">60</span>
                    <div id="timer-bonus-popup" class="timer-bonus">+2</div>
                </div>
            </div>
        </div>


        <!-- Controls -->
        <div id="controls" class="hidden">
            <button id="boost-btn">
                <div class="btn-icon"></div>
                <span class="btn-label">BOOST</span>
            </button>
        </div>

    </div>

</body>
</html>

